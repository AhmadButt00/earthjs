!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.earthjs=e()}(this,function(){"use strict";var t=function(t={}){function e(t,e){var n=e+"Keys";t[e]&&(r[e][t.name]=t[e],r[n]=Object.keys(r[e]))}function n(t,e){return r.onRefreshKeys.length>0&&r.onRefreshKeys.map(function(n){r.onRefresh[n](t,e)}),t}function a(t,e){return r.onResizeKeys.length>0&&r.onResizeKeys.map(function(n){r.onResize[n](t,e)}),t}t=Object.assign({select:"#earth",height:870,width:1700},t);var r={onResize:{},onResizeKeys:[],onRefresh:{},onRefreshKeys:[],onInterval:{},onIntervalKeys:[],svgCreateOrder:["svgAddDropShadow","svgAddOcean","svgAddGlobeShading","svgAddWorldOrCountries","svgAddGlobeHilight","svgAddGraticule","svgAddPlaces"]},o=d3.select(t.select).attr("width",t.width).attr("height",t.height),i=d3.geoOrthographic().scale(t.width/4.1).translate([t.width/2,t.height/2]),s=d3.geoPath().projection(i),l={_:{svg:o,proj:i,path:s,drag:!1},register:function(n){var a={};if(l[n.name]=a,Object.keys(n).map(function(e){-1===["data","ready","onInit","onResize","onRefresh","onInterval"].indexOf(e)&&"function"==typeof n[e]&&(a[e]=function(){var a=[].slice.call(arguments);return a.unshift(l,t),n[e].apply(null,a)})}),n.onInit&&n.onInit(l,t),e(n,"onResize"),e(n,"onRefresh"),e(n,"onInterval"),n.data&&n.ready){var r=d3.queue();n.data.forEach(function(t){var e=t.split(".").pop();r.defer(d3[e],t)}),r.await(function(){var e=[].slice.call(arguments);e.unshift(l,t),n.ready.apply(null,e)})}return l}};l._.defs=l._.svg.append("defs");var c=null;return l._.ticker=function(e){return e=e||50,c=setInterval(function(){r.onIntervalKeys.length>0&&r.onIntervalKeys.map(function(e){r.onInterval[e](l,t)})},e),l},l.svgDraw=function(){return r.svgCreateOrder.forEach(function(e){l[e]&&l[e](l,t)}),null===c&&l._.ticker(),l},l._.refresh=n,l._.resize=a,l._.scale=function(e){return l._.proj.scale(e),l._.resize(l,t),l._.refresh(l,t),l},l._.rotate=function(e){return l._.proj.rotate(e),l._.refresh(l,t),l},l},e=function(){function t(t){var e=t[0]/2*p,n=d(e),a=i(e),r=t[1]/2*p,o=d(r),s=i(r),l=t[2]/2*p,c=d(l),u=i(l);return[a*s*u+n*o*c,n*s*u-a*o*c,a*o*u+n*s*c,a*s*c-n*o*u]}function e(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function n(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}var a=Math.acos,r=Math.asin,o=Math.atan2,i=Math.cos,s=Math.max,l=Math.min,c=Math.PI,d=Math.sin,u=Math.sqrt,p=c/180,g=180/c;return t.cartesian=function(t){var e=t[0]*p,n=t[1]*p,a=i(n);return[a*i(e),a*d(e),d(n)]},t.rotation=function(t){return[o(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*g,r(s(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*g,o(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*g]},t.delta=function(t,r){var o=e(t,r),c=u(n(o,o));if(!c)return[1,0,0,0];var p=a(s(-1,l(1,n(t,r))))/2,g=d(p);return[i(p),o[2]/c*g,-o[1]/c*g,o[0]/c*g]},t.multiply=function(t,e){return[t[0]*e[0]-t[1]*e[1]-t[2]*e[2]-t[3]*e[3],t[0]*e[1]+t[1]*e[0]+t[2]*e[3]-t[3]*e[2],t[0]*e[2]-t[1]*e[3]+t[2]*e[0]+t[3]*e[1],t[0]*e[3]+t[1]*e[2]-t[2]*e[1]+t[3]*e[0]]},t}();return t.plugins={versorDragPlugin:function(){return{name:"versorDragPlugin",onInit(t){function n(){t._.drag=!0,o=e.cartesian(t._.proj.invert(d3.mouse(this))),i=t._.proj.rotate(),s=e(i)}function a(){t._.drag=!1}function r(){var n=e.cartesian(t._.proj.rotate(i).invert(d3.mouse(this))),a=e.multiply(s,e.delta(o,n)),r=e.rotation(a);t._.rotate(r)}t._.svg.call(d3.drag().on("start",n).on("end",a).on("drag",r));var o,i,s}}},wheelZoomPlugin:function(){return{name:"wheelZoomPlugin",onInit(t){t._.svg.on("wheel",function(){var e=d3.event.deltaY+t._.proj.scale();e>230&&e<1e3&&t._.scale(e)})}}},oceanPlugin:function(t={}){function e(t,e){if(t._.svg.selectAll("#ocean,.ocean").remove(),!e.hideOcean){var n=t._.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");return n.append("stop").attr("offset","5%").attr("stop-color","#ddf"),n.append("stop").attr("offset","100%").attr("stop-color","#9ab"),t._.ocean=t._.svg.append("circle").attr("cx",e.width/2).attr("cy",e.height/2).attr("r",t._.proj.scale()).attr("class","ocean noclicks").style("fill","url(#ocean)"),t._.ocean}}return t=Object.assign({hideOcean:!1},t),{name:"oceanPlugin",onInit(n,a){Object.assign(a,t),n.svgAddOcean=e},onResize(t,e){t._.ocean&&!e.hideOcean&&t._.ocean.attr("r",t._.proj.scale())}}},configPlugin:function(){return{name:"configPlugin",set(t,e,n){if(n){if(Object.assign(e,n),void 0!==n.stop){var a=t.autorotatePlugin;n.stop?a.stop():a.start()}t._.drag=!0,t.svgDraw(),t._.drag=!1}return Object.assign({},e)}}},graticulePlugin:function(t={}){function e(t,e){if(t._.svg.selectAll(".graticule").remove(),!e.hideGraticule)return t._.graticule=t._.svg.append("g").attr("class","graticule").append("path").datum(n).style("fill","none").style("opacity","0.2").style("stroke","black").style("stroke-width","0.5").attr("class","noclicks").attr("d",t._.path),t._.graticule}var n=d3.geoGraticule();return t=Object.assign({hideGraticule:!1},t),{name:"graticulePlugin",onInit(n,a){Object.assign(a,t),n.svgAddGraticule=e},onRefresh(t,e){t._.graticule&&!e.hideGraticule&&t._.graticule.attr("d",t._.path)}}},fauxGlobePlugin:function(t={}){function e(t,e){if(t._.svg.selectAll("#drop_shadow,.drop_shadow").remove(),!e.hideGlobeShadow){var n=t._.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");n.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),n.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),t._.dropShadow=t._.svg.append("ellipse").attr("cx",e.width/2).attr("cy",e.height-50).attr("rx",.9*t._.proj.scale()).attr("ry",.25*t._.proj.scale()).attr("class","drop_shadow noclicks").style("fill","url(#drop_shadow)"),t._.dropShadow}}function n(t,e){if(t._.svg.selectAll("#globe_shading,.globe_shading").remove(),!e.hideGlobeShading){var n=t._.defs.append("radialGradient").attr("id","globe_shading").attr("cx","50%").attr("cy","40%");return n.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),n.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),t._.globeShading=t._.svg.append("circle").attr("cx",e.width/2).attr("cy",e.height/2).attr("r",t._.proj.scale()).attr("class","globe_shading noclicks").style("fill","url(#globe_shading)"),t._.globeShading}}function a(t,e){if(t._.svg.selectAll("#globe_hilight,.globe_hilight").remove(),!e.hideGlobeHilight){var n=t._.defs.append("radialGradient").attr("id","globe_hilight").attr("cx","75%").attr("cy","25%");return n.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),n.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),t._.globeHilight=t._.svg.append("circle").attr("cx",e.width/2).attr("cy",e.height/2).attr("r",t._.proj.scale()).attr("class","globe_hilight noclicks").style("fill","url(#globe_hilight)"),t._.globeHilight}}return t=Object.assign({hideGlobeShadow:!1,hideGlobeShading:!1,hideGlobeHilight:!1},t),{name:"fauxGlobePlugin",onInit(r,o){Object.assign(o,t),r.svgAddDropShadow=e,r.svgAddGlobeHilight=a,r.svgAddGlobeShading=n},onResize(t,e){t._.globeShading&&!e.hideGlobeShading&&t._.globeShading.attr("r",t._.proj.scale()),t._.globeHilight&&!e.hideGlobeHilight&&t._.globeHilight.attr("r",t._.proj.scale())}}},autorotatePlugin:function(t){var e={stop:!1,lastTick:null,degree:t};return{name:"autorotatePlugin",onInit(t,e){},onInterval(t,n){var a=new Date;if(t._.drag||e.stop||!e.lastTick)e.lastTick=a;else{var r=a-e.lastTick,o=t._.proj.rotate();o[0]+=e.degree*r/1e3,o[0]>=180&&(o[0]-=360),t._.proj.rotate(o),t._.refresh(t,n),e.lastTick=a}},speed(t,n,a){e.degree=a},start(t,n){e.stop=!1},stop(t,n){e.stop=!0}}},placesPlugin:function(t="./d/places.json"){function e(t,e){t._.svg.selectAll(".points,.labels").remove(),o.places&&e.places&&!e.hidePlaces&&(n(t),a(t),r(t,e))}function n(t){return t._.placePoints=t._.svg.append("g").attr("class","points").selectAll("path").data(o.places.features).enter().append("path").attr("class","point").attr("d",t._.path),t._.placePoints}function a(t){return t._.placeLabels=t._.svg.append("g").attr("class","labels").selectAll("text").data(o.places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name}),t._.placeLabels}function r(t,e){var n=t._.proj.invert([e.width/2,e.height/2]);t._.placeLabels.attr("text-anchor",function(n){var a=t._.proj(n.geometry.coordinates)[0];return a<e.width/2-20?"end":a<e.width/2+20?"middle":"start"}).attr("transform",function(n){var a=t._.proj(n.geometry.coordinates),r=a[0],o=a[1];return"translate("+(r+(r<e.width/2?-5:5))+","+(o-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}var o={places:null};return{name:"placesPlugin",data:[t],ready(t,e,n,a){o.places=a,t.svgDraw()},onInit(t,n){n.places=!0,n.hidePlaces=!1,t.svgAddPlaces=e},onRefresh(t,e){t._.placePoints&&e.places&&(t._.placePoints.attr("d",t._.path),r(t,e))}}},worldPlugin:function(t="./d/world-110m.json",e){function n(t,e){t._.svg.selectAll(".land,.lakes,.countries").remove(),e.hideLand||i.world&&(e.hideCountries?t.svgAddWorld(t,e):t.svgAddCountries(t,e),t.svgAddLakes(t,e))}function a(t){return t._.countries=t._.svg.append("g").attr("class","countries").selectAll("path").data(topojson.feature(i.world,i.world.objects.countries).features).enter().append("path").attr("id",function(t){return"x"+t.id}).on("click",s).attr("d",t._.path),t._.countries}function r(t){return t._.world=t._.svg.append("g").attr("class","land").append("path").datum(topojson.feature(i.world,i.world.objects.land)).attr("d",t._.path),t._.world}function o(t){return t._.lakes=t._.svg.append("g").attr("class","lakes").append("path").datum(topojson.feature(i.world,i.world.objects.ne_110m_lakes)).attr("d",t._.path),t._.lakes}var i={world:null,countryNames:null},s=function(){},l=[t];return e&&l.push(e),{name:"worldPlugin",data:l,ready(t,e,n,a,r){i.world=a,i.countryNames=r,t.svgDraw()},onInit(t,e){e.world=!0,e.hideLand=!1,e.hideCountries=!1,t.svgAddWorldOrCountries=n,t.svgAddCountries=a,t.svgAddWorld=r,t.svgAddLakes=o},onRefresh(t,e){e.hideLand||(e.hideCountries?t._.world.attr("d",t._.path):t._.countries.attr("d",t._.path),t._.lakes.attr("d",t._.path))},countryName(t,e,n){return i.countryNames.find(function(t){return t.id==n.id})}}},countryTooltipPlugin:function(){var t=d3.select("body").append("div").attr("class","countryTooltip");return{name:"countryTooltipPlugin",onInit(e){var n=e.svgAddCountries;e.svgAddCountries=function(e,a){return n(e,a).on("mouseover",function(n){var a=e.worldPlugin.countryName(n);t.text(a.name).style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px").style("display","block").style("opacity",1)}).on("mouseout",function(){t.style("opacity",0).style("display","none")}).on("mousemove",function(){t.style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px")})}}}}},t});