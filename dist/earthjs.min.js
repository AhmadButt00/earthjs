var earthjs=function(){"use strict";var t=function(){function t(t){var n=t[0]/2*d,e=u(n),i=r(n),s=t[1]/2*d,o=u(s),a=r(s),l=t[2]/2*d,c=u(l),h=r(l);return[i*a*h+e*o*c,e*a*h-i*o*c,i*o*h+e*a*c,i*a*c-e*o*h]}function n(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function e(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}var i=Math.acos,s=Math.asin,o=Math.atan2,r=Math.cos,a=Math.max,l=Math.min,c=Math.PI,u=Math.sin,h=Math.sqrt,d=c/180,p=180/c;return t.cartesian=function(t){var n=t[0]*d,e=t[1]*d,i=r(e);return[i*r(n),i*u(n),u(e)]},t.rotation=function(t){return[o(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*p,s(a(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*p,o(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*p]},t.delta=function(t,s){var o=n(t,s),c=h(e(o,o));if(!c)return[1,0,0,0];var d=i(a(-1,l(1,e(t,s))))/2,p=u(d);return[r(d),o[2]/c*p,-o[1]/c*p,o[0]/c*p]},t.multiply=function(t,n){return[t[0]*n[0]-t[1]*n[1]-t[2]*n[2]-t[3]*n[3],t[0]*n[1]+t[1]*n[0]+t[2]*n[3]-t[3]*n[2],t[0]*n[2]-t[1]*n[3]+t[2]*n[0]+t[3]*n[1],t[0]*n[3]+t[1]*n[2]-t[2]*n[1]+t[3]*n[0]]},t}(),n=function(){function n(t,n){var e=n+"Keys";t[n]&&(i[n][t.name]=t[n],i[e]=Object.keys(i[n]))}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({select:"#earth",rotate:130,height:500,width:700},e);var i={onResize:{},onResizeKeys:[],onRefresh:{},onRefreshKeys:[],onInterval:{},onIntervalKeys:[],renderOrder:["renderThree","svgAddDropShadow","svgAddCanvas","canvasAddGraticule","canvasAddWorldOrCountries","svgAddOcean","svgAddGlobeShading","svgAddGraticule","svgAddWorldOrCountries","svgAddGlobeHilight","svgAddPlaces","svgAddBar"],ready:null,loadingData:null},s=e.width,o=e.height,r=d3.scaleLinear().domain([0,s]).range([-180,180]),a=d3.selectAll(e.select).attr("width",s).attr("height",o),l={_:{svg:a,drag:!1,versor:t,options:e,ltScale:r},ready:function(t){if(!t)return i.loadingData;i.ready=t},register:function(t){var e={};if(l[t.name]=e,Object.keys(t).map(function(n){-1===["urls","onReady","onInit","onResize","onRefresh","onInterval"].indexOf(n)&&"function"==typeof t[n]&&(e[n]=function(){return t[n].apply(l,arguments)})}),t.onInit&&t.onInit.call(l),n(t,"onResize"),n(t,"onRefresh"),n(t,"onInterval"),t.urls&&t.onReady){i.loadingData=!0;var s=d3.queue();t.urls.forEach(function(t){var n=t.split(".").pop();"geojson"===n&&(n="json"),s.defer(d3[n],t)}),s.await(function(){t.onReady.apply(l,arguments),i.loadingData=!1,i.ready.call(l)})}return l}};l._.defs=l._.svg.append("defs");var c=null,u=null;return l._.ticker=function(t){return t=t||50,u=setInterval(function(){l._.intervalRun.call(l),c&&c.forEach(function(t){t._.intervalRun.call(t)})},t),l},l.svgDraw=function(t){return c=t,i.renderOrder.forEach(function(t){l[t]&&l[t].call(l)}),c&&c.forEach(function(t){t.svgDraw(null)}),null===u&&null!==t&&l._.ticker.call(l),l},l._.scale=function(t){return l._.proj.scale(t),l._.resize.call(l),l._.refresh.call(l),l},l._.rotate=function(t){return l._.proj.rotate(t),l._.refresh.call(l),l},l._.intervalRun=function(){i.onIntervalKeys.length>0&&i.onIntervalKeys.map(function(t){i.onInterval[t].call(l)})},l._.refresh=function(){return i.onRefreshKeys.length>0&&i.onRefreshKeys.map(function(t){i.onRefresh[t].call(l)}),l},l._.resize=function(){return i.onResizeKeys.length>0&&i.onResizeKeys.map(function(t){i.onResize[t].call(l)}),l},l._.orthoGraphic=function(){var t=l._.options.width,n=l._.options.height,e=l._.options.rotate,i=l._.ltScale(e);return d3.geoOrthographic().scale(t/3.5).rotate([i,0]).translate([t/2,n/2]).precision(.1).clipAngle(90)},l._.addRenderer=function(t){i.renderOrder.indexOf(t)<0&&i.renderOrder.push(t)},l._.proj=l._.orthoGraphic(),l._.path=d3.geoPath().projection(l._.proj),l};return n.plugins={versorDragPlugin:function(){function t(){function t(t){var n=t._.proj.rotate(),e=n[0]-l[0];n[0]=e+this._.proj.rotate()[0],n[0]>=180&&(n[0]-=360),this._.rotate(n)}function e(){o._.drag=!0,a=r.cartesian(o._.proj.invert(d3.mouse(this))),l=o._.proj.rotate(),c=r(l)}function i(){var t=r.cartesian(o._.proj.rotate(l).invert(d3.mouse(this))),n=r.multiply(c,r.delta(a,t)),e=r.rotation(n);o._.rotate(e)}function s(){n.sync.forEach(function(n){t.call(n,o)}),o._.drag=!1}var o=this,r=this._.versor;n.svg.call(d3.drag().on("start",e).on("end",s).on("drag",i));var a=void 0,l=void 0,c=void 0}var n={svg:null,q:null,sync:[]};return{name:"versorDragPlugin",onInit:function(){n.svg=this._.svg,t.call(this)},selectAll:function(e){return e&&(n.q=e,n.svg=d3.selectAll(e),t.call(this)),n.svg},sync:function(t){n.sync=t}}},wheelZoomPlugin:function(){return{name:"wheelZoomPlugin",onInit:function(){var t=this;this._.svg.on("wheel",function(){var n=d3.event.deltaY+t._.proj.scale();n>230&&n<1e3&&t._.scale(n)})}}},threejsPlugin:function(){function t(){setTimeout(function(){n.renderer.render(n.scene,n.camera)},1)}var n={renderer:null,scene:null,camera:null,scale:null};return{name:"threejsPlugin",onInit:function(){var e=this._.options.width,i=this._.options.height;n.scene=new THREE.Scene,n.yAxis=new THREE.Vector3(0,1,0),n.camera=new THREE.OrthographicCamera(-e/2,e/2,i/2,-i/2,.1,1e4),n.camera.position.z=500,this._.camera=n.camera,n.renderer=new THREE.WebGLRenderer({antialias:!0}),n.renderer.domElement.id="three-js",n.renderer.setClearColor("white",1),n.renderer.setSize(e,i),document.body.appendChild(n.renderer.domElement),this.renderThree=t},onRefresh:function(){t.call(this)},addObject:function(t){n.scene.add(t)}}},canvasPlugin:function(){function t(){if(this._.options.showCanvas){if(!n.canvas){var t=this._.svg.append("g").attr("class","canvas").append("foreignObject").attr("x",0).attr("y",0).attr("width",this._.options.width).attr("height",this._.options.height),e=t.append("xhtml:body").style("margin","0px").style("padding","0px").style("background-color","none").style("width",this._.options.width+"px").style("height",this._.options.height+"px");n.canvas=e.append("canvas")}return n.canvas.attr("x",0).attr("y",0).attr("width",this._.options.width).attr("height",this._.options.height),n.canvas}}var n={canvas:null,path:null,q:null};return{name:"canvasPlugin",onInit:function(){this.svgAddCanvas=t,this._.options.showCanvas=!0,n.path=d3.geoPath().projection(this._.proj)},onRefresh:function(){var t=this._.options.width,e=this._.options.height;n.canvas.each(function(){this.getContext("2d").clearRect(0,0,t,e)})},selectAll:function(t){return t&&(n.q=t,n.canvas=d3.selectAll(t)),n.canvas},render:function(t){if(this._.options.showCanvas){var e=this;n.canvas.each(function(){var i=this.getContext("2d");t.call(e,i,n.path.context(i))})}}}},oceanPlugin:function(){function t(){if(e.svg.selectAll("#ocean,.ocean").remove(),this._.options.showOcean){var t=this._.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");return t.append("stop").attr("offset","5%").attr("stop-color","#ddf"),t.append("stop").attr("offset","100%").attr("stop-color","#9ab"),this._.ocean=e.svg.append("g").attr("class","ocean").append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("class","noclicks"),n.call(this),this._.ocean}}function n(){this._.ocean&&this._.options.showOcean&&this._.ocean.attr("r",this._.proj.scale())}var e={svg:null,q:null};return{name:"oceanPlugin",onInit:function(){this._.options.showOcean=!0,this.svgAddOcean=t,e.svg=this._.svg},onResize:function(){n.call(this)},selectAll:function(t){return t&&(e.q=t,e.svg=d3.selectAll(t)),e.svg}}},configPlugin:function(){return{name:"configPlugin",set:function(t){if(t){if(Object.assign(this._.options,t),void 0!==t.spin){var n=this.autorotatePlugin;t.spin?n.start():n.stop()}this._.drag=!0,this.svgDraw(),this._.drag=!1}return Object.assign({},this._.options)}}},graticuleCanvas:function(){function t(){this._.options.showGraticule&&this.canvasPlugin.render(function(t,e){t.beginPath(),e(n()),t.lineWidth=.3,t.strokeStyle="rgba(119,119,119,0.4)",t.stroke()})}var n=d3.geoGraticule();return{name:"graticuleCanvas",onInit:function(){this.canvasAddGraticule=t,this._.options.showGraticule=!0},onRefresh:function(){t.call(this)}}},graticulePlugin:function(){function t(){if(i.svg.selectAll(".graticule").remove(),this._.options.showGraticule)return this._.graticule=i.svg.append("g").attr("class","graticule").append("path").datum(e).attr("class","noclicks"),n.call(this),this._.graticule}function n(){this._.graticule&&this._.options.showGraticule&&this._.graticule.attr("d",this._.path)}var e=d3.geoGraticule(),i={svg:null,q:null};return{name:"graticulePlugin",onInit:function(){this.svgAddGraticule=t,this._.options.showGraticule=!0,i.svg=this._.svg},onRefresh:function(){n.call(this)},selectAll:function(t){return t&&(i.q=t,i.svg=d3.selectAll(t)),i.svg}}},fauxGlobePlugin:function(){function t(){if(i.svg.selectAll("#drop_shadow,.drop_shadow").remove(),this._.options.showGlobeShadow){var t=this._.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");t.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),t.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),this._.dropShadow=i.svg.append("g").attr("class","drop_shadow").append("ellipse").attr("cx",this._.options.width/2).attr("cy",this._.options.height-50).attr("rx",.9*this._.proj.scale()).attr("ry",.25*this._.proj.scale()).attr("class","noclicks").style("fill","url(#drop_shadow)"),this._.dropShadow}}function n(){if(i.svg.selectAll("#shading,.shading").remove(),this._.options.showGlobeShading){var t=this._.defs.append("radialGradient").attr("id","shading").attr("cx","50%").attr("cy","40%");return t.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),t.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),this._.globeShading=i.svg.append("g").attr("class","shading").append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale()).attr("class","noclicks").style("fill","url(#shading)"),this._.globeShading}}function e(){if(i.svg.selectAll("#hilight,.hilight").remove(),this._.options.showGlobeHilight){var t=this._.defs.append("radialGradient").attr("id","hilight").attr("cx","75%").attr("cy","25%");return t.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),t.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),this._.globeHilight=i.svg.append("g").attr("class","hilight").append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale()).attr("class","noclicks").style("fill","url(#hilight)"),this._.globeHilight}}var i={svg:null,q:null};return{name:"fauxGlobePlugin",onInit:function(){this._.options.showGlobeShadow=!0,this._.options.showGlobeShading=!0,this._.options.showGlobeHilight=!0,this.svgAddDropShadow=t,this.svgAddGlobeHilight=e,this.svgAddGlobeShading=n,i.svg=this._.svg},onResize:function(){this._.globeShading&&this._.options.showGlobeShading&&this._.globeShading.attr("r",this._.proj.scale()),this._.globeHilight&&this._.options.showGlobeHilight&&this._.globeHilight.attr("r",this._.proj.scale())},selectAll:function(t){return t&&(i.q=t,i.svg=d3.selectAll(t)),i.svg}}},autorotatePlugin:function(t){function n(t){var n=this._.proj.rotate();n[0]+=e.degree*t/1e3,n[0]>=180&&(n[0]-=360),this._.rotate(n)}var e={spin:!0,lastTick:null,degree:t,sync:[]};return{name:"autorotatePlugin",onInit:function(){this._.options.spin=!0},onInterval:function(){var t=new Date;if(e.lastTick&&e.spin&&!this._.drag){var i=t-e.lastTick;n.call(this,i),e.sync.forEach(function(t){return n.call(t,i)}),e.lastTick=t}else e.lastTick=t},speed:function(t){e.degree=t},start:function(){e.spin=!0},stop:function(){e.spin=!1},sync:function(t){e.sync=t}}},placesPlugin:function(t){function n(){r.svg.selectAll(".points,.labels").remove(),r.places&&this._.options.showPlaces&&(i.call(this),s.call(this),e.call(this))}function e(){this._.placePoints&&(this._.placePoints.attr("d",this._.path),o.call(this))}function i(){return this._.placePoints=r.svg.append("g").attr("class","points").selectAll("path").data(r.places.features).enter().append("path").attr("class","point"),this._.placePoints}function s(){return this._.placeLabels=r.svg.append("g").attr("class","labels").selectAll("text").data(r.places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name}),this._.placeLabels}function o(){var t=this,n=this._.proj.invert([this._.options.width/2,this._.options.height/2]);this._.placeLabels.attr("text-anchor",function(n){var e=t._.proj(n.geometry.coordinates)[0];return e<t._.options.width/2-20?"end":e<t._.options.width/2+20?"middle":"start"}).attr("transform",function(n){var e=t._.proj(n.geometry.coordinates),i=e[0],s=e[1];return"translate("+(i+(i<t._.options.width/2?-5:5))+","+(s-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}var r={svg:null,q:null,places:null};return{name:"placesPlugin",urls:t&&[t],onReady:function(t,n){r.places=n},onInit:function(){this._.options.showPlaces=!0,this.svgAddPlaces=n,r.svg=this._.svg},onRefresh:function(){e.call(this)},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg},data:function(t){if(!t)return{places:r.places};var n=t.placesPlugin.data();r.places=n.places}}},worldCanvas:function(t,n){function e(){this._.options.showLand&&r.world&&(i.call(this),this._.options.showCountries&&s.call(this),this._.options.showLakes&&o.call(this))}function i(){var t=topojson.feature(r.world,r.world.objects.land);this.canvasPlugin.render(function(n,e){n.beginPath(),e(t),n.fillStyle=r.style.land||"rgba(117, 87, 57, 0.4)",n.fill()})}function s(){var t=topojson.feature(r.world,r.world.objects.countries);this.canvasPlugin.render(function(n,e){n.beginPath(),e(t),n.lineWidth=.5,n.strokeStyle=r.style.countries||"rgba(80, 64, 39, 0.6)",n.stroke()})}function o(){var t=topojson.feature(r.world,r.world.objects.ne_110m_lakes);this.canvasPlugin.render(function(n,e){n.beginPath(),e(t),n.fillStyle=r.style.lakes||"rgba(80, 87, 97, 0.4)",n.fill()})}var r={world:null,countryNames:null,style:{}},a=null;return t&&(a=[t],n&&a.push(n)),{name:"worldCanvas",urls:a,onReady:function(t,n,e){r.world=n,r.countryNames=e},onInit:function(){this._.options.showLand=!0,this._.options.showLakes=!0,this._.options.showCountries=!0,this.canvasAddWorldOrCountries=e},onRefresh:function(){e.call(this)},data:function(t){if(!t)return{countryNames:r.countryNames,world:r.world};var n=t.worldCanvas.data();r.countryNames=n.countryNames,r.world=n.world},style:function(t){return t&&(r.style=t),r.style}}},worldPlugin:function(t,n){function e(){a.svg.selectAll(".land,.lakes,.countries").remove(),this._.options.showLand&&(a.world&&(this._.options.showCountries?this.svgAddCountries.call(this):this.svgAddWorld.call(this),this._.options.showLakes&&this.svgAddLakes.call(this)),i.call(this))}function i(){a.world&&this._.options.showLand&&(this._.options.showCountries?this._.countries.attr("d",this._.path):this._.world.attr("d",this._.path),this._.options.showLakes&&this._.lakes.attr("d",this._.path))}function s(){var t=topojson.feature(a.world,a.world.objects.land);return this._.world=a.svg.append("g").attr("class","land").append("path").datum(t),this._.world}function o(){var t=topojson.feature(a.world,a.world.objects.countries).features;return this._.countries=a.svg.append("g").attr("class","countries").selectAll("path").data(t).enter().append("path").on("click",l).attr("id",function(t){return"x"+t.id}),this._.countries}function r(){var t=topojson.feature(a.world,a.world.objects.ne_110m_lakes);return this._.lakes=a.svg.append("g").attr("class","lakes").append("path").datum(t),this._.lakes}var a={svg:null,q:null,world:null,countryNames:null},l=function(){},c=null;return t&&(c=[t],n&&c.push(n)),{name:"worldPlugin",urls:c,onReady:function(t,n,e){a.world=n,a.countryNames=e},onInit:function(){this._.options.showLand=!0,this._.options.showLakes=!0,this._.options.showCountries=!0,this.svgAddWorldOrCountries=e,this.svgAddCountries=o,this.svgAddLakes=r,this.svgAddWorld=s,a.svg=this._.svg},onRefresh:function(){i.call(this)},countries:function(){return topojson.feature(a.world,a.world.objects.countries).features},countryName:function(t){var n="";return a.countryNames&&(n=a.countryNames.find(function(n){return n.id==t.id})),n},selectAll:function(t){return t&&(a.q=t,a.svg=d3.selectAll(t)),a.svg},data:function(t){if(!t)return{countryNames:a.countryNames,world:a.world};var n=t.worldPlugin.data();a.countryNames=n.countryNames,a.world=n.world}}},worldThreejs:function(){function t(){if(!e.sphereObject){var t=this,i=new THREE.Group;(new THREE.TextureLoader).load("./d/world.jpg",function(s){var o=new THREE.SphereGeometry(200,20,20),r=new THREE.MeshBasicMaterial({map:s,overdraw:.5});e.sphereObject=new THREE.Mesh(o,r),i.add(e.sphereObject),n.call(t)}),t.threejsPlugin.addObject(i)}}function n(){var t=this._.proj.rotate();t[0]-=90;var n=this._.versor(t),i=new THREE.Quaternion(-n[2],n[1],n[3],n[0]);e.sphereObject.setRotationFromQuaternion(i)}var e={sphereObject:null};return{name:"worldThreejs",onInit:function(){t.call(this)},onRefresh:function(){e.sphereObject&&n.call(this)}}},centerPlugin:function(){function t(t,n){n=n.replace("x","");for(var e=0,i=t.length;e<i;e++)if(t[e].id==n)return t[e]}function n(t){var n=this;d3.transition().duration(2500).tween("rotate",function(){var e=d3.interpolate(n._.proj.rotate(),[-t[0],-t[1]]);return function(t){n._.rotate(e(t))}})}function e(){var e=this,s=i.svgAddCountriesOld.call(this);return s.on("click",function(){var s=this.id.replace("x",""),o=e.worldPlugin.countries(),r=t(o,s),a=d3.geoCentroid(r);n.call(e,a),"function"==typeof i.focused&&i.focused.call(e)}),s}var i={focused:null,svgAddCountriesOld:null};return{name:"centerPlugin",onInit:function(){i.svgAddCountriesOld=this.svgAddCountries,this.svgAddCountries=e},go:function(e){var i=this.worldPlugin.countries(),s=t(i,e),o=d3.geoCentroid(s);n.call(this,o)},focused:function(t){i.focused=t}}},countryTooltipPlugin:function(){var t=d3.select("body").append("div").attr("class","countryTooltip");return{name:"countryTooltipPlugin",onInit:function(){var n=this,e=this.svgAddCountries;this.svgAddCountries=function(){return e.call(this).on("mouseover",function(e){var i=n.worldPlugin.countryName.call(n,e);t.text(i.name).style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px").style("display","block").style("opacity",1)}).on("mouseout",function(){t.style("opacity",0).style("display","none")}).on("mousemove",function(){t.style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px")})}}}},flattenPlugin:function(){var t={proj:null};return{name:"flattenPlugin",onInit:function(){function n(){e._.svg.transition().duration(10500).tween("projection",function(){return function(t){n.alpha(t),e._.refresh()}})}var e=this,i=this._.proj,s=d3.geoEquirectangular().scale(175).translate([350,250]);t.proj=function(t,e){function i(n,i){var s=t([n*=180/Math.PI,i*=180/Math.PI]),r=e([n,i]);return[(1-o)*s[0]+o*r[0],(o-1)*s[1]-o*r[1]]}var s=d3.geoProjection(i).scale(1),o=void 0;return n.alpha=function(n){if(!arguments.length)return o;var i=t.translate(),r=e.translate();return o=+n,r[0]=i[0],r[1]=i[1]/1.2,s.translate([(1-o)*i[0]+o*r[0],(1-o)*i[1]+o*r[1]]),s},n.alpha(0),s}(i,s),this._.animation=n,this._.px=t.proj,this._.g1=i,this._.g2=s},toMap:function(){this._.path=d3.geoPath().projection(t.proj),this.svgDraw(),this._.animation.call(this)}}},barPlugin:function(t){function n(){if(s.svg.selectAll(".bar").remove(),s.bars&&this._.options.showBars){var t=s.svg.append("g").attr("class","bar"),n=t.append("mask").attr("id","edge");n.append("rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","white"),n.append("use").attr("xlink:href","#edgeCircle").attr("fill","black"),this._.mask=n,s.max=d3.max(s.bars,function(t){return parseInt(t.Value)});var i=this._.proj.scale();return s.lengthScale=d3.scaleLinear().domain([0,s.max]).range([i,i+50]),this._.bar=t.selectAll("line").data(s.bars).enter().append("line").attr("stroke","red").attr("stroke-width","2"),e.call(this),this._.bar}}function e(){if(s.bars&&this._.options.showBars){var t=this._.proj,n=t.invert([this._.options.width/2,this._.options.height/2]);this._.bar.attr("x1",function(n){return t([n.Longitude,n.Latitude])[0]}).attr("y1",function(n){return t([n.Longitude,n.Latitude])[1]}).attr("x2",function(t){return s.barProjection.scale(s.lengthScale(t.Value)),s.barProjection([t.Longitude,t.Latitude])[0]}).attr("y2",function(t){return s.barProjection.scale(s.lengthScale(t.Value)),s.barProjection([t.Longitude,t.Latitude])[1]}).attr("mask",function(t){return d3.geoDistance([t.Longitude,t.Latitude],n)<1.57?null:"url(#edge)"})}}function i(){this._.defs.selectAll("clipPath").remove(),this._.defs.append("clipPath").append("circle").attr("id","edgeCircle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale())}var s={svg:null,barProjection:null,q:null,bars:null};return{name:"barPlugin",urls:t&&[t],onReady:function(t,n){var i=this;s.bars=n,setTimeout(function(){return e.call(i)},1)},onInit:function(){this.svgAddBar=n,this.svgClipPath=i,this._.options.showBars=!0,s.barProjection=this._.orthoGraphic(),s.svg=this._.svg,i.call(this)},onResize:function(){i.call(this),n.call(this)},onRefresh:function(){s.barProjection.rotate(this._.proj.rotate()),e.call(this)},selectAll:function(t){return t&&(s.q=t,s.svg=d3.selectAll(t)),s.svg},data:function(t){if(!t)return{bars:s.bars};var n=t.barPlugin.data();s.bars=n.bars}}},debugThreejs:function(){function t(){if(!e.sphereObject){var t=this._.proj.scale(),i=new THREE.SphereGeometry(t,100,100),s=new THREE.MeshNormalMaterial({wireframe:!1}),o=new THREE.Mesh(i,s),r=new THREE.SphereGeometry(30,10,10),a=new THREE.SphereGeometry(30,10,10),l=new THREE.SphereGeometry(30,10,10);r.translate(0,0,t),a.translate(t,0,0),l.translate(0,-t,0);var c=new THREE.MeshBasicMaterial({color:"blue"}),u=new THREE.MeshBasicMaterial({color:"red"}),h=new THREE.MeshBasicMaterial({color:"green"}),d=new THREE.Mesh(r,c),p=new THREE.Mesh(a,u),f=new THREE.Mesh(l,h);e.sphereObject=new THREE.Object3D,e.sphereObject.add(o,d,p,f),n.call(this),this.threejsPlugin.addObject(e.sphereObject)}}function n(){var t=this._.proj.rotate();t[0]-=90;var n=this._.versor(t),i=new THREE.Quaternion(-n[2],n[1],n[3],n[0]);e.sphereObject.setRotationFromQuaternion(i)}var e={sphereObject:null};return{name:"debugThreejs",onInit:function(){this._.options.showDebugSpahre=!0,t.call(this)},onRefresh:function(){e.sphereObject&&n.call(this)}}},commonPlugins:function(){var t={checker:[]};return{name:"commonPlugins",onInit:function(){var n=this,e=this.register,i=earthjs.plugins;e(i.autorotatePlugin(10)),e(i.versorDragPlugin()),e(i.wheelZoomPlugin()),e(i.configPlugin()),e(i.oceanPlugin()),e(i.canvasPlugin()),e(i.graticuleCanvas()),e(i.worldCanvas("./d/world-110m.json")),this.canvasPlugin.selectAll(".canvas"),this.ready(function(){return n.svgDraw()}),t.options=this.configPlugin.set(),t.buttonClick=function(e){var i=e.split(":"),s=i[2],o={},r=t.options;r[s]=!r[s],o[s]=r[s],"hideCountries"==s&&(o.hideLand=!1),n.configPlugin.set(o)},t.checker=["ocean:Ocean:showOcean","graticule:Graticule:showGraticule","hideLand:Land:showLand","spin:Spin:spin"].map(function(t){return t.split(":")}),d3.select(".set-options").selectAll("button").data(t.checker).enter().append("button").text(function(t){return t[1]}).on("click",function(e){return t.buttonClick.call(n,e.join(":"))})},addChecker:function(n){var e=this;t.checker.push(n),t.options=this.configPlugin.set(),d3.select(".set-options").selectAll("button").data(t.checker).enter().append("button").text(function(t){return t[1]}).on("click",function(n){return t.buttonClick.call(e,n.join(":"))})}}}},n}();