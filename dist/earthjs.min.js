var earthjs=function(){"use strict";function t(t,n){(arguments.length<2||isNaN(parseFloat(n))||!isFinite(n)||n<0)&&(n=42),THREE.Geometry.call(this);var e,o=[];for(e=0;e<t.vertices.length;e+=2){var a=t.vertices[e],r=t.vertices[e+1],i=.01745329252*+(90-r),s=.01745329252*+(180-a),l=Math.sin(s)*Math.sin(i)*-1,c=Math.cos(s)*Math.sin(i),u=Math.cos(i),h=.25+a/360,d=.5+r/180;this.vertices.push(new THREE.Vector3(l,u,c)),o.push(new THREE.Vector2(h,d))}var f=this.vertices.length;if(n<=1)for(e=0;e<f;e++){var p=this.vertices[e];this.vertices.push(p.clone().multiplyScalar(n))}for(e=0;e<t.triangles.length;e+=3){var v=t.triangles[e],g=t.triangles[e+1],w=t.triangles[e+2];this.faces.push(new THREE.Face3(v,g,w,[this.vertices[v],this.vertices[g],this.vertices[w]])),this.faceVertexUvs[0].push([o[v],o[g],o[w]]),0<n&&n<=1&&(this.faces.push(new THREE.Face3(f+g,f+v,f+w,[this.vertices[g].clone().multiplyScalar(-1),this.vertices[v].clone().multiplyScalar(-1),this.vertices[w].clone().multiplyScalar(-1)])),this.faceVertexUvs[0].push([o[g],o[v],o[w]]))}if(n<1)for(e=0;e<t.polygons.length;e++)for(var m=t.polygons[e],y=0;y<m.length;y++)for(var b=m[y],C=0;C<b.length;C++){var j,v=b[C],g=b[(C+1)%b.length],E=this.vertices[v],_=this.vertices[g],T=this.vertices[f+v];y<1?(j=_.clone().sub(E).cross(T.clone().sub(E)).normalize(),this.faces.push(new THREE.Face3(v,g,f+v,[j,j,j])),this.faceVertexUvs[0].push([o[v],o[g],o[v]]),n>0&&(this.faces.push(new THREE.Face3(g,f+g,f+v,[j,j,j])),this.faceVertexUvs[0].push([o[g],o[g],o[v]]))):(j=T.clone().sub(E).cross(_.clone().sub(E)).normalize(),this.faces.push(new THREE.Face3(g,v,f+v,[j,j,j])),this.faceVertexUvs[0].push([o[g],o[v],o[v]]),n>0&&(this.faces.push(new THREE.Face3(g,f+v,f+g,[j,j,j])),this.faceVertexUvs[0].push([o[g],o[v],o[g]])))}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,1)}var n=function(){function t(t){var n=t[0]/2*d,e=u(n),o=i(n),a=t[1]/2*d,r=u(a),s=i(a),l=t[2]/2*d,c=u(l),h=i(l);return[o*s*h+e*r*c,e*s*h-o*r*c,o*r*h+e*s*c,o*s*c-e*r*h]}function n(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function e(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}var o=Math.acos,a=Math.asin,r=Math.atan2,i=Math.cos,s=Math.max,l=Math.min,c=Math.PI,u=Math.sin,h=Math.sqrt,d=c/180,f=180/c;return t.cartesian=function(t){var n=t[0]*d,e=t[1]*d,o=i(e);return[o*i(n),o*u(n),u(e)]},t.rotation=function(t){return[r(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*f,a(s(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*f,r(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*f]},t.delta=function(t,a){var r=n(t,a),c=h(e(r,r));if(!c)return[1,0,0,0];var d=o(s(-1,l(1,e(t,a))))/2,f=u(d);return[i(d),r[2]/c*f,-r[1]/c*f,r[0]/c*f]},t.multiply=function(t,n){return[t[0]*n[0]-t[1]*n[1]-t[2]*n[2]-t[3]*n[3],t[0]*n[1]+t[1]*n[0]+t[2]*n[3]-t[3]*n[2],t[0]*n[2]-t[1]*n[3]+t[2]*n[0]+t[3]*n[1],t[0]*n[3]+t[1]*n[2]-t[2]*n[1]+t[3]*n[0]]},t}(),e=function t(){function e(t,n){t[n]&&(a[n][t.name]=t[n],a[n+"Keys"]=Object.keys(a[n]),a[n+"Vals"]=a[n+"Keys"].map(function(t){return a[n][t]}))}var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};cancelAnimationFrame(t.ticker),o=Object.assign({selector:"#earth-js",rotate:[130,-33,-11],transparent:!1},o);var a={onCreate:{},onCreateVals:[],onRefresh:{},onRefreshVals:[],onResize:{},onResizeVals:[],onInterval:{},onIntervalVals:[],ready:null,promeses:[],loadingData:null,recreateSvgOrCanvas:function(){return a.onCreateVals.forEach(function(t){t.call(c)}),c}},r=d3.selectAll(o.selector),i=r.attr("width"),s=r.attr("height");i&&s||(i=o.width||700,s=o.height||500,r.attr("width",i).attr("height",s));var l=[i/2,s/2];Object.defineProperty(o,"width",{get:function(){return i},set:function(t){i=t,l[0]=t/2}}),Object.defineProperty(o,"height",{get:function(){return s},set:function(t){s=t,l[1]=t/2}});var c={_:{svg:r,drag:!1,versor:n,center:l,options:o},$slc:{},ready:function(t){if(t&&a.promeses.length>0){var n=d3.queue();a.loadingData=!0,a.promeses.forEach(function(t){t.urls.forEach(function(t){var e=t.split(".").pop();"geojson"===e&&(e="json"),n.defer(d3[e],t)})}),n.await(function(){var n=[].slice.call(arguments),e=n.shift();a.promeses.forEach(function(t){var o=t.urls.length,a=n.slice(0,o),r=c[t.name].ready;a.unshift(e),r?r.apply(c,a):t.onReady.apply(c,a),n=n.slice(o)}),a.loadingData=!1,t.call(c)})}else if(0===arguments.length)return a.loadingData},register:function(t){var n={};return c[t.name]=n,Object.keys(t).forEach(function(e){-1===["urls","onReady","onInit","onCreate","onRefresh","onResize","onInterval"].indexOf(e)&&"function"==typeof t[e]&&(n[e]=function(){return t[e].apply(c,arguments)})}),t.onInit&&t.onInit.call(c),e(t,"onCreate"),e(t,"onResize"),e(t,"onRefresh"),e(t,"onInterval"),t.urls&&t.onReady&&a.promeses.push({name:t.name,urls:t.urls,onReady:t.onReady}),c}};Object.defineProperty(c,"loading",{get:function(){return a.loadingData}});var u=[],h=c._;return c.create=function(t){return u=t||[],a.recreateSvgOrCanvas(),u.forEach(function(t){t.create(null)}),u!==[]&&h.ticker(),c},c.$slc.defs=h.svg.append("defs"),h.ticker=function(n){function e(s){s-r>n&&(r=s,a.loadingData||(o.call(c,s),s-i>n+30&&(i=s,u.forEach(function(t){t._.interval.call(t,s)})))),t.ticker=requestAnimationFrame(e)}var o=h.interval;n=n||10;var r=0,i=0;return t.ticker=requestAnimationFrame(e),c},h.scale=function(t){return h.proj.scale(t),h.resize(),h.refresh(),c},h.rotate=function(t){return h.proj.rotate(t),h.refresh(),c},h.interval=function(t){return a.onIntervalVals.forEach(function(n){n.call(c,t)}),c},h.refresh=function(t){return t?(t?a.onRefreshKeys.filter(function(n){return t.test(n)}):a.onRefreshKeys).forEach(function(t){a.onRefresh[t].call(c)}):a.onRefreshVals.forEach(function(t){t.call(c)}),c},h.resize=function(){return a.onResizeVals.forEach(function(t){t.call(c)}),c},h.orthoGraphic=function(){var t=h.options.rotate;"number"==typeof t&&(h.options.rotate=[t,-33,-11]);var n=h.options.scale;return n||(n=h.options.width/3.5),d3.geoOrthographic().rotate(h.options.rotate).translate(h.center).precision(.1).clipAngle(90).scale(n)},h.proj=h.orthoGraphic(),h.path=d3.geoPath().projection(h.proj),c};void 0===window.d3&&(window.d3={}),window.d3.earthjs=e;var o=function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)};window.THREE&&(t.prototype=Object.create(THREE.Geometry.prototype));return e.plugins={baseCsv:function(t){var n={data:null};return{name:"baseCsv",urls:t&&[t],onReady:function(t,n){this.baseCsv.data(n)},data:function(t){if(!t)return n.data;n.data=t},message:function(t){n.data=n.data.map(t)},allData:function(t){if(!t)return{data:n.data};n.data=t.data}}},worldJson:function(t){var n={world:null};return{name:"worldJson",urls:t&&[t],onReady:function(t,n){this.worldJson.data(n)},data:function(t){if(!t)return n.world;n.world=t,n.land=topojson.feature(t,t.objects.land),n.lakes=topojson.feature(t,t.objects.ne_110m_lakes),n.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:n.world,land:n.land,lakes:n.lakes,countries:n.countries};n.world=t.world,n.land=t.land,n.lakes=t.lakes,n.countries=t.countries}}},choroplethCsv:function(t){var n={choropleth:null,color:null};return{name:"choroplethCsv",urls:t&&[t],onReady:function(t,n){this.choroplethCsv.data(n)},data:function(t){if(!t)return n.choropleth;n.choropleth=t},mergeData:function(t,e){var o=n.choropleth,a=e[0].split(":"),r=e[1].split(":");t.features.forEach(function(t){var n=o.find(function(n){return""+t[a[0]]===n[a[1]]});n&&(t[r[0]]=n[r[1]])})},colorize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"schemeReds",a=n.choropleth.map(function(n){return+n[t]});a=[].concat(o(new Set(a))),n.min=d3.min(a),n.max=d3.max(a);var r=d3[e]||d3.schemeReds,i=d3.scaleLinear().domain([1,10]).rangeRound([n.min,n.max]),s=d3.scaleThreshold().domain(d3.range(2,10)).range(r[9]);n.choropleth.forEach(function(n){n.color=s(i(+n[t]))})}}},countryNamesCsv:function(t){var n={countryNames:null};return{name:"countryNamesCsv",urls:t&&[t],onReady:function(t,n){this.countryNamesCsv.data(n)},data:function(t){if(!t)return n.countryNames;n.countryNames=t},mergeData:function(t,e){var o=n.countryNames,a=e[0].split(":"),r=e[1].split(":");t.features.forEach(function(t){var n=o.find(function(n){return""+t[a[0]]===n[a[1]]});n&&(t[r[0]]=n[r[1]])})}}},hoverCanvas:function(){function t(){if(this._.options.showSelectedCountry=!1,this.worldCanvas){var t=this.worldCanvas.data();t&&(e.world=t,e.countries=topojson.feature(t,t.objects.countries))}var o=this._,a=this,r=function(){var t=this,r=d3.event;if(!o.drag&&r){r.sourceEvent&&(r=r.sourceEvent);var i=[r.clientX,r.clientY],s=o.proj.invert(d3.mouse(this));e.pos=s,e.dot=null,e.mouse=i,e.country=null,o.options.showDots&&e.onCircleVals.forEach(function(n){e.dot=n.call(t,r,s)}),o.options.showLand&&e.countries&&!e.dot&&(o.drag||(a.countryCanvas?e.country=a.countryCanvas.detectCountry(s):e.country=n(s),e.ocountry!==e.country&&a.canvasThreejs&&(e.ocountry=e.country,a.canvasThreejs.refresh())),e.ocountry2!==e.country&&(e.ocountry2=e.country,e.onCountryVals.forEach(function(n){n.call(t,r,e.country)})))}};o.svg.on("mousemove",r),this.mousePlugin&&this.mousePlugin.onDrag({hoverCanvas:r})}function n(t){return e.countries.features.find(function(n){return n.geometry.coordinates.find(function(n){return d3.polygonContains(n,t)||n.find(function(n){return d3.polygonContains(n,t)})})})}var e={mouse:null,country:null,ocountry:null,countries:null,onCircle:{},onCircleVals:[],onCountry:{},onCountryVals:[]};return{name:"hoverCanvas",onInit:function(){t.call(this)},onCreate:function(){this.worldJson&&!e.world&&this.hoverCanvas.allData(this.worldJson.allData())},onCircle:function(t){Object.assign(e.onCircle,t),e.onCircleVals=Object.keys(e.onCircle).map(function(t){return e.onCircle[t]})},onCountry:function(t){Object.assign(e.onCountry,t),e.onCountryVals=Object.keys(e.onCountry).map(function(t){return e.onCountry[t]})},data:function(t){if(!t)return e.world;e.world=t,e.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:e.world,countries:e.countries};e.world=t.world,e.countries=t.countries},states:function(){return{pos:e.pos,dot:e.dot,mouse:e.mouse,country:e.country}}}},clickCanvas:function(){function t(){if(this.worldCanvas){var t=this.worldCanvas.data();t&&(e.countries=topojson.feature(t,t.objects.countries))}var o=this._,a=this;this.mousePlugin&&this.mousePlugin.onClick({clickCanvas:function(t,r){var i=this;if(t){t.sourceEvent&&(t=t.sourceEvent);var s=[t.clientX,t.clientY],l=o.proj.invert(r);e.pos=l,e.dot=null,e.mouse=s,e.country=null,o.options.showDots&&e.onCircleVals.forEach(function(n){e.dot=n.call(i,t,l)}),o.options.showLand&&!e.dot&&(o.drag||(a.countryCanvas?e.country=a.countryCanvas.detectCountry(l):e.country=n(l)),e.onCountryVals.forEach(function(n){n.call(i,t,e.country)}))}}})}function n(t){return e.countries.features.find(function(n){return n.geometry.coordinates.find(function(n){return d3.polygonContains(n,t)||n.find(function(n){return d3.polygonContains(n,t)})})})}var e={mouse:null,country:null,countries:null,onCircle:{},onCircleVals:[],onCountry:{},onCountryVals:[]};return{name:"clickCanvas",onInit:function(){t.call(this)},onCreate:function(){this.worldJson&&!e.world&&this.clickCanvas.allData(this.worldJson.allData())},onCircle:function(t){Object.assign(e.onCircle,t),e.onCircleVals=Object.keys(e.onCircle).map(function(t){return e.onCircle[t]})},onCountry:function(t){Object.assign(e.onCountry,t),e.onCountryVals=Object.keys(e.onCountry).map(function(t){return e.onCountry[t]})},data:function(t){if(!t)return e.world;e.world=t,e.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:e.world,countries:e.countries};e.world=t.world,e.countries=t.countries},state:function(){return{pos:e.pos,dot:e.dot,mouse:e.mouse,country:e.country}}}},mousePlugin:function(){function t(){c.onClickVals.forEach(function(t){t.call(c._this,c.event,c.mouse)})}function n(){c.onDblClickVals.forEach(function(t){t.call(c._this,c.event,c.mouse)})}function e(t){var n=t.versor,e=n.cartesian(t.proj.rotate(h).invert(c.mouse)),o=n.multiply(d,n.delta(u,e));c.r=n.rotation(o)}function o(t){var n=this;e(t),t.rotate(c.r),c.onDragVals.forEach(function(t){t.call(n,c.mouse)})}function a(){function a(t){var n=t[0]-h[0];t[0]=n+this._.proj.rotate()[0],t[0]>=180&&(t[0]-=360),this._.rotate(t)}var r=this._,i=r.versor,f=r.proj.scale(),p=[r.options.width,r.options.height];c.svg.call(d3.drag().on("start",function(){var t=d3.mouse(this);u=i.cartesian(r.proj.invert(t)),h=r.proj.rotate(),d=i(h),r.drag=null,r.refresh(),c.mouse=t,c._this=this,c.t1=0,c.t2=0}).on("end",function(){null===r.drag?(c.event=d3.event,r.options.spin?t():c.wait?(c.wait=null,n()):null===c.wait&&(c.wait=window.setTimeout(function(){c.wait&&(c.wait=!1)},250))):r.drag&&(e(r),r.rotate(c.r),c.onDragVals.forEach(function(t){t.call(c._this,c.mouse)}),c.sync.forEach(function(t){return a.call(t,c.r)})),r.drag=!1,r.refresh()}).on("drag",function(){r.drag=!0,c._this=this,c.mouse=d3.mouse(this),!l&&o(r)})),c.svg.call(d3.zoom().on("zoom",function(){var t=s,n=f*d3.event.transform.k;n>=t[0]&&n<=t[1]&&(r.scale(n),c.sync.forEach(function(t){return t._.scale(n)}))}).scaleExtent([.1,160]).translateExtent([[0,0],p]))}function r(){var n=this._;n.drag&&l?c.oMouse[0]!==c.mouse[0]&&c.oMouse[1]!==c.mouse[1]&&(c.oMouse=c.mouse,o(n)):!1===c.wait&&(c.wait=null,t())}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{zoomScale:[0,5e4]},s=i.zoomScale,l=i.intervalDrag,c={svg:null,q:null,sync:[],mouse:null,wait:null,onDrag:{},onDragVals:[],onClick:{},onClickVals:[],onDblClick:{},onDblClickVals:[]};void 0===s&&(s=[0,5e4]);var u=void 0,h=void 0,d=void 0;return{name:"mousePlugin",onInit:function(){c.oMouse=[];var t=this._;c.svg=t.svg,a.call(this)},onInterval:function(){r.call(this)},selectAll:function(t){return t&&(c.q=t,c.svg.call(d3.zoom().on("zoom start end",null)),c.svg.call(d3.drag().on("start",null).on("end",null).on("drag",null)),c.svg=d3.selectAll(t),a.call(this)),c.svg},sync:function(t){c.sync=t},mouse:function(){return c.mouse},onDrag:function(t){Object.assign(c.onDrag,t),c.onDragVals=Object.keys(c.onDrag).map(function(t){return c.onDrag[t]})},onClick:function(t){Object.assign(c.onClick,t),c.onClickVals=Object.keys(c.onClick).map(function(t){return c.onClick[t]})},onDblClick:function(t){Object.assign(c.onDblClick,t),c.onDblClickVals=Object.keys(c.onDblClick).map(function(t){return c.onDblClick[t]})}}},configPlugin:function(){return{name:"configPlugin",set:function(t){if(t){if(Object.assign(this._.options,t),void 0!==t.spin){var n=this.autorotatePlugin;t.spin?n.start():n.stop()}this.create()}return Object.assign({},this._.options)}}},canvasPlugin:function(){function t(){var t=this._;t.options.showCanvas=!0,o.path=d3.geoPath().projection(t.proj)}function n(){var t=this._;if(t.options.showCanvas){if(!o.canvas){var n=t.svg.append("g").attr("class","canvas").append("foreignObject").attr("x",0).attr("y",0).attr("width",t.options.width).attr("height",t.options.height).append("xhtml:body").style("margin","0px").style("padding","0px").style("background-color","none").style("width",t.options.width+"px").style("height",t.options.height+"px");o.canvas=n.append("canvas")}o.canvas.attr("x",0).attr("y",0).attr("width",t.options.width).attr("height",t.options.height)}o.canvas&&e.call(this)}function e(){var t=this._.options,n=t.width,e=t.height;o.canvas.each(function(){this.getContext("2d").clearRect(0,0,n,e)})}var o={canvas:null,path:null,q:null};return{name:"canvasPlugin",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){e.call(this)},selectAll:function(t){return t&&(o.q=t,o.canvas=d3.selectAll(t)),o.canvas},render:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=this._;if(a.options.showCanvas){var r=!1,i=a.proj,s=i.rotate(),l=this;o.canvas.each(function(a,c){if(!n||n.indexOf(c)>-1){var u=e[c]||{};u.rotate?(r=!0,i.rotate([s[0]+u.rotate,s[1],s[2]])):r&&(r=!1,i.rotate(s));var h=this.getContext("2d");t.call(l,h,o.path.context(h))}}),r&&(r=!1,i.rotate(s))}},flipRender:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=this._,a=o.center[0],r=o.proj.rotate();this.canvasPlugin.render(function(n,e){n.save(),n.translate(a,0),n.scale(-1,1),n.translate(-a,0),o.proj.rotate([r[0]+180,-r[1],-r[2]]),t.call(this,n,e),n.restore(),o.proj.rotate(r)},n,e)}}},countryCanvas:function(t){function n(){o.canvas=d3.select("body").append("canvas").attr("class","ej-hidden").attr("width","1024").attr("height","512").node(),o.context=o.canvas.getContext("2d"),o.proj=d3.geoEquirectangular().precision(.5).translate([512,256]).scale(163),o.path=d3.geoPath().projection(o.proj).context(o.context)}function e(){if(o.recreate){o.recreate=!1,o.context.clearRect(0,0,1024,512);for(var t=o.countries.features.length;t--;)o.context.beginPath(),o.path(o.countries.features[t]),o.context.fillStyle="rgb("+(t+1)+",0,0)",o.context.fill()}}var o={recreate:!0};return{name:"countryCanvas",urls:t&&[t],onReady:function(t,n){this.countryCanvas.data(n)},onInit:function(){n.call(this)},onCreate:function(){this.worldJson&&!o.world&&this.countryCanvas.allData(this.worldJson.allData()),e.call(this)},data:function(t){if(!t)return o.world;o.world=t,o.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:o.world,countries:o.countries};o.world=t.world,o.countries=t.countries},detectCountry:function(t){var n=o.proj(t);if(n[0]>0){var e=o.context.getImageData(n[0],n[1],1,1).data;return o.countries.features[e[0]-1]}}}},threejsPlugin:function(){function t(t){var n=t[0]*Math.PI/180,e=t[1]*Math.PI/180,o=Math.cos(e);return new THREE.Vector3(l*o*Math.cos(n),l*Math.sin(e),-l*o*Math.sin(n))}function n(n,e){var o=new THREE.Geometry;return n.coordinates.forEach(function(n){d3.pairs(n.map(t),function(t,n){o.vertices.push(t,n)})}),new THREE.LineSegments(o,e)}function e(){var t=this._;l=t.proj.scale();var n=t.options,e=n.width,o=n.height,a=document.getElementById(i);s.scale=d3.scaleLinear().domain([0,l]).range([0,1]),s.camera=new THREE.OrthographicCamera(-e/2,e/2,o/2,-o/2,.1,3e4),s.scene=new THREE.Scene,s.group=new THREE.Group,s.camera.position.z=3010,s.scene.add(s.group),this._.camera=s.camera,s.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,canvas:a}),s.renderer.setClearColor(0,0),s.renderer.setSize(e,o),s.renderer.sortObjects=!1,this.renderThree=r}function o(t){t||(t=s.group);var n=s.scale(this._.proj.scale());t.scale.x=n,t.scale.y=n,t.scale.z=n,r.call(this)}function a(t){t||(t=s.group);var n=this._,e=n.proj.rotate();e[0]-=90;var o=n.versor(e),a=new THREE.Quaternion(-o[2],o[1],o[3],o[0]);t.setRotationFromQuaternion(a),r.call(this)}function r(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?s.renderer.render(s.scene,s.camera):null===c&&(c=setTimeout(function(){s.renderer.render(s.scene,s.camera),c=null},0))}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"three-js",s={renderer:null,scene:null,camera:null},l=void 0,c=null;return{name:"threejsPlugin",onInit:function(){e.call(this)},onCreate:function(){s.group.children=[],r.call(this)},onRefresh:function(){a.call(this)},onResize:function(){o.call(this)},group:function(){return s.group},addGroup:function(t){s.group.add(t)},scale:function(t){o.call(this,t)},rotate:function(t){a.call(this,t)},vertex:function(n){return t(n)},wireframe:function(t,e){return n(t,e)},renderThree:function(){r.call(this)}}},dblClickCanvas:function(){function t(t){return e.countries.features.find(function(n){return n.geometry.coordinates.find(function(n){return d3.polygonContains(n,t)||n.find(function(n){return d3.polygonContains(n,t)})})})}function n(){if(this.worldCanvas){var n=this.worldCanvas.data();n&&(e.countries=topojson.feature(n,n.objects.countries))}var o=this._,a=this;this.mousePlugin&&this.mousePlugin.onDblClick({dblClickCanvas:function(n,r){var i=this;if(n){n.sourceEvent&&(n=n.sourceEvent);var s=[n.clientX,n.clientY],l=o.proj.invert(r);e.pos=l,e.dot=null,e.mouse=s,e.country=null,o.options.showDots&&e.onCircleVals.forEach(function(t){e.dot=t.call(i,n,l)}),o.options.showLand&&!e.dot&&(o.drag||(a.countryCanvas?e.country=a.countryCanvas.detectCountry(l):e.country=t(l)),e.onCountryVals.forEach(function(t){t.call(i,n,e.country)}))}}})}var e={mouse:null,country:null,countries:null,onCircle:{},onCircleVals:[],onCountry:{},onCountryVals:[]};return{name:"dblClickCanvas",onInit:function(){n.call(this)},onCreate:function(){this.worldJson&&!e.world&&this.dblClickCanvas.allData(this.worldJson.allData())},onCircle:function(t){Object.assign(e.onCircle,t),e.onCircleVals=Object.keys(e.onCircle).map(function(t){return e.onCircle[t]})},onCountry:function(t){Object.assign(e.onCountry,t),e.onCountryVals=Object.keys(e.onCountry).map(function(t){return e.onCountry[t]})},data:function(t){if(!t)return e.world;e.world=t,e.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:e.world,countries:e.countries};e.world=t.world,e.countries=t.countries},state:function(){return{pos:e.pos,dot:e.dot,mouse:e.mouse,country:e.country}}}},autorotatePlugin:function(){function t(){var t=this._.options;this.clickCanvas&&this.clickCanvas.onCountry({autorotatePlugin:function(n,e){e||(t.spin=!t.spin)}})}function n(t){if(t-r>40){r=t;var n=new Date;if(this._.options.spin&&!this._.drag){var o=n-a.lastTick;e.call(this,o),a.sync.forEach(function(t){return e.call(t,o)})}a.lastTick=n}}function e(t){var n=this._.proj.rotate();n[0]+=a.degree*t,this._.rotate(n)}var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a={lastTick:new Date,degree:o/1e3,sync:[]},r=0;return{name:"autorotatePlugin",onInit:function(){this._.options.spin=!0},onCreate:function(){t.call(this)},onInterval:function(t){n.call(this,t)},speed:function(t){a.degree=t/1e3},start:function(){this._.options.spin=!0},stop:function(){this._.options.spin=!1},sync:function(t){a.sync=t}}},oceanSvg:function(){function t(){var t=this._;this._.options.showOcean=!0,Object.defineProperty(t.options,"oceanColor",{get:function(){return a.oceanColor},set:function(t){a.oceanColor=t}}),a.svg=t.svg}function n(){if(a.svg.selectAll("#ocean,.ocean").remove(),this._.options.showOcean){var t=a.oceanColor,n=this.$slc.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");"number"==typeof t?(t=o[t],n.append("stop").attr("offset","5%").attr("stop-color",t[0])):"string"==typeof t&&(t=[t,t]),n.append("stop").attr("offset","100%").attr("stop-color",t[1]),r.ocean=a.svg.append("g").attr("class","ocean").append("circle").attr("cx",this._.center[0]).attr("cy",this._.center[1]).attr("class","noclicks"),e.call(this)}}function e(){r.ocean&&this._.options.showOcean&&r.ocean.attr("r",this._.proj.scale()+a.scale)}var o={0:["rgba(221, 221, 255, 0.6)","rgba(153, 170, 187,0.8)"],1:["rgba(159, 240, 232, 0.6)","rgba(  5, 242, 219,0.8)"],2:["rgba(152, 234, 242, 0.6)","rgba(  5, 219, 242,0.8)"],3:["rgba(114, 162, 181, 0.6)","rgba(  4, 138, 191,0.8)"],4:["rgba( 96, 123, 148, 0.6)","rgba( 10,  93, 166,0.8)"],5:["rgba( 87, 102, 131, 0.6)","rgba(  8,  52, 140,0.8)"]},a={svg:null,q:null,scale:0,oceanColor:0},r={};return{name:"oceanSvg",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onResize:function(){e.call(this)},selectAll:function(t){return t&&(a.q=t,a.svg=d3.selectAll(t)),a.svg},scale:function(t){if(!t)return a.scale;a.scale=t,e.call(this)},recreate:function(){n.call(this)},$ocean:function(){return r.ocean}}},sphereSvg:function(){function t(){var t=this._;t.options.showSphere=!0,o.svg=t.svg}function n(){o.svg.selectAll("#glow,.sphere").remove(),this._.options.showSphere&&(this.$slc.defs.nodes()[0].append("\n<filter id='glow'>\n    <feColorMatrix type='matrix'\n        values=\n        '0 0 0 0   0\n         0 0 0 0.9 0\n         0 0 0 0.9 0\n         0 0 0 1   0'/>\n    <feGaussianBlur stdDeviation='5.5' result='coloredBlur'/>\n    <feMerge>\n        <feMergeNode in='coloredBlur'/>\n        <feMergeNode in='SourceGraphic'/>\n    </feMerge>\n</filter>\n"),a.sphere=o.svg.append("g").attr("class","sphere").append("circle").attr("cx",this._.center[0]).attr("cy",this._.center[1]).attr("class","noclicks").attr("filter","url(#glow)"),e.call(this))}function e(){a.sphere.attr("r",this._.proj.scale())}var o={svg:null,q:null,sphereColor:0},a={};return{name:"sphereSvg",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onResize:function(){e.call(this)},selectAll:function(t){return t&&(o.q=t,o.svg=d3.selectAll(t)),o.svg},$sphere:function(){return a.sphere}}},zoomPlugin:function(){function t(){var t=this._,n=t.proj.scale(),e=[t.options.width,t.options.height];t.svg.call(d3.zoom().on("zoom start end",function(){var e=d3.event.transform;t.proj.scale(n*e.k),t.resize(),t.refresh()}).scaleExtent([.1,5]).translateExtent([[0,0],e]))}return{name:"zoomPlugin",onInit:function(){t.call(this)}}},fauxGlobeSvg:function(){function t(){var t=this._;t.options.showGlobeShading=!0,t.options.showGlobeHilight=!0,r.svg=t.svg}function n(){e.call(this),o.call(this)}function e(){var t=this._;if(r.svg.selectAll("#shading,.shading").remove(),t.options.showGlobeShading){var n=this.$slc.defs.append("radialGradient").attr("id","shading").attr("cx","50%").attr("cy","40%");n.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),n.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),i.globeShading=r.svg.append("g").attr("class","shading").append("circle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale()).attr("class","noclicks").style("fill","url(#shading)")}}function o(){var t=this._;if(r.svg.selectAll("#hilight,.hilight").remove(),t.options.showGlobeHilight){var n=this.$slc.defs.append("radialGradient").attr("id","hilight").attr("cx","75%").attr("cy","25%");n.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),n.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),i.globeHilight=r.svg.append("g").attr("class","hilight").append("circle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale()).attr("class","noclicks").style("fill","url(#hilight)")}}function a(){var t=this._,n=t.options,e=t.proj.scale();i.globeShading&&n.showGlobeShading&&i.globeShading.attr("r",e),i.globeHilight&&n.showGlobeHilight&&i.globeHilight.attr("r",e)}var r={svg:null,q:null},i={};return{name:"fauxGlobeSvg",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onResize:function(){a.call(this)},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg},$globeShading:function(){return i.globeShading},$globeHilight:function(){return i.globeHilight}}},graticuleSvg:function(){function t(){var t=this._;t.options.showGraticule=!0,t.options.transparentGraticule=!1,o.svg=t.svg}function n(){o.svg.selectAll(".graticule").remove(),this._.options.showGraticule&&(a.graticule=o.svg.append("g").attr("class","graticule").append("path").datum(o.graticule).attr("class","noclicks"),e.call(this))}function e(){var t=this._;a.graticule&&t.options.showGraticule&&(t.options.transparent||t.options.transparentGraticule?(t.proj.clipAngle(180),a.graticule.attr("d",this._.path),t.proj.clipAngle(90)):a.graticule.attr("d",this._.path))}var o={svg:null,q:null,graticule:d3.geoGraticule()},a={};return{name:"graticuleSvg",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){e.call(this)},selectAll:function(t){return t&&(o.q=t,o.svg=d3.selectAll(t)),o.svg},$graticule:function(){return a.graticule}}},dropShadowSvg:function(){function t(){var t=this._;t.options.showDropShadow=!0,o.svg=t.svg}function n(){var t=this._;if(o.svg.selectAll("#drop_shadow,.drop_shadow").remove(),t.options.showDropShadow){var n=this.$slc.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");n.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),n.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),a.dropShadow=o.svg.append("g").attr("class","drop_shadow").append("ellipse").attr("cx",t.center[0]).attr("class","noclicks").style("fill","url(#drop_shadow)"),e.call(this)}}function e(){var t=this._.proj.scale();a.dropShadow.attr("cy",t+this._.center[1]).attr("rx",.9*t).attr("ry",.25*t)}var o={svg:null,q:null},a={};return{name:"dropShadowSvg",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onResize:function(){a.dropShadow&&this._.options.showDropShadow&&e.call(this)},selectAll:function(t){return t&&(o.q=t,o.svg=d3.selectAll(t)),o.svg},$dropShadow:function(){return a.dropShadow}}},dotTooltipSvg:function(){function t(){var t=this;this.dotsSvg.$dots().on("mouseover",function(){if(t._.options.showBarTooltip){o.visible=!0,o.mouseXY=[d3.event.pageX+7,d3.event.pageY-15];var e=+this.dataset.index,r=t.dotsSvg.data().features[e];t.dotTooltipSvg.onShow&&(r=t.dotTooltipSvg.onShow.call(this,r,a)),t.dotTooltipSvg.show(r.properties).style("display","block").style("opacity",1),n()}}).on("mouseout",function(){o.visible=!1,a.style("opacity",0).style("display","none")}).on("mousemove",function(){t._.options.showBarTooltip&&(o.mouseXY=[d3.event.pageX+7,d3.event.pageY-15],n())})}function n(){a.style("left",o.mouseXY[0]+7+"px").style("top",o.mouseXY[1]-15+"px")}function e(){t.call(this),a.style("opacity",0).style("display","none")}var o={mouseXY:[0,0],visible:!1},a=d3.select("body").append("div").attr("class","ej-dot-tooltip");return{name:"dotTooltipSvg",onInit:function(){this._.options.showBarTooltip=!0},onCreate:function(){t.call(this)},onRefresh:function(){n.call(this)},onResize:function(){e.call(this)},show:function(t){var n=Object.keys(t).map(function(n){return n+": "+t[n]}).join("<br/>");return a.html(n)},visible:function(){return o.visible}}},dotSelectCanvas:function(){function t(t){var n=null,o=this.hoverCanvas.states().mouse;return e.dots.forEach(function(e){o&&!n&&d3.geoDistance(e.coordinates,t)<=.02&&(n=e)}),n}function n(){var n=this;if(this.hoverCanvas){var o=function(o,a){var r=t.call(n,a);return e.onHoverVals.forEach(function(t){t.call(n,o,r)}),r};this.hoverCanvas.onCircle({dotsCanvas:o})}if(this.clickCanvas){var a=function(o,a){var r=t.call(n,a);return e.onClickVals.forEach(function(t){t.call(n,o,r)}),r};this.clickCanvas.onCircle({dotsCanvas:a})}if(this.dblClickCanvas){var r=function(o,a){var r=t(o,a);return e.onDblClickVals.forEach(function(t){t.call(n,o,r)}),r};this.dblClickCanvas.onCircle({dotsCanvas:r})}}var e={dataDots:null,dots:null,radiusPath:null,onHover:{},onHoverVals:[],onClick:{},onClickVals:[],onDblClick:{},onDblClickVals:[]};return{name:"dotSelectCanvas",onInit:function(){n.call(this)},onCreate:function(){this.dotsCanvas&&!e.dots&&this.dotSelectCanvas.dots(this.dotsCanvas.dots())},onHover:function(t){Object.assign(e.onHover,t),e.onHoverVals=Object.keys(e.onHover).map(function(t){return e.onHover[t]})},onClick:function(t){Object.assign(e.onClick,t),e.onClickVals=Object.keys(e.onClick).map(function(t){return e.onClick[t]})},onDblClick:function(t){Object.assign(e.onDblClick,t),e.onDblClickVals=Object.keys(e.onDblClick).map(function(t){return e.onDblClick[t]})},dots:function(t){e.dots=t}}},graticuleCanvas:function(){function t(){var t=this._;t.options.showGraticule=!0,t.options.transparentGraticule=!1}function n(){var t=this._;t.options.showGraticule&&((t.options.transparent||t.options.transparentGraticule)&&t.proj.clipAngle(180),this.canvasPlugin.render(function(t,n){t.beginPath(),n(e),t.lineWidth=.4,t.strokeStyle=o.style.line||"rgba(119,119,119,0.6)",t.stroke()},o.drawTo),(t.options.transparent||t.options.transparentGraticule)&&t.proj.clipAngle(90))}var e=d3.geoGraticule()(),o={style:{},drawTo:null};return{name:"graticuleCanvas",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){n.call(this)},drawTo:function(t){o.drawTo=t},style:function(t){return t&&(o.style=t),o.style}}},dotTooltipCanvas:function(){function t(){var t=this;this.dotSelectCanvas.onHover({dotTooltipCanvas:function(e,o){if(o){t.dotTooltipCanvas.onShow&&(o=t.dotTooltipCanvas.onShow.call(t,o,n));var a=t.hoverCanvas.states().mouse;t.dotTooltipCanvas.show(o.properties).style("display","block").style("opacity",1).style("left",a[0]+7+"px").style("top",a[1]-15+"px")}else n.style("opacity",0).style("display","none")}})}var n=d3.select("body").append("div").attr("class","ej-dot-tooltip");return{name:"dotTooltipCanvas",onInit:function(){t.call(this)},show:function(t){var e=Object.keys(t).map(function(n){return n+": "+t[n]}).join("<br/>");return n.html(e)}}},countrySelectCanvas:function(){function t(){var t=this;if(this.hoverCanvas){var n=function(n,o){return e.onHoverVals.forEach(function(e){e.call(t,n,o)}),o};this.hoverCanvas.onCountry({countrySelectCanvas:n})}if(this.clickCanvas){var o=function(n,o){return e.onClickVals.forEach(function(e){e.call(t,n,o)}),o};this.clickCanvas.onCountry({countrySelectCanvas:o})}if(this.dblClickCanvas){var a=function(n,o){return e.onDblClickVals.forEach(function(e){e.call(t,n,o)}),o};this.dblClickCanvas.onCountry({countrySelectCanvas:a})}}function n(){if(this.worldCanvas&&!e.countries){var t=this.worldCanvas.data();t&&(e.world=t,e.countries=topojson.feature(t,t.objects.countries))}}var e={countries:null,onHover:{},onHoverVals:[],onClick:{},onClickVals:[],onDblClick:{},onDblClickVals:[]};return{name:"countrySelectCanvas",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onHover:function(t){Object.assign(e.onHover,t),e.onHoverVals=Object.keys(e.onHover).map(function(t){return e.onHover[t]})},onClick:function(t){Object.assign(e.onClick,t),e.onClickVals=Object.keys(e.onClick).map(function(t){return e.onClick[t]})},onDblClick:function(t){Object.assign(e.onDblClick,t),e.onDblClickVals=Object.keys(e.onDblClick).map(function(t){return e.onDblClick[t]})},data:function(t){if(!t)return e.world;e.world=t,e.countries=topojson.feature(t,t.objects.countries)}}},countryTooltipCanvas:function(t){function n(t){var n="";return i.countryNames&&(n=i.countryNames.find(function(n){return n.id==t.id})),n}function e(){var t=this,e=function(e,r){if(!t._.drag&&r&&t._.options.showCountryTooltip){var i=n(r);!i||t.barTooltipSvg&&t.barTooltipSvg.visible()?a():o([e.clientX,e.clientY]).style("display","block").style("opacity",1).text(i.name)}else a()};this.hoverCanvas.onCountry({countryTooltipCanvas:e}),this.mousePlugin&&this.mousePlugin.onDrag({countryTooltipCanvas:e}),this._.options.showCountryTooltip=!0}function o(t){return r.style("left",t[0]+7+"px").style("top",t[1]-15+"px")}function a(){r.style("opacity",0).style("display","none")}var r=d3.select("body").append("div").attr("class","ej-country-tooltip"),i={};return{name:"countryTooltipCanvas",urls:t&&[t],onReady:function(t,n){i.countryNames=n},onInit:function(){e.call(this)},onRefresh:function(){this._.drag&&o(this.mousePlugin.mouse())},data:function(t){if(!t)return i.countryNames;i.countryNames=t}}},countryTooltipSvg:function(t){function n(t){var n="";return a.countryNames&&(n=a.countryNames.find(function(n){return n.id==t.id})),n}function e(){var t=this;this.worldSvg.$countries().on("mouseover",function(e){if(t._.options.showCountryTooltip){a.show=!0;var r=n(e);o().style("display","block").style("opacity",1).text(r.name)}}).on("mouseout",function(){a.show=!1,r.style("opacity",0).style("display","none")}).on("mousemove",function(){t._.options.showCountryTooltip&&o()})}function o(t){return t||(t=[d3.event.pageX,d3.event.pageY]),r.style("left",t[0]+7+"px").style("top",t[1]-15+"px")}var a={show:!1},r=d3.select("body").append("div").attr("class","ej-country-tooltip");return{name:"countryTooltipSvg",urls:t&&[t],onReady:function(t,n){a.countryNames=n},onInit:function(){this._.options.showCountryTooltip=!0},onCreate:function(){e.call(this)},onRefresh:function(){this._.drag&&a.show&&o(this.mousePlugin.mouse())},data:function(t){if(!t)return a.countryNames;a.countryNames=t}}},barTooltipSvg:function(){function t(){var t=this;this.barSvg.$bar().on("mouseover",function(){if(t._.options.showBarTooltip){o.visible=!0,o.mouseXY=[d3.event.pageX+7,d3.event.pageY-15];var e=+this.dataset.index,r=t.barSvg.data().features[e];t.barTooltipSvg.onShow&&(r=t.barTooltipSvg.onShow.call(this,r,a)),t.barTooltipSvg.show(r).style("display","block").style("opacity",1),n()}}).on("mouseout",function(){o.visible=!1,a.style("opacity",0).style("display","none")}).on("mousemove",function(){t._.options.showBarTooltip&&(o.mouseXY=[d3.event.pageX+7,d3.event.pageY-15],n())})}function n(){a.style("left",o.mouseXY[0]+7+"px").style("top",o.mouseXY[1]-15+"px")}function e(){t.call(this),a.style("opacity",0).style("display","none")}var o={mouseXY:[0,0],visible:!1},a=d3.select("body").append("div").attr("class","ej-bar-tooltip");return{name:"barTooltipSvg",onInit:function(){this._.options.showBarTooltip=!0},onCreate:function(){t.call(this)},onRefresh:function(){n.call(this)},onResize:function(){e.call(this)},show:function(t){var n=t.properties,e=Object.keys(n).map(function(t){return t+": "+n[t]}).join("<br/>");return a.html(e)},visible:function(){return o.visible}}},worldCanvas:function(t){function n(){var t=this._;if(i.world&&((t.options.transparent||t.options.transparentLand)&&this.canvasPlugin.flipRender(function(t,n){t.beginPath(),n(i.land),t.fillStyle=i.style.backLand||"rgba(119,119,119,0.2)",t.fill()},i.drawTo,i.options),t.options.showLand?(t.options.showCountries?o.call(this):e.call(this),!t.drag&&t.options.showLakes&&a.call(this)):t.options.showBorder&&o.call(this,!0),this.hoverCanvas&&t.options.showSelectedCountry)){i.selected.features.length>0&&this.canvasPlugin.render(function(t,n){t.beginPath(),n(i.selected),t.fillStyle=i.style.selected||"rgba(87, 255, 99, 0.4)",t.fill()},i.drawTo,i.options);var n=this.hoverCanvas.states().country;n&&!i.selected.features.find(function(t){return t.id===n.id})&&this.canvasPlugin.render(function(t,e){t.beginPath(),e(n),t.fillStyle=i.style.hover||"rgba(117, 0, 0, 0.4)",t.fill()},i.drawTo,i.options)}}function e(){this.canvasPlugin.render(function(t,n){var e=i.landColor;t.beginPath(),n(i.land),t.fillStyle=i.style.land||("number"==typeof e?r[e]:e),t.fill()},i.drawTo,i.options)}function o(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.canvasPlugin.render(function(n,e){var o=i.landColor;n.beginPath(),e(i.countries),t||(n.fillStyle=i.style.countries||i.style.land||("number"==typeof o?r[o]:o),n.fill()),n.lineWidth=.1,n.strokeStyle=i.style.border||"rgb(239, 237, 234)",n.stroke()},i.drawTo,i.options)}function a(){this.canvasPlugin.render(function(t,n){t.beginPath(),n(i.lakes),t.fillStyle=i.style.lakes||"rgba(80, 87, 97, 0.4)",t.fill()},i.drawTo,i.options)}var r={0:"rgba(117, 87, 57, 0.6)",1:"rgba(138, 96, 56, 0.6)",2:"rgba(140,104, 63, 0.6)",3:"rgba(149,114, 74, 0.6)",4:"rgba(153,126, 87, 0.6)",5:"rgba(155,141,115, 0.6)"},i={world:null,style:{},options:{},drawTo:null,landColor:0,selected:{type:"FeatureCollection",features:[]}};return{name:"worldCanvas",urls:t&&[t],onReady:function(t,n){this.worldCanvas.data(n),Object.defineProperty(this._.options,"landColor",{get:function(){return i.landColor},set:function(t){i.landColor=t}})},onInit:function(){var t=this._.options;t.showLand=!0,t.showLakes=!0,t.showBorder=!1,t.showCountries=!0,t.transparentLand=!1,t.landColor=0},onCreate:function(){var t=this;if(this.worldJson&&!i.world&&this.worldCanvas.allData(this.worldJson.allData()),n.call(this),this.hoverCanvas){var e=function(){t._.options.spin||t._.refresh()};this.hoverCanvas.onCountry({worldCanvas:e})}},onRefresh:function(){n.call(this)},countries:function(t){if(!t)return i.countries.features;i.countries.features=t},selectedCountries:function(t){if(!t)return i.selected.features;i.selected.features=t},data:function(t){if(!t)return i.world;i.world=t,i.land=topojson.feature(t,t.objects.land),i.lakes=topojson.feature(t,t.objects.ne_110m_lakes),i.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:i.world,land:i.land,lakes:i.lakes,countries:i.countries};i.world=t.world,i.land=t.land,i.lakes=t.lakes,i.countries=t.countries},drawTo:function(t){i.drawTo=t},style:function(t){return t&&(i.style=t),i.style},options:function(t){i.options=t}}},centerSvg:function(){function t(t,n){n=n.replace("x","");for(var e=0,o=t.length;e<o;e++)if(t[e].id==n)return t[e]}function n(t){var n=this._,e=d3.interpolate(n.proj.rotate(),[-t[0],-t[1],0]),o=function(t){return n.rotate(e(t))};d3.transition().duration(2500).tween("rotate",function(){return o})}function e(){var e=this;this.worldSvg.$countries().on("click",function(){if(e._.options.enableCenter){var a=this.id.replace("x",""),r=t(e.worldSvg.countries(),a);n.call(e,d3.geoCentroid(r)),"function"==typeof o.focused&&o.focused.call(e)}})}var o={focused:null,svgAddCountriesOld:null};return{name:"centerSvg",onInit:function(){this._.options.enableCenter=!0},onCreate:function(){e.call(this)},go:function(e){var o=t(this.worldSvg.countries(),e),a=d3.geoCentroid(o);n.call(this,a)},focused:function(t){o.focused=t}}},placesSvg:function(t){function n(){var t=this._;t.options.showPlaces=!0,s.svg=t.svg}function e(){s.svg.selectAll(".points,.labels").remove(),s.places&&this._.options.showPlaces&&(o.call(this),a.call(this),i.call(this))}function o(){l.placePoints=s.svg.append("g").attr("class","points").selectAll("path").data(s.places.features).enter().append("path").attr("class","point")}function a(){l.placeLabels=s.svg.append("g").attr("class","labels").selectAll("text").data(s.places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name})}function r(){var t=this,n=this._.proj.invert(this._.center);l.placeLabels.attr("text-anchor",function(n){var e=t._.proj(n.geometry.coordinates)[0];return e<t._.center[0]-20?"end":e<t._.center[0]+20?"middle":"start"}).attr("transform",function(n){var e=t._.proj(n.geometry.coordinates),o=e[0],a=e[1];return"translate("+(o+(o<t._.center[0]?-5:5))+","+(a-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}function i(){l.placePoints&&(l.placePoints.attr("d",this._.path),r.call(this))}var s={svg:null,q:null,places:null},l={};return{name:"placesSvg",urls:t&&[t],onReady:function(t,n){s.places=n},onInit:function(){n.call(this)},onCreate:function(){e.call(this)},onRefresh:function(){i.call(this)},data:function(t){if(!t)return s.places;s.places=t},selectAll:function(t){return t&&(s.q=t,s.svg=d3.selectAll(t)),s.svg},$placePoints:function(){return l.placePoints},$placeLabels:function(){return l.placeLabels}}},worldSvg:function(t){function n(){var t=this._;s.svg.selectAll(".landbg,.land,.lakes,.countries").remove(),t.options.showLand&&(s.world&&((t.options.transparent||t.options.transparentLand)&&s.svgAddWorldBg.call(this),t.options.showCountries?s.svgAddCountries.call(this):s.svgAddWorld.call(this),!t.drag&&t.options.showLakes&&s.svgAddLakes.call(this)),e.call(this))}function e(){var t=this._;s.world&&((t.options.transparent||t.options.transparentLand)&&(t.proj.clipAngle(180),l.worldBg.attr("d",t.path),t.proj.clipAngle(90)),t.options.showLand&&(t.options.showCountries?l.countries.attr("d",t.path):l.world.attr("d",t.path),t.options.showLakes&&l.lakes.attr("d",t.path)))}function o(){l.worldBg=s.svg.append("g").attr("class","landbg").append("path").datum(s.land).attr("fill","rgba(119,119,119,0.2)")}function a(){l.world=s.svg.append("g").attr("class","land").append("path").datum(s.land)}function r(){l.countries=s.svg.append("g").attr("class","countries").selectAll("path").data(s.countries.features).enter().append("path").attr("id",function(t){return"x"+t.id})}function i(){l.lakes=s.svg.append("g").attr("class","lakes").append("path").datum(s.lakes)}var s={svg:null,q:null,world:null},l={};return{name:"worldSvg",urls:t&&[t],onReady:function(t,n){this.worldSvg.data(n)},onInit:function(){var t=this._,n=t.options;n.showLand=!0,n.showLakes=!0,n.showCountries=!0,n.transparentLand=!1,s.svgAddCountries=r,s.svgAddWorldBg=o,s.svgAddLakes=i,s.svgAddWorld=a,s.svg=t.svg},onCreate:function(){this.worldJson&&!s.world&&this.worldSvg.allData(this.worldJson.allData()),n.call(this)},onRefresh:function(){e.call(this)},countries:function(){return s.countries.features},data:function(t){if(!t)return s.world;s.world=t,s.land=topojson.feature(t,t.objects.land),s.lakes=topojson.feature(t,t.objects.ne_110m_lakes),s.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:s.world,land:s.land,lakes:s.lakes,countries:s.countries};s.world=t.world,s.land=t.land,s.lakes=t.lakes,s.countries=t.countries},selectAll:function(t){return t&&(s.q=t,s.svg=d3.selectAll(t)),s.svg},$world:function(){return l.world},$lakes:function(){return l.lakes},$countries:function(){return l.countries}}},barSvg:function(t){function n(){var t=this._;t.options.showBars=!0,r.barProjection=t.orthoGraphic(),r.svg=t.svg}function e(){var t=this._;if(a.call(this),r.svg.selectAll(".bar").remove(),r.bars&&t.options.showBars){var n=r.svg.append("g").attr("class","bar"),e=n.append("mask").attr("id","edge");e.append("rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","white"),e.append("use").attr("xlink:href","#edgeCircle").attr("fill","black"),r.max=d3.max(r.bars.features,function(t){return parseInt(t.geometry.value)});var l=t.proj.scale();r.heightScale=d3.scaleLinear().domain([0,r.max]).range([l,l+s(l)]),i.bar=n.selectAll("line").data(r.bars.features).enter().append("line").attr("stroke","red").attr("stroke-width","2").attr("data-index",function(t,n){return n}),o.call(this)}}function o(){var t=this._;if(r.bars&&t.options.showBars){var n=t.proj,e=r.heightScale,o=r.barProjection,a=n.invert(t.center);o.rotate(this._.proj.rotate()),i.bar.each(function(t){var r=t.geometry.coordinates;o.scale(e(t.geometry.value));var i=d3.geoDistance(r,a),s=n(r),l=o(r);d3.select(this).attr("x1",s[0]).attr("y1",s[1]).attr("x2",l[0]).attr("y2",l[1]).attr("mask",i<1.57?null:"url(#edge)")})}}function a(){var t=this._;this.$slc.defs.selectAll("clipPath").remove(),this.$slc.defs.append("clipPath").append("circle").attr("id","edgeCircle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale())}var r={svg:null,barProjection:null,q:null,bars:null,valuePath:null},i={},s=d3.scaleLinear().domain([0,200]).range([5,50]);return{name:"barSvg",urls:t&&[t],onReady:function(t,n){this.barSvg.data(n)},onInit:function(){n.call(this)},onCreate:function(){e.call(this)},onRefresh:function(){o.call(this)},onResize:function(){e.call(this)},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg},valuePath:function(t){r.valuePath=t},data:function(t){var n=this;if(!t)return r.bars;if(r.valuePath){var e=r.valuePath.split(".");t.features.forEach(function(t){var n=t;e.forEach(function(t){return n=n[t]}),t.geometry.value=n})}r.bars=t,setTimeout(function(){return o.call(n)},1)},$bar:function(){return i.bar}}},dotsSvg:function(t){function n(){var t=this._;t.options.showDots=!0,i.svg=t.svg}function e(){var t=this._;if(i.svg.selectAll(".dot").remove(),i.dataDots&&t.options.showDots){var n=[];if(i.circles.forEach(function(t){n.push(t.circle)}),s.dots=i.svg.append("g").attr("class","dot").selectAll("path").data(n).enter().append("path"),i.dataDots.geometry){var e=i.dataDots.geometry||{};s.dots.style("stroke-width",e.lineWidth||.2).style("fill",e.fillStyle||"rgba(100,0,0,.4)").style("stroke",e.strokeStyle||"rgba(119,119,119,.4)").attr("data-index",function(t,n){return n})}o.call(this)}}function o(){var t=this._,n=void 0,e=void 0;if(s.dots&&t.options.showDots){var o=i.dataDots.geometry||{};t.options.transparent||t.options.transparentDots?(t.proj.clipAngle(180),s.dots.style("fill",function(a,r){return n=a.coordinates[0][r],(e=d3.geoDistance(n,t.proj.invert(t.center)))>1.57?"none":o.fillStyle||"rgba(100,0,0,.4)"}),s.dots.style("display",function(){return t.drag&&!r?"none":"inline"}),s.dots.attr("d",t.path),t.proj.clipAngle(90)):(s.dots.style("display",function(o,a){return n=o.coordinates[0][a],(e=d3.geoDistance(n,t.proj.invert(t.center)))>1.57||t.drag&&!r?"none":"inline"}),s.dots.style("fill",o.fillStyle||"rgba(100,0,0,.4)"),s.dots.attr("d",t.path))}}function a(){var t=d3.geoCircle(),n=(i.dataDots.geometry||{}).radius||.5;i.circles=i.dataDots.features.map(function(e){var o=e.geometry.coordinates,a=e.properties,r=e.geometry.radius||n;return{properties:a,coordinates:o,circle:t.center(o).radius(r)()}})}var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).important,i={dataDots:null,radiusPath:null},s={};return{name:"dotsSvg",urls:t&&[t],onReady:function(t,n){this.dotsSvg.data(n)},onInit:function(){n.call(this)},onCreate:function(){e.call(this)},onRefresh:function(){o.call(this)},radiusPath:function(t){i.radiusPath=t},data:function(t){var n=this;if(!t)return i.dataDots;if(i.radiusPath){var e=i.radiusPath.split("."),r=t.features.map(function(t){var n=t;return e.forEach(function(t){return n=n[t]}),n}).sort(),s=d3.scaleLinear().domain([r[0],r.pop()]).range([.5,2]);t.features.forEach(function(t){var n=t;e.forEach(function(t){return n=n[t]}),t.geometry.radius=s(n)})}i.dataDots=t,a(),setTimeout(function(){return o.call(n)},1)},selectAll:function(t){return t&&(i.q=t,i.svg=d3.selectAll(t)),i.svg},$dots:function(){return s.dots}}},pingsSvg:function(){function t(){var t=this,n=this._;n.options.showPings=!0,setInterval(function(){return e.call(t)},3e3),a.svg=n.svg}function n(){if(a.svg.selectAll(".pings").remove(),a.dataPings&&this._.options.showPings){var t=a.svg.append("g").attr("class","pings");r.ping2=t.selectAll(".ping-2").data(a.dataPings.features).enter().append("circle").attr("class","ping-2").attr("id",function(t,n){return"ping-"+n}),r.pings=t.selectAll(".ping-2"),o.call(this),e.call(this)}}function e(){var t=r.ping2.nodes().filter(function(t){return"inline"==t.style.display});t.length>0&&d3.select("#"+t[Math.floor(Math.random()*(t.length-1))].id).attr("r",2).attr("stroke","#F00").attr("stroke-opacity",1).attr("stroke-width","10px").transition().duration(1e3).attr("r",30).attr("fill","none").attr("stroke-width","0.1px")}function o(){if(null==this._.drag)r.pings.style("display","none");else if(!this._.drag&&r.pings&&this._.options.showPings){var t=this._.proj,n=this._.proj.invert(this._.center);r.pings.attr("cx",function(n){return t(n.geometry.coordinates)[0]}).attr("cy",function(n){return t(n.geometry.coordinates)[1]}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}}var a={svg:null,dataPings:null},r={};return{name:"pingsSvg",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){o.call(this)},data:function(t){if(!t)return a.dataPings;a.dataPings=t},selectAll:function(t){return t&&(a.q=t,a.svg=d3.selectAll(t)),a.svg},$pings:function(){return r.pings}}},pinCanvas:function(t,n){function e(t){this._.options.showPin=!0;var n=this._.proj.scale();i.w=d3.scaleLinear().domain([0,n]).range([0,t[0]]),i.h=d3.scaleLinear().domain([0,n]).range([0,t[1]]),a.call(this)}function o(){if(this._.options.showPin){var t=this._,n=t.proj.invert(t.center);this.canvasPlugin.render(function(e){i.dataPin.features.forEach(function(o){var a=o.geometry.coordinates;if(d3.geoDistance(a,n)<=1.57){var r=t.path.centroid(o);e.drawImage(i.image,r[0]-i.pX,r[1]-i.pY,i.wh[0],i.wh[1])}})},i.drawTo)}}function a(){var t=this._.proj.scale(),n=[i.w(t),i.h(t)];i.wh=n,i.pX=n[0]/2,i.pY=n[1]}var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[15,25],i={dataPin:null,image:null,w:null,h:null};return d3.select("body").append("img").attr("src",n).attr("id","pin").attr("width","0").attr("height","0"),i.image=document.getElementById("pin"),{name:"pinCanvas",urls:t&&[t],onReady:function(t,n){this.pinCanvas.data(n)},onInit:function(){e.call(this,r)},onCreate:function(){var t=this;setTimeout(function(){return o.call(t)},1)},onResize:function(){a.call(this)},onRefresh:function(){o.call(this)},data:function(t){if(!t)return i.dataPin;i.dataPin=t},drawTo:function(t){i.drawTo=t},image:function(){return i.image},size:function(t){if(!t)return i.wh;i.wh=t,e.call(this,t)}}},dotsCanvas:function(t){function n(){var t=this._;if((!t.drag||o)&&a.dataDots&&this._.options.showDots){var n=this._.proj,e=a.dataDots.geometry||{},r=n.invert(this._.center),i=[],s=[];a.dots.forEach(function(t){d3.geoDistance(t.coordinates,r)>1.57?i.push(t.circle):s.push(t.circle)}),(t.options.transparent||t.options.transparentDots)&&this.canvasPlugin.flipRender(function(t,n){t.beginPath(),n({type:"GeometryCollection",geometries:i}),t.lineWidth=.2,t.strokeStyle="rgba(119,119,119,.4)",t.stroke()},a.drawTo),this.canvasPlugin.render(function(t,n){t.beginPath(),n({type:"GeometryCollection",geometries:s}),t.lineWidth=e.lineWidth||.2,t.fillStyle=e.fillStyle||"rgba(100,0,0,.4)",t.strokeStyle=e.strokeStyle||"rgba(100,0,0,.6)",t.fill(),t.stroke()},a.drawTo)}}function e(){var t=d3.geoCircle(),n=(a.dataDots.geometry||{}).radius||.5;a.dots=a.dataDots.features.map(function(e){var o=e.geometry.coordinates,a=e.properties,r=e.geometry.radius||n;return{properties:a,coordinates:o,circle:t.center(o).radius(r)()}})}var o=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).important,a={dataDots:null,dots:[],radiusPath:null};return{name:"dotsCanvas",urls:t&&[t],onReady:function(t,n){this.dotsCanvas.data(n)},onInit:function(){this._.options.transparentDots=!1,this._.options.showDots=!0},onCreate:function(){n.call(this)},onRefresh:function(){(o||!0!==this._.drag)&&n.call(this)},radiusPath:function(t){a.radiusPath=t},data:function(t){var o=this;if(!t)return a.dataDots;if(a.radiusPath){var r=a.radiusPath.split("."),i=t.features.map(function(t){var n=t;return r.forEach(function(t){return n=n[t]}),n}).sort(),s=d3.scaleLinear().domain([i[0],i.pop()]).range([.5,2]);t.features.forEach(function(t){var n=t;r.forEach(function(t){return n=n[t]}),t.geometry.radius=s(n)})}a.dataDots=t,e(),setTimeout(function(){return n.call(o)},1)},drawTo:function(t){a.drawTo=t},dots:function(){return a.dots}}},pingsCanvas:function(){function t(t){if(t-e>40&&(e=t,!this._.drag&&this._.options.showPings)){var o=void 0,a=this._.proj;if(n.pings.length<=7){o=this._.proj.invert(this._.center);var r=n.dataPings.features.filter(function(t){return d3.geoDistance(t.geometry.coordinates,o)<=1.57}),i=r[Math.floor(Math.random()*(r.length-1))];n.pings.push({r:2.5,l:i.geometry.coordinates})}var s=n.pings[0];d3.geoDistance(s.l,this._.proj.invert(this._.center))>1.57?n.pings.shift():(this._.options.spin||this._.refresh(/anvas/),this.canvasPlugin.render(function(t){if(t.beginPath(),t.fillStyle="#F80",t.arc(a(s.l)[0],a(s.l)[1],s.r,0,2*Math.PI),t.fill(),t.closePath(),s.r=s.r+.2,s.r>5)n.pings.shift();else if(n.pings.length>1){var e=n.pings.shift();n.pings.push(e)}},n.drawTo))}}var n={dataPings:null,pings:[]},e=0;return{name:"pingsCanvas",onInit:function(){this._.options.showPings=!0},onInterval:function(n){t.call(this,n)},data:function(t){if(!t)return n.dataPings;n.dataPings=t},drawTo:function(t){n.drawTo=t}}},centerCanvas:function(){function t(t,n){n=(""+n).replace("x","");for(var e=0,o=t.length;e<o;e++)if(t[e].id==n)return t[e]}function n(t){var n=this._,e=d3.interpolate(n.proj.rotate(),[-t[0],-t[1],0]),o=function(t){return n.rotate(e(t))};d3.transition().duration(2500).tween("rotate",function(){return o})}function e(){var t=this;this.clickCanvas&&this.clickCanvas.onCountry({centerCanvas:function(e,a){a&&(n.call(t,d3.geoCentroid(a)),"function"==typeof o.focused&&o.focused.call(t,e,a))}})}var o={focused:null};return{name:"centerCanvas",onInit:function(){this._.options.enableCenter=!0},onCreate:function(){e.call(this)},go:function(e){var o=t(this.worldCanvas.countries(),e),a=d3.geoCentroid(o);n.call(this,a)},focused:function(t){o.focused=t}}},flattenSvg:function(){function t(){var t=this._.proj,n=d3.geoEquirectangular().scale(this._.options.width/6.3).translate(this._.center);a.g1=t,a.g2=n}function n(){var t=this;return t._.svg.transition().duration(10500).tween("projection",function(){return function(e){n.alpha(e),t._.refresh()}})}function e(t,e){var o=d3.geoProjection(function(n,o){var r=t([n*=180/Math.PI,o*=180/Math.PI]),i=e([n,o]);return[(1-a)*r[0]+a*i[0],(a-1)*r[1]-a*i[1]]}).scale(1),a=void 0;return n.alpha=function(n){if(!arguments.length)return a;a=+n;var r=t.center(),i=e.center(),s=t.translate(),l=e.translate();return o.center([(1-a)*r[0]+a*i[0],(1-a)*r[1]+a*i[1]]),o.translate([(1-a)*s[0]+a*l[0],(1-a)*s[1]+a*l[1]]),o},n.alpha(0),o}function o(){var t=this._;return d3.transition().duration(1500).tween("rotate",function(){t.rotate(t.proj.rotate());var n=d3.interpolate(t.proj.rotate(),[0,0,0]);return function(e){t.rotate(n(e))}})}var a={};return{name:"flattenSvg",onInit:function(){t.call(this)},toMap:function(){var t=this;o.call(this).on("end",function(){var o=e(a.g1,a.g2);t._.path=d3.geoPath().projection(o),n.call(t).on("end",function(){t._.options.enableCenter=!1})})},toGlobe:function(){var t=this;this._.rotate([0,0,0]);var o=e(a.g2,a.g1);this._.path=d3.geoPath().projection(o),n.call(this).on("end",function(){t._.path=d3.geoPath().projection(t._.proj),t._.options.enableCenter=!0,t._.refresh()})}}},barThreejs:function(t){function n(t){for(var n=new THREE.BoxGeometry(2,2,t),e=0;e<n.faces.length;e+=2){var o=16777215*Math.random();n.faces[e].color.setHex(o),n.faces[e+1].color.setHex(o)}return n}function e(t,n){var e=.017453292519943295*(90-t.coordinates[1]),o=.017453292519943295*(360-t.coordinates[0]);t.position.x=n*Math.sin(e)*Math.cos(o),t.position.y=n*Math.cos(e),t.position.z=n*Math.sin(e)*Math.sin(o),t.lookAt({x:0,y:0,z:0})}function o(){this._.options.showBars=!0}function a(){var t=this._.options,o=this.threejsPlugin;if(!i.sphereObject){var a=new THREE.Group,l=this._.proj.scale();i.max=d3.max(i.data.features,function(t){return parseInt(t.geometry.value)}),i.scale=d3.scaleLinear().domain([0,i.max]).range([2,70]),i.data.features.forEach(function(t){var o=t.geometry.value,c=o?i.scale(o):r,u=n(c),h=new THREE.Mesh(u,s);h.coordinates=t.geometry.coordinates,e(h,c/2+l),h.ov=c,a.add(h)}),i.sphereObject=a}i.sphereObject.visible=t.showBars,o.addGroup(i.sphereObject)}var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i={sphereObject:null,data:null},s=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,morphTargets:!1,color:11206655});return{name:"barThreejs",urls:t&&[t],onReady:function(t,n){this.barThreejs.data(n)},onInit:function(){o.call(this)},onCreate:function(){a.call(this)},onRefresh:function(){i.sphereObject.visible=this._.options.showBars},data:function(t){if(!t)return i.data;if(i.valuePath){var n=i.valuePath.split(".");t.features.forEach(function(t){var e=t;n.forEach(function(t){return e=e[t]}),t.geometry.value=e})}i.data=t},scale:function(t){i.sphereObject.children.forEach(function(n){n.scale.x=t,n.scale.y=t,n.scale.z=t})},sphere:function(){return i.sphereObject}}},hmapThreejs:function(t){function n(){this._.options.showHmap=!0;var n=this._.proj.scale();if(a.geometry=new THREE.SphereGeometry(n,30,30),r.canvas=d3.select("body").append("canvas").style("position","absolute").style("display","none").style("top","450px").attr("id","webgl-hmap"),a.canvas=r.canvas.node(),a.heatmap=createWebGLHeatmap({intensityToAlpha:!0,width:1024,height:512,canvas:a.canvas}),a.texture=new THREE.Texture(a.canvas),a.material.map=a.texture,!t){r.canvas.style("display","inherit");var e=function(t,n){for(var e=0;e<200;){var o=2*Math.random()-1,r=2*Math.random()-1,i=o*o+r*r;if(!(i>1)){var s=Math.sqrt(i);o/=s,r/=s,o*=1-i,r*=1-i,e+=1,a.heatmap.addPoint(t+50*o,n+50*r,30,2/300)}}},o=function(t){t.preventDefault();for(var n=t.changedTouches,o=0;o<n.length;o++){var a=n[o];e(a.pageX,a.pageY)}};a.canvas.addEventListener("touchmove",o,!1),a.canvas.onmousemove=function(t){var n=t.offsetX||t.clientX,o=t.offsetY||t.clientY;e(n,o)},a.canvas.onclick=function(){a.heatmap.clear()}}}function e(){var t=this.threejsPlugin;a.sphereObject||(a.sphereObject=new THREE.Mesh(a.geometry,a.material)),a.sphereObject.visible=this._.options.showHmap,a.texture.needsUpdate=!0,t.addGroup(a.sphereObject)}function o(){a.heatmap.update(),a.heatmap.display(),a.sphereObject.visible=this._.options.showHmap}var a={sphereObject:null,material:new THREE.MeshBasicMaterial({transparent:!0})},r={canvas:null};return{name:"hmapThreejs",urls:t&&[t],onReady:function(t,n){this.hmapThreejs.data(n)},onInit:function(){n.call(this)},onInterval:function(){t||(a.texture.needsUpdate=!0)},onCreate:function(){e.call(this)},onRefresh:function(){o.call(this)},data:function(t){if(!t)return a.world;a.world=t,a.countries=topojson.feature(t,t.objects.countries)},sphere:function(){return a.sphereObject}}},dotsThreejs:function(t){function n(){this._.options.showDots=!0}function e(t){if(t){var n=this.threejsPlugin.vertex(t.geometry.coordinates),e=new THREE.SpriteMaterial({color:255}),o=new THREE.Sprite(e);return o.position.set(n.x,n.y,n.z),o}}function o(){var t=this.threejsPlugin;r.dots||a.call(this),r.dots.visible=this._.options.showDots,t.addGroup(r.dots)}function a(){var t=this;r.dots=new THREE.Group,r.dataDots.features.forEach(function(n){var o=e.call(t,n);o&&r.dots.add(o)})}var r={dataDots:null};return{name:"dotsThreejs",urls:t&&[t],onReady:function(t,n){this.dotsThreejs.data(n)},onInit:function(){n.call(this)},onCreate:function(){o.call(this)},onRefresh:function(){r.dots.visible=this._.options.showDots},data:function(t){if(!t)return r.dataDots;r.dataDots=t}}},dotsCThreejs:function(t){function n(){var t=void 0,n=this._.options;n.showDots=!0,this.canvasThreejs.onDraw({dotsCThreejs:function(e,a){if(n.showDots){t||(t=o.dots.map(function(t){return t.circle}));var r=o.dataDots.geometry||{};e.beginPath(),a({type:"GeometryCollection",geometries:t}),e.lineWidth=r.lineWidth||.2,e.fillStyle=r.fillStyle||"rgba(100,0,0,.4)",e.strokeStyle=r.strokeStyle||"rgba(100,0,0,.6)",e.fill(),e.stroke()}}})}function e(){var t=d3.geoCircle(),n=(o.dataDots.geometry||{}).radius||.5;o.dots=o.dataDots.features.map(function(e){var o=e.geometry.coordinates,a=e.properties,r=e.geometry.radius||n;return{properties:a,coordinates:o,circle:t.center(o).radius(r)()}})}var o={dataDots:null};return{name:"dotsCThreejs",urls:t&&[t],onReady:function(t,n){this.dotsCThreejs.data(n)},onInit:function(){n.call(this)},data:function(t){if(!t)return o.dataDots;o.dataDots=t,e()}}},iconsThreejs:function(t,n){function e(t,n){var e=.017453292519943295*(90-t.coordinates[1]),o=.017453292519943295*(360-t.coordinates[0]);t.position.x=n*Math.sin(e)*Math.cos(o),t.position.y=n*Math.cos(e),t.position.z=n*Math.sin(e)*Math.sin(o),t.lookAt({x:0,y:0,z:0})}function o(){var t=this.threejsPlugin;if(!s.sphereObject){var n=new THREE.Group,o=this._.proj.scale();s.data.features.forEach(function(t){var a=new THREE.PlaneGeometry(1,1,1,1),r=new THREE.Mesh(a,s.material);r.coordinates=t.geometry.coordinates,e(r,o+1),r.scale.set(6,6,1),n.add(r)}),s.sphereObject=n,s.sphereObject.visible=this._.options.showIcons}t.addGroup(s.sphereObject)}function a(){var t=this,e=this.threejsPlugin;this._.options.showIcons=!0,(new THREE.TextureLoader).load(n,function(n){s.material=new THREE.MeshPhongMaterial({side:THREE.DoubleSide,transparent:!0,map:n}),s.data&&!s.loaded&&(o.call(t),e.rotate())})}function r(){s.material&&!s.loaded&&o.call(this)}function i(){s.sphereObject&&(s.sphereObject.visible=this._.options.showIcons)}var s={sphereObject:null};return{name:"iconsThreejs",urls:t&&[t],onReady:function(t,n){this.iconsThreejs.data(n)},onInit:function(){a.call(this)},onCreate:function(){r.call(this)},onRefresh:function(){i.call(this)},data:function(t){if(!t)return s.data;if(s.valuePath){var n=s.valuePath.split(".");t.features.forEach(function(t){var e=t;n.forEach(function(t){return e=e[t]}),t.geometry.value=e})}s.data=t},scale:function(t){s.sphereObject.children.forEach(function(n){n.scale.set(t+2,t+2,1)})},sphere:function(){return s.sphereObject}}},canvasThreejs:function(t){function n(){var t=2*s,n=this._.options;n.showLand=!0,n.showTjCanvas=!0,n.transparentLand=!1;var e=this._.proj.scale();l.geometry=new THREE.SphereGeometry(e,30,30),l.newCanvas=document.createElement("canvas"),l.newContext=l.newCanvas.getContext("2d"),l.texture=new THREE.Texture(l.newCanvas),l.material.map=l.texture,l.canvas=d3.select("body").append("canvas").style("position","absolute").style("display","none").style("top","450px").attr("width",t).attr("height",s).attr("id","tjs-canvas").node(),l.context=l.canvas.getContext("2d"),l.proj=d3.geoEquirectangular().scale(t/i).translate([t/2,s/2]),l.path=d3.geoPath().projection(l.proj).context(l.context),l.path2=d3.geoPath().projection(l.proj).context(l.newContext),l.newCanvas.width=l.canvas.width,l.newCanvas.height=l.canvas.height}function e(){var t=this,n=this._.options,e=this.threejsPlugin;l.sphereObject||(a.call(this),l.sphereObject=new THREE.Mesh(l.geometry,l.material)),l.material.transparent=n.transparent||n.transparentLand,l.onDrawVals.forEach(function(n){n.call(t,l.newContext,l.path)}),l.sphereObject.visible=n.showTjCanvas,l.texture.needsUpdate=!0,e.addGroup(l.sphereObject)}function o(){if(this._.options.choropleth){for(var t=l.countries.features.length;t--;){var n=l.countries.features[t];l.context.beginPath(),l.path(n),l.context.fillStyle=n.color||"#8f9fc1",l.context.fill()}return!0}return l.path(l.countries),l.context.fillStyle="#8f9fc1",l.context.fill(),!1}function a(){var t=this._.options;l.style.ocean?(l.context.fillStyle=l.style.ocean,l.context.fillRect(0,0,l.canvas.width,l.canvas.height)):l.context.clearRect(0,0,l.canvas.width,l.canvas.height);var n=!0;if(l.context.beginPath(),t.showBorder||(n=o.call(this)),t.showBorder||void 0===t.showBorder){var e=c(this._.proj.scale());e<1&&(e=1),n&&l.path(l.countries),l.context.lineWidth=e,l.context.strokeStyle=l.style.countries||"rgb(239, 237, 234)",l.context.stroke()}l.newContext.drawImage(l.canvas,0,0),l.refresh=!0}function r(){if(l.refresh&&this.hoverCanvas&&this._.options.showSelectedCountry){l.refresh=!1,l.newContext.clearRect(0,0,l.canvas.width,l.canvas.height),l.newContext.drawImage(l.canvas,0,0),l.selected.features.length>0&&(l.newContext.beginPath(),l.path2(l.selected),l.newContext.fillStyle=l.style.selected||"rgba(255, 235, 0, 0.4)",l.newContext.fill());var t=this.hoverCanvas.states().country;t&&!l.selected.features.find(function(n){return n.id===t.id})&&(l.newContext.beginPath(),l.path2(t),l.newContext.fillStyle=l.style.hover||"rgba(117, 0, 0, 0.4)",l.newContext.fill()),l.texture.needsUpdate=!0,this.threejsPlugin.renderThree()}}var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6.279,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048,l={world:null,sphereObject:null,style:{},onDraw:{},onDrawVals:[],selected:{type:"FeatureCollection",features:[]},material:new THREE.MeshBasicMaterial({transparent:!1})},c=d3.scaleLinear().domain([30,450]).range([10,2]);return{name:"canvasThreejs",urls:t&&[t],onReady:function(t,n){this.canvasThreejs.data(n)},onInit:function(){n.call(this)},onCreate:function(){this.worldJson&&!l.world&&this.canvasThreejs.allData(this.worldJson.allData()),e.call(this)},onResize:function(){a.call(this)},onRefresh:function(){r.call(this)},onDraw:function(t){Object.assign(l.onDraw,t),l.onDrawVals=Object.keys(l.onDraw).map(function(t){return l.onDraw[t]})},selectedCountries:function(t){if(!t)return l.selected.features;l.selected.features=t},data:function(t){if(!t)return l.world;l.world=t,l.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:l.world,countries:l.countries};l.world=t.world,l.countries=t.countries},style:function(t){return t&&(l.style=t),l.style},refresh:function(){l.refresh=!0,r.call(this)},sphere:function(){return l.sphereObject}}},textureThreejs:function(){function t(){var t=this._,n=t.proj.scale(),a=t.options.width,i=t.options.height;this._.options.showDrawing=!0,e=new THREE.SphereGeometry(n,30,30);var s=d3.select("body").append("canvas");s.attr("height",i).attr("width",a),o.canvas=s.node(),o.context=o.canvas.getContext("2d"),o.texture=new THREE.Texture(o.canvas),o.canvas.width=o.canvas.height=512,o.texture.needsUpdate=!0,r.map=o.texture;var l=d3.geoMercator().scale(a/2/Math.PI).translate([a/2,i/2]).precision(.5);o.path=d3.geoPath(l,o.context)}function n(){var t=this._,n=this.threejsPlugin,i=t.options.width,s=t.options.height;o.sphereObject||(o.context.fillStyle="white",o.context.fillRect(0,0,i,s),o.context.beginPath(),o.path(a),o.context.lineWidth=.4,o.context.strokeStyle="rgba(119,119,119,0.6)",o.context.stroke(),o.sphereObject=new THREE.Mesh(e,r),o.sphereObject.visible=this._.options.showLand,o.texture.needsUpdate=!1),n.addGroup(o.sphereObject)}var e,o={},a=d3.geoGraticule()(),r=new THREE.MeshBasicMaterial;return{name:"textureThreejs",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){o.graticule.visible=this._.options.showDrawing}}},graticuleThreejs:function(){function t(){this._.options.showGraticule=!0,o.graticule10=n()}function n(){function t(t,n,o){var a=d3.range(t,n-e,o).concat(n);return function(t){return a.map(function(n){return[t,n]})}}function n(t,n,o){var a=d3.range(t,n-e,o).concat(n);return function(t){return a.map(function(n){return[n,t]})}}var e=1e-6,o=t(-80,80,2.5),a=n(-180,180,2.5),r=t(-90,90,2.5),i=n(-180,180,2.5);return{type:"MultiLineString",coordinates:d3.range(90*Math.ceil(-2),180,90).map(r).concat(d3.range(360*Math.ceil(-.25),90,360).map(i)).concat(d3.range(10*Math.ceil(-18),180,10).filter(function(t){return Math.abs(t%90)>e}).map(o)).concat(d3.range(10*Math.ceil(-8),80+e,10).filter(function(t){return Math.abs(t%360)>e}).map(a))}}function e(){var t=this.threejsPlugin;if(!o.sphereObject){var n=new THREE.LineBasicMaterial({color:11184810});o.sphereObject=t.wireframe(o.graticule10,n),o.sphereObject.visible=this._.options.showGraticule}t.addGroup(o.sphereObject)}var o={sphereObject:null};return{name:"graticuleThreejs",onInit:function(){t.call(this)},onCreate:function(){e.call(this)},onRefresh:function(){o.sphereObject.visible=this._.options.showGraticule},sphere:function(){return o.sphereObject}}},flightLineThreejs:function(t){function n(t,n,e){var o=(90-t)*Math.PI/180,a=(360-n)*Math.PI/180;return{phi:o,theta:a,x:e*Math.sin(o)*Math.cos(a),y:e*Math.cos(o),z:e*Math.sin(o)*Math.sin(a)}}function e(t){return t*Math.PI/180}function o(t,n,o,a,r){t=e(t),n=e(n),o=e(o),a=e(a);var i=2*Math.asin(Math.sqrt(Math.pow(Math.sin((t-o)/2),2)+Math.cos(t)*Math.cos(o)*Math.pow(Math.sin((n-a)/2),2))),s=Math.sin((1-r)*i)/Math.sin(i),l=Math.sin(r*i)/Math.sin(i),c=s*Math.cos(t)*Math.cos(n)+l*Math.cos(o)*Math.cos(a),u=s*Math.cos(t)*Math.sin(n)+l*Math.cos(o)*Math.sin(a),h=s*Math.sin(t)+l*Math.sin(o);return{lat:180*Math.atan2(h,Math.sqrt(Math.pow(c,2)+Math.pow(u,2)))/Math.PI,lng:180*Math.atan2(u,c)/Math.PI}}function a(t,a,r,i,s,l){for(var d=120*Math.random(),f=[],p=0;p<11;p++){var v=180*p/10,g=s+Math.sin(e(v))*d,w=o(t,a,r,i,p/10),m=n(w.lat,w.lng,g);f.push(new THREE.Vector3(m.x,m.y,m.z))}var y=new THREE.CatmullRomCurve3(f),b=new THREE.Shape;b.moveTo(0,.5),b.quadraticCurveTo(.5,.5,.5,0),b.quadraticCurveTo(.5,-.5,0,-.5),b.quadraticCurveTo(-.5,-.5,-.5,0),b.quadraticCurveTo(-.5,.5,0,.5);var C=new THREE.ExtrudeGeometry(b,{bevelEnabled:!1,extrudePath:y,amount:10,steps:64}),j=new THREE.ShaderMaterial({uniforms:h,vertexShader:c,fragmentShader:u});h.resolution.value.x=100,h.resolution.value.y=100;var E=new THREE.Mesh(C,j);l.add(E)}function r(){this._.options.showFlightLine=!0}function i(){var t=this._.options,n=this.threejsPlugin;if(!l.sphereObject){for(var e=new THREE.Group,o=this._.proj.scale(),r=0;r<s;++r){var i=Math.floor(Math.random()*l.data.length)-1,c=l.data[i].lat,u=l.data[i].lng,h=Math.floor(Math.random()*l.data.length)-1;a(c,u,l.data[h].lat,l.data[h].lng,o,e)}l.sphereObject=e,console.log("done add")}l.sphereObject.visible=t.showFlightLine,n.addGroup(l.sphereObject)}var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,l={sphereObject:null},c="\n        uniform vec2 uvScale;\n        varying vec2 vUv;\n\n        void main() {\n            vUv = uv;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n        }",u="\n        uniform float time;\n        uniform vec2 resolution;\n        varying vec2 vUv;\n\n        void main(void) {\n            vec2 position = vUv / resolution.xy;\n            float green = abs(sin(position.x * position.y + time / 5.0)) + 0.5;\n            float red   = abs(sin(position.x * position.y + time / 4.0)) + 0.1;\n            float blue  = abs(sin(position.x * position.y + time / 3.0)) + 0.2;\n            gl_FragColor= vec4(red, green, blue, 1.0);\n        }",h={time:{type:"f",value:1},resolution:{type:"v2",value:new THREE.Vector2}};return{name:"flightLineThreejs",urls:t&&[t],onReady:function(t,n){this.flightLineThreejs.data(n)},onInit:function(){r.call(this)},onCreate:function(){i.call(this)},onRefresh:function(){l.sphereObject.visible=this._.options.showFlightLine},data:function(t){if(!t)return l.data;l.data=t},sphere:function(){return l.sphereObject}}},flightLine2Threejs:function(t,n,e){function o(t){for(var n=0;n<m.data.length;++n){var o=m.data[n][0],s=m.data[n][1],l=m.data[n][2],c=m.data[n][3];if(o!==l||s!==c){for(var u=[],h=Math.random()*(e||m.SCALE)+.05,d=0;d<9;d++){var f=180*d/8,p=t+Math.sin(f*R)*h,v=i(o,s,l,c,d/8),g=a(v.lat,v.lng,p);u.push(new THREE.Vector3(g.x,g.y,g.z))}for(var w=new THREE.CatmullRomCurve3(u),E=r(o,s,l,c,t),T=[],M=0;M<E;M+=j){var S=M/E;T.push(w.getPoint(S))}var k=E/(2*Math.PI)*24901;k<y&&(y=k),k>b&&(b=parseInt(1e3*Math.ceil(k/1e3)),C=b);var P=600*Math.random()+400,H=P*_,D=parseInt(E/j)+1;O+=D;var I={spline:w,num_points:D,spd_points:H*D,arc_distance:E,arc_distance_miles:k,point_positions:T,default_speed:P,speed:H};x.push(I)}}}function a(t,n,e){var o=(90-t)*R,a=(360-n)*R;return{x:e*Math.sin(o)*Math.cos(a),y:e*Math.cos(o),z:e*Math.sin(o)*Math.sin(a)}}function r(t,n,e,o,a){var r=Math.sin((e-t)*R/2)*Math.sin((e-t)*R/2)+Math.cos(t*R)*Math.cos(e*R)*Math.sin((o-n)*R/2)*Math.sin((o-n)*R/2);return a*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function i(t,n,e,o,a){t*=R,n*=R,e*=R,o*=R;var r=2*Math.asin(Math.sqrt(Math.pow(Math.sin((t-e)/2),2)+Math.cos(t)*Math.cos(e)*Math.pow(Math.sin((n-o)/2),2))),i=Math.sin((1-a)*r)/Math.sin(r),s=Math.sin(a*r)/Math.sin(r),l=i*Math.cos(t)*Math.cos(n)+s*Math.cos(e)*Math.cos(o),c=i*Math.cos(t)*Math.sin(n)+s*Math.cos(e)*Math.sin(o),u=i*Math.sin(t)+s*Math.sin(e);return{lat:180*Math.atan2(u,Math.sqrt(Math.pow(l,2)+Math.pow(c,2)))/Math.PI,lng:180*Math.atan2(c,l)/Math.PI}}function s(){S=new Float32Array(3*O),k=new Float32Array(3*O),P=new Float32Array(O);for(var t=0,n=0;n<x.length;++n)for(var e=new THREE.Color(16777215).setHSL(n/x.length,.6,.6),o=0;o<x[n].point_positions.length;++o)S[3*t+0]=0,S[3*t+1]=0,S[3*t+2]=0,k[3*t+0]=e.r,k[3*t+1]=e.g,k[3*t+2]=e.b,P[t]=m.point_size,++t;var a=new THREE.BufferGeometry;return a.addAttribute("position",new THREE.BufferAttribute(S,3)),a.addAttribute("customColor",new THREE.BufferAttribute(k,3)),a.addAttribute("size",new THREE.BufferAttribute(P,1)),a.computeBoundingBox(),m.track_points_object=new THREE.Points(a,m.shaderMaterial),m.attr_position=m.track_points_object.geometry.attributes.position,m.track_points_object}function l(){for(var t=0,n=Date.now(),e=x.length,o=0;o<e;++o){var a=x[o],r=a.speed,i=a.spline,s=a.num_points,l=a.spd_points,u=a.arc_distance;if(a.arc_distance_miles<=C)for(var h=j/u,d=n%r/l,f=0;f<s;f++){var p=c(o,f*h+d,i),v=p.x,g=p.y,w=p.z;S[0+(y=3*t)]=v,S[y+1]=g,S[y+2]=w,t++}else for(f=0;f<s;f++){var y=3*t;S[y+0]=1/0,S[y+1]=1/0,S[y+2]=1/0,t++}}m.attr_position.needsUpdate=!0}function c(t,n,e){void 0===T[t]&&(T[t]=[]);var o=parseInt(1e3*n),a=T[t];return void 0===a[o]&&(a[o]=e.getPoint(n)),a[o]}function u(){var t=new THREE.BufferGeometry,n=3*x.length*2*I;w=new Float32Array(n);for(var e=new Float32Array(n),o=0;o<x.length;++o)for(var a=x[o].spline,r=new THREE.Color(16777215).setHSL(o/x.length,.9,.8),i=r.r,s=r.g,l=r.b,c=0;c<I-1;++c){var u=6*(o*I+c),h=a.getPoint(c/(I-1)),d=h.x,f=h.y,p=h.z;w[u+0]=d,w[u+1]=f,w[u+2]=p;var v=a.getPoint((c+1)/(I-1)),d=v.x,f=v.y,p=v.z;w[u+3]=d,w[u+4]=f,w[u+5]=p,e[u+0]=i,e[u+1]=s,e[u+2]=l,e[u+3]=i,e[u+4]=s,e[u+5]=l}return t.addAttribute("position",new THREE.BufferAttribute(w,3)),t.addAttribute("color",new THREE.BufferAttribute(e,3)),t.computeBoundingSphere(),m.track_lines_object=new THREE.Line(t,G,THREE.LineSegments),m.track_lines_object}function h(){var t={color:{type:"c",value:new THREE.Color(65280)},texture:{type:"t",value:m.texture},opacity:{type:"f",value:E}};m.shaderMaterial=new THREE.ShaderMaterial({uniforms:t,vertexShader:H,fragmentShader:D,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,transparent:!0});var n=new THREE.Group;o(m.SCALE+5),n.add(u()),n.add(s()),n.name="flightLine2Threejs",m.sphereObject=n,m.loaded=!0}function d(){m.SCALE=this._.proj.scale();var t=new THREE.LoadingManager,e=new THREE.TextureLoader(t);this._.options.showFlightLine=!0,m.texture=e.load(n,function(t){return t})}function f(){var t=this._.options;!m.texture||m.sphereObject||m.loaded?m.sphereObject&&(m.sphereObject.visible=t.showFlightLine):(console.log("done add:2"),h.call(this)),this.threejsPlugin.addGroup(m.sphereObject)}function p(){x=[],T=[],console.log("done reload");var t=this.threejsPlugin;h.call(this);var n=t.group(),e=n.children,o=e.findIndex(function(t){return"flightLine2Threejs"===t.name});n.remove(e[o]),n.add(m.sphereObject),t.renderThree()}function v(t){t-A>30&&!this._.drag&&(A=t,l(),this.threejsPlugin.renderThree(!0))}function g(){var t=M(this._.proj.scale());this.flightLine2Threejs.pointSize(t)}var w,m={sphereObject:null,track_lines_object:null,track_points_object:null,point_size:250,linewidth:3,texture:null},y=1/0,b=-1/0,C=0,j=100,E=.5,_=1,T=[],x=[],M=d3.scaleLinear().domain([30,300]).range([40,m.point_size]),R=Math.PI/180,S=void 0,k=void 0,P=void 0,O=0,H="\n    attribute float size;\n    attribute vec3 customColor;\n    varying vec3 vColor;\n\n    void main() {\n        vColor = customColor;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_PointSize = size * ( 300.0 / length( mvPosition.xyz ) );\n        gl_Position = projectionMatrix * mvPosition;\n    }",D="\n    uniform vec3 color;\n    uniform sampler2D texture;\n    uniform float opacity;\n\n    varying vec3 vColor;\n\n    void main() {\n        gl_FragColor = vec4( color * vColor, opacity );\n        gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );\n    }",I=24,G=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,opacity:.2,transparent:!0,depthWrite:!1,depthTest:!0,color:16777215,linewidth:m.linewidth}),A=0;return{name:"flightLine2Threejs",urls:t&&[t],onReady:function(t,n){this.flightLine2Threejs.data(n)},onInit:function(){d.call(this)},onResize:function(){g.call(this)},onInterval:function(t){v.call(this,t)},onCreate:function(){f.call(this)},onRefresh:function(){m.sphereObject.visible=this._.options.showFlightLine},reload:function(){p.call(this)},data:function(t){if(!t)return m.data;m.data=t},sphere:function(){return m.sphereObject},pointSize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.point_size,n=m.sphereObject.children[1].geometry.attributes.size;n.array=n.array.map(function(){return t}),n.needsUpdate=!0}}},debugThreejs:function(){function t(){this._.options.showDebugSpahre=!0}function n(){var t=this._.options,n=this.threejsPlugin;if(!e.sphereObject){var o=this._.proj.scale();e.scale=d3.scaleLinear().domain([0,o]).range([0,1]);var a=new THREE.SphereGeometry(o,100,100),r=new THREE.MeshNormalMaterial({wireframe:!1}),i=new THREE.Mesh(a,r),s=new THREE.SphereGeometry(30,10,10),l=new THREE.SphereGeometry(30,10,10),c=new THREE.SphereGeometry(30,10,10);s.translate(0,0,o),l.translate(o,0,0),c.translate(0,-o,0);var u=new THREE.MeshBasicMaterial({color:"blue"}),h=new THREE.MeshBasicMaterial({color:"red"}),d=new THREE.MeshBasicMaterial({color:"green"}),f=new THREE.Mesh(s,u),p=new THREE.Mesh(l,h),v=new THREE.Mesh(c,d);e.sphereObject=new THREE.Object3D,e.sphereObject.add(i,f,p,v)}e.sphereObject.visible=t.showDebugSpahre,n.addGroup(e.sphereObject)}var e={sphereObject:null,scale:null};return{name:"debugThreejs",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){e.sphereObject.visible=this._.options.showDebugSpahre},sphere:function(){return e.sphereObject}}},oceanThreejs:function(t){function n(){var t=this._.options;t.showOcean=!0,t.transparentOcean=!1}function e(){var t=this._.options,n=this.threejsPlugin;if(!o.sphereObject){var e=this._.proj.scale(),a=new THREE.SphereGeometry(e,30,30);o.sphereObject=new THREE.Mesh(a,o.material)}o.material.transparent=t.transparent||t.transparentOcean,o.sphereObject.visible=t.showOcean,n.addGroup(o.sphereObject)}var o={sphereObject:null};return o.material=t?new THREE.MeshBasicMaterial({transparent:!0,color:t}):new THREE.MeshNormalMaterial({transparent:!1,wireframe:!1,opacity:.8}),{name:"oceanThreejs",onInit:function(){n.call(this)},onCreate:function(){e.call(this)},onRefresh:function(){o.sphereObject.visible=this._.options.showOcean},sphere:function(){return o.sphereObject}}},imageThreejs:function(){function t(){var t=this.threejsPlugin;if(o.sphereObject)t.addGroup(o.sphereObject);else{var n=this,a=this._.proj.scale();(new THREE.TextureLoader).load(e,function(e){var r=new THREE.SphereGeometry(a,30,30),i=new THREE.MeshBasicMaterial({map:e});o.sphereObject=new THREE.Mesh(r,i),o.sphereObject.visible=n._.options.showImage,t.addGroup(o.sphereObject),t.rotate()})}}function n(){o.sphereObject&&(o.sphereObject.visible=this._.options.showImage)}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world.png",o={sphereObject:null};return{name:"imageThreejs",onInit:function(){this._.options.showImage=!0},onCreate:function(){t.call(this)},onRefresh:function(){n.call(this)},sphere:function(){return o.sphereObject}}},worldThreejs:function(){function t(){var t=this.threejsPlugin;if(!e.sphereObject){var n=topojson.mesh(e.world,e.world.objects.countries),o=new THREE.MeshBasicMaterial({color:7368816});e.sphereObject=t.wireframe(n,o),e.sphereObject.visible=this._.options.showLand}t.addGroup(e.sphereObject)}var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world.png",e={sphereObject:null};return{name:"worldThreejs",urls:n&&[n],onReady:function(t,n){this.worldThreejs.data(n)},onInit:function(){this._.options.showLand=!0},onCreate:function(){t.call(this)},onRefresh:function(){e.sphereObject.visible=this._.options.showLand},data:function(t){if(!t)return e.world;e.world=t},sphere:function(){return e.sphereObject}}},globeThreejs:function(){function t(){this._.options.showGlobe=!0}function n(){var t=this.threejsPlugin;if(i.sphereObject)t.addGroup(i.sphereObject);else{var n=this._.proj.scale(),e=l.load(o,function(t){return t}),s=l.load(a,function(t){return t}),c=l.load(r,function(t){return t}),u=new THREE.SphereGeometry(n,30,30),h=new THREE.MeshPhongMaterial({map:e,bumpMap:s,bumpScale:.01,specularMap:c,specular:new THREE.Color("grey")});i.sphereObject=new THREE.Mesh(u,h),i.sphereObject.visible=this._.options.showGlobe;var d=new THREE.AmbientLight(7829367),f=new THREE.DirectionalLight(16777215,.2),p=new THREE.DirectionalLight(16777215,.2);f.position.set(5,3,6),p.position.set(5,3,-6),t.addGroup(d),t.addGroup(f),t.addGroup(p),t.addGroup(i.sphereObject)}}function e(){i.sphereObject&&(i.sphereObject.visible=this._.options.showGlobe)}var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world.jpg",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"../d/elevation.jpg",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"../d/water.png",i={sphereObject:null},s=new THREE.LoadingManager,l=new THREE.TextureLoader(s);return{name:"globeThreejs",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){e.call(this)},sphere:function(){return i.sphereObject}}},sphereThreejs:function(){function t(){var t=this.threejsPlugin;if(o.sphereObject)t.addGroup(o.sphereObject);else{var n=this,a=this._.proj.scale(),s=new THREE.SphereGeometry(a,30,30),l=THREE.UniformsUtils.clone(i.earth.uniforms),c=THREE.UniformsUtils.clone(i.atmosphere.uniforms);l.texture.value=r.load(e,function(t){return t});var u=new THREE.Mesh(s,new THREE.ShaderMaterial({uniforms:l,vertexShader:i.earth.vertexShader,fragmentShader:i.earth.fragmentShader})),h=new THREE.Mesh(s,new THREE.ShaderMaterial({uniforms:c,vertexShader:i.atmosphere.vertexShader,fragmentShader:i.atmosphere.fragmentShader,side:THREE.BackSide,blending:THREE.AdditiveBlending,transparent:!0})),d=new THREE.Group;d.add(u),d.add(h),o.sphereObject=d,o.sphereObject.visible=n._.options.showSphere,t.addGroup(o.sphereObject),t.rotate()}}function n(){o.sphereObject&&(o.sphereObject.visible=this._.options.showSphere)}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world.png",o={sphereObject:null},a=new THREE.LoadingManager,r=new THREE.TextureLoader(a),i={earth:{uniforms:{texture:{type:"t",value:null}},vertexShader:["varying vec3 vNormal;","varying vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","varying vec3 vNormal;","varying vec2 vUv;","void main() {","vec3 diffuse = texture2D( texture, vUv ).xyz;","float intensity = 1.05 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) );","vec3 atmosphere = vec3( 1.0, 1.0, 1.0 ) * pow( intensity, 3.0 );","gl_FragColor = vec4( diffuse + atmosphere, 1.0 );","}"].join("\n")},atmosphere:{uniforms:{},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec3 vNormal;","void main() {","float intensity = pow( 0.8 - dot( vNormal, vec3( 0, 0, 1.0 ) ), 12.0 );","gl_FragColor = vec4( 1.0, 1.0, 1.0, 1.0 ) * intensity;","}"].join("\n")}};return{name:"sphereThreejs",onInit:function(){this._.options.showSphere=!0},onCreate:function(){t.call(this)},onRefresh:function(){n.call(this)},sphere:function(){return o.sphereObject},imgSrc:function(t){var n=this.sphereThreejs.sphere().children[0].material;n.uniforms.texture.value=r.load(t,function(t){return t}),n.needsUpdate=!0}}},world3d:function(){function n(){var n=c.world;for(var e in n){var o=new t(n[e],.9);c.sphereObject.add(n[e].mesh=new THREE.Mesh(o,c.material))}c.loaded=!0}function e(){this._.options.showWorld=!0,c.sphereObject.rotation.y=l,c.sphereObject.scale.set(205,205,205),a(s,function(t){c.material=t,c.world&&!c.loaded&&n()})}function o(){c.material&&!c.loaded&&n(),c.sphereObject.visible=this._.options.showWorld,this.threejsPlugin.addGroup(c.sphereObject)}function a(t,n){(new THREE.TextureLoader).load(t,function(t){var e={tMatCap:{type:"t",value:t}},o=new THREE.ShaderMaterial({uniforms:e,vertexShader:u,fragmentShader:h,shading:THREE.SmoothShading});n.call(this,o)})}function r(){c.sphereObject&&(c.sphereObject.visible=this._.options.showWorld)}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world_geometry.json",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"../d/gold.jpg",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1.57,c={sphereObject:new THREE.Object3D},u="\n    varying vec2 vN;\n    void main() {\n        vec4 p = vec4( position, 1. );\n        vec3 e = normalize( vec3( modelViewMatrix * p ) );\n        vec3 n = normalize( normalMatrix * normal );\n        vec3 r = reflect( e, n );\n        float m = 2. * length( vec3( r.xy, r.z + 1. ) );\n        vN = r.xy / m + .5;\n        gl_Position = projectionMatrix * modelViewMatrix * p;\n    }\n    ",h="\n    uniform sampler2D tMatCap;\n    varying vec2 vN;\n    void main() {\n        vec3 base = texture2D( tMatCap, vN ).rgb;\n        gl_FragColor = vec4( base, 1. );\n    }\n    ";return{name:"world3d",urls:i&&[i],onReady:function(t,n){this.world3d.data(n)},onInit:function(){e.call(this)},onCreate:function(){o.call(this)},onRefresh:function(){r.call(this)},rotate:function(t){c.sphereObject.rotation.y=t},data:function(t){if(!t)return c.world;c.world=t},sphere:function(){return c.sphereObject}}},world3d2:function(){function t(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=t.vertices.length/2;t.vertices.forEach(function(t,a){var r=n;a>=o&&(r=1+e);var i=.017453292519943295*(90-t.oy),s=.017453292519943295*(360-t.ox);t.x=r*Math.sin(i)*Math.cos(s),t.y=r*Math.cos(i),t.z=r*Math.sin(i)*Math.sin(s)}),t.verticesNeedUpdate=!0,t.computeFaceNormals()}function n(n){var e=new THREE.Shape(n),o=new THREE.ExtrudeGeometry(e,{bevelEnabled:!1,amount:16});return o.vertices.forEach(function(t){t.ox=t.x,t.oy=t.y,t.oz=t.z}),t(o,u,h),new THREE.Mesh(o,f.material)}function e(t,e){var o=t.id,a=[],r=f.group[o];void 0===r&&((r=new THREE.Group).name=o,f.group[o]=r,f.sphereObject.add(r)),e.forEach(function(t){a.push(new THREE.Vector2(t[0],t[1]))}),r.add(n(a))}function o(){f.world.features.forEach(function(t){var n=t.geometry.coordinates;1===n.length?e(t,n[0]):n.forEach(function(n){1==n.length?e(t,n[0]):e(t,n)})})}function a(){var t=this._.proj.scale();this._.options.showWorld=!0,f.sphereObject.rotation.y=d,f.sphereObject.scale.set(t,t,t),i(c,function(t){f.material=t,f.world&&!f.loaded&&o()})}function r(){f.material&&!f.loaded&&o(),f.sphereObject.visible=this._.options.showWorld,this.threejsPlugin.addGroup(f.sphereObject)}function i(t,n){(new THREE.TextureLoader).load(t,function(t){var e={tMatCap:{type:"t",value:t}},o=new THREE.ShaderMaterial({uniforms:e,vertexShader:p,fragmentShader:v,shading:THREE.SmoothShading});n.call(this,o)})}function s(){f.sphereObject&&(f.sphereObject.visible=this._.options.showWorld)}var l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/countries.geo.json",c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"../d/gold.jpg",u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f={sphereObject:new THREE.Object3D,group:{}},p="\n    varying vec2 vN;\n    void main() {\n        vec4 p = vec4( position, 1. );\n        vec3 e = normalize( vec3( modelViewMatrix * p ) );\n        vec3 n = normalize( normalMatrix * normal );\n        vec3 r = reflect( e, n );\n        float m = 2. * length( vec3( r.xy, r.z + 1. ) );\n        vN = r.xy / m + .5;\n        gl_Position = projectionMatrix * modelViewMatrix * p;\n    }\n    ",v="\n    uniform sampler2D tMatCap;\n    varying vec2 vN;\n    void main() {\n        vec3 base = texture2D( tMatCap, vN ).rgb;\n        gl_FragColor = vec4( base, 1. );\n    }\n    ";return{name:"world3d2",urls:l&&[l],onReady:function(t,n){this.world3d2.data(n)},onInit:function(){a.call(this)},onCreate:function(){r.call(this)},onRefresh:function(){s.call(this)},rotate:function(t){f.sphereObject.rotation.y=t},data:function(t){if(!t)return f.world;f.world=t},sphere:function(){return f.sphereObject},group:function(){return f.group},extrude:function(n,e,o){f.group[n]&&f.group[n].children.forEach(function(n){t(n.geometry,e,o)})}}},commonPlugins:function(t){function n(){var n=this,e=this.register,o=earthjs.plugins;e(o.mousePlugin()),e(o.configPlugin()),e(o.autorotatePlugin()),e(o.dropShadowSvg()),e(o.oceanSvg()),e(o.canvasPlugin()),e(o.graticuleCanvas()),e(o.worldCanvas(t)),this._.options.oceanColor=2,this._.options.transparent=!0,this.canvasPlugin.selectAll(".ej-canvas"),this.graticuleCanvas.drawTo([1]),this.worldCanvas.drawTo([0]),a.options=this.configPlugin.set(),a.buttonClick=function(t){var e=t.split(":")[2],o={},a=n.configPlugin.set();a[e]=!a[e],o[e]=a[e],"transparent"==e?((a.transparentGraticule||a.transparentLand)&&(o.transparent=!1),o.transparentGraticule=!1,o.transparentLand=!1):"showCountries"==e||"showLakes"==e?o.showLand=!0:"transparentGraticule"!=e&&"transparentLand"!=e||(a.transparent&&(o.transparentGraticule=!1,o.transparentLand=!1),o.transparent=!1),n.configPlugin.set(o)}}function e(t,n,e,o,a,r,i){t.append("br"),t.append("input").attr("id",n).attr("type","range").attr("min",e).attr("max",o).attr("step",a).attr("value",r).on("input",i)}function o(){var t=this,n=this,o=d3.select(".set-options"),r=d3.select(".set-options2");if(o.selectAll("button, input, br").remove(),r.selectAll("button, input, br").remove(),this._.options.showControll){o.selectAll("button").data(a.checker).enter().append("button").text(function(t){return t[1]}).on("click",function(n){return a.buttonClick.call(t,n.join(":"))}),e(r,"pan",0,400,1,a.pan,function(){a.pan=+this.value;for(var t=1;t<i.length;t++)i[t].style.left=a.pan*t+"px"}),e(r,"ocn",0,20,1,a.ocn,function(){a.ocn=this.value,n.oceanSvg.scale(-a.ocn)}),e(r,"spd",10,200,10,a.spd,function(){a.spd=this.value,n.autorotatePlugin.speed(a.spd)});var i=d3.selectAll(".ea-layer").nodes();window.nodes=i,e(r,"clr",0,5,1,n._.options.oceanColor,function(){n._.options.oceanColor=+this.value,n.oceanSvg.recreate()})}}var a={checker:[],ocn:0,spd:10,pan:0,clr:0};return a.checker=[":Shadow:showDropShadow",":Ocean:showOcean",":Graticule:showGraticule",":Land:showLand",":Country:showCountries",":Lakes:showLakes",":Transparent:transparent",":Canvas:showCanvas",":Spin:spin"].map(function(t){return t.split(":")}),{name:"commonPlugins",onInit:function(){n.call(this),this._.options.showControll=!0},onCreate:function(){o.call(this)},addChecker:function(t){a.checker.push(t),a.options=this.configPlugin.set(),o.call(this)}}},selectCountryMix:function(){function t(){var t=this.register(earthjs.plugins.mousePlugin()).register(earthjs.plugins.hoverCanvas()).register(earthjs.plugins.clickCanvas()).register(earthjs.plugins.centerCanvas()).register(earthjs.plugins.canvasPlugin()).register(earthjs.plugins.dropShadowSvg()).register(earthjs.plugins.countryCanvas()).register(earthjs.plugins.autorotatePlugin()).register(earthjs.plugins.worldCanvas(n));t.canvasPlugin.selectAll(".ej-canvas"),t._.options.showSelectedCountry=!0,t._.options.showBorder=!0,t.worldCanvas.ready=function(n,e){t.countryCanvas.data(e),t.worldCanvas.data(e),t.hoverCanvas.data(e),t.clickCanvas.data(e)},t.centerCanvas.focused(function(n,e){if(t.autorotatePlugin.stop(),t.worldCanvas.style({}),n.metaKey){var o=t.worldCanvas.selectedCountries().concat(e);t.worldCanvas.selectedCountries(o)}else t.worldCanvas.selectedCountries([e]);console.log(e)}),t.clickCanvas.onCountry({autorotate:function(n,e){e||(t.worldCanvas.style({}),t.autorotatePlugin.start(),t.worldCanvas.selectedCountries([]))}})}var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world-110m.json";return{name:"selectCountryMix",onInit:function(){t.call(this)},region:function(t,n){var e=this,o=e.worldCanvas.countries().filter(function(n){return t.indexOf(n.id)>-1});e.worldCanvas.style({selected:"rgba(255, 235, 0, 0.4)"}),e.worldCanvas.selectedCountries(o),e.autorotatePlugin.stop(),n&&e.centerCanvas.go(n)}}}},e}();