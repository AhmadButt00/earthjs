!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.earthjs=e()}(this,function(){"use strict";var t=function(t={}){function e(t,e){var s=e+"Keys";t[e]&&(n[e][t.name]=t[e],n[s]=Object.keys(n[e]))}t=Object.assign({select:"#earth",height:870,width:1700},t);var n={onResize:{},onResizeKeys:[],onRefresh:{},onRefreshKeys:[],onInterval:{},onIntervalKeys:[],svgCreateOrder:["svgAddDropShadow","svgAddOcean","svgAddGlobeShading","svgAddWorldOrCountries","svgAddGlobeHilight","svgAddGraticule","svgAddPlaces"]},s=d3.selectAll(t.select).attr("width",t.width).attr("height",t.height),i=d3.geoOrthographic().scale(t.width/4.1).translate([t.width/2,t.height/2]),o=d3.geoPath().projection(i),a={_:{svg:s,proj:i,path:o,drag:!1,options:t},register:function(t){var n={};if(a[t.name]=n,Object.keys(t).map(function(e){-1===["data","onReady","onInit","onResize","onRefresh","onInterval"].indexOf(e)&&"function"==typeof t[e]&&(n[e]=function(){return t[e].apply(a,arguments)})}),t.onInit&&t.onInit.call(a),e(t,"onResize"),e(t,"onRefresh"),e(t,"onInterval"),t.data&&t.onReady){var s=d3.queue();t.data.forEach(function(t){var e=t.split(".").pop();s.defer(d3[e],t)}),s.await(function(){t.onReady.apply(a,arguments)})}return a}};a._.defs=a._.svg.append("defs");var r=null,l=null;return a._.ticker=function(t){return t=t||50,l=setInterval(function(){a._.intervalRun.call(a),r&&r._.intervalRun.call(r)},t),a},a.svgDraw=function(t){return n.svgCreateOrder.forEach(function(t){a[t]&&a[t].call(a)}),t&&(t.svgDraw(null),r=t),null===l&&null!==t&&a._.ticker.call(a),a},a._.scale=function(t){return a._.proj.scale(t),a._.resize.call(a),a._.refresh.call(a),a},a._.rotate=function(t){return a._.proj.rotate(t),a._.refresh.call(a),a},a._.intervalRun=function(){n.onIntervalKeys.length>0&&n.onIntervalKeys.map(function(t){n.onInterval[t].call(a)})},a._.refresh=function(){return n.onRefreshKeys.length>0&&n.onRefreshKeys.map(function(t){n.onRefresh[t].call(a)}),a},a._.resize=function(){return n.onResizeKeys.length>0&&n.onResizeKeys.map(function(t){n.onResize[t].call(a)}),a},a},e=function(){function t(t){var e=t[0]/2*u,n=h(e),s=a(e),i=t[1]/2*u,o=h(i),r=a(i),l=t[2]/2*u,c=h(l),d=a(l);return[s*r*d+n*o*c,n*r*d-s*o*c,s*o*d+n*r*c,s*r*c-n*o*d]}function e(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function n(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}var s=Math.acos,i=Math.asin,o=Math.atan2,a=Math.cos,r=Math.max,l=Math.min,c=Math.PI,h=Math.sin,d=Math.sqrt,u=c/180,p=180/c;return t.cartesian=function(t){var e=t[0]*u,n=t[1]*u,s=a(n);return[s*a(e),s*h(e),h(n)]},t.rotation=function(t){return[o(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*p,i(r(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*p,o(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*p]},t.delta=function(t,i){var o=e(t,i),c=d(n(o,o));if(!c)return[1,0,0,0];var u=s(r(-1,l(1,n(t,i))))/2,p=h(u);return[a(u),o[2]/c*p,-o[1]/c*p,o[0]/c*p]},t.multiply=function(t,e){return[t[0]*e[0]-t[1]*e[1]-t[2]*e[2]-t[3]*e[3],t[0]*e[1]+t[1]*e[0]+t[2]*e[3]-t[3]*e[2],t[0]*e[2]-t[1]*e[3]+t[2]*e[0]+t[3]*e[1],t[0]*e[3]+t[1]*e[2]-t[2]*e[1]+t[3]*e[0]]},t}();return t.plugins={versorDragPlugin:function(){return{name:"versorDragPlugin",onInit(){function t(){i._.drag=!0,o=e.cartesian(i._.proj.invert(d3.mouse(this))),a=i._.proj.rotate(),r=e(a)}function n(){i._.drag=!1}function s(){var t=e.cartesian(i._.proj.rotate(a).invert(d3.mouse(this))),n=e.multiply(r,e.delta(o,t)),s=e.rotation(n);i._.rotate(s)}var i=this;this._.svg.call(d3.drag().on("start",t).on("end",n).on("drag",s));var o,a,r}}},wheelZoomPlugin:function(){return{name:"wheelZoomPlugin",onInit(){var t=this;this._.svg.on("wheel",function(){var e=d3.event.deltaY+t._.proj.scale();e>230&&e<1e3&&t._.scale(e)})}}},oceanPlugin:function(t={}){function e(){if(n.svg.selectAll("#ocean,.ocean").remove(),!this._.options.hideOcean){var t=this._.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");return t.append("stop").attr("offset","5%").attr("stop-color","#ddf"),t.append("stop").attr("offset","100%").attr("stop-color","#9ab"),this._.ocean=n.svg.append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale()).attr("class","ocean noclicks").style("fill","url(#ocean)"),this._.ocean}}var n={svg:null,select:null};return t=Object.assign({hideOcean:!1},t),{name:"oceanPlugin",onInit(){Object.assign(this._.options,t),this.svgAddOcean=e,n.svg=this._.svg},onResize(){this._.ocean&&!this._.options.hideOcean&&this._.ocean.attr("r",this._.proj.scale())},select(t){return n.select=t,n.svg=d3.selectAll(t),n.svg}}},configPlugin:function(){return{name:"configPlugin",set(t){if(t){if(Object.assign(this._.options,t),void 0!==t.stop){var e=this.autorotatePlugin;t.stop?e.stop():e.start()}this._.drag=!0,this.svgDraw(),this._.drag=!1}return Object.assign({},this._.options)}}},graticulePlugin:function(t={}){function e(){if(s.svg.selectAll(".graticule").remove(),!this._.options.hideGraticule)return this._.graticule=s.svg.append("g").attr("class","graticule").append("path").datum(n).style("fill","none").style("opacity","0.2").style("stroke","black").style("stroke-width","0.5").attr("class","noclicks").attr("d",this._.path),this._.graticule}var n=d3.geoGraticule(),s={svg:null,select:null};return t=Object.assign({hideGraticule:!1},t),{name:"graticulePlugin",onInit(){Object.assign(this._.options,t),this.svgAddGraticule=e,s.svg=this._.svg},onRefresh(){this._.graticule&&!this._.options.hideGraticule&&this._.graticule.attr("d",this._.path)},select(t){return s.select=t,s.svg=d3.selectAll(t),s.svg}}},fauxGlobePlugin:function(t={}){function e(){if(i.svg.selectAll("#drop_shadow,.drop_shadow").remove(),!this._.options.hideGlobeShadow){var t=this._.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");t.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),t.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),this._.dropShadow=i.svg.append("ellipse").attr("cx",this._.options.width/2).attr("cy",this._.options.height-50).attr("rx",.9*this._.proj.scale()).attr("ry",.25*this._.proj.scale()).attr("class","drop_shadow noclicks").style("fill","url(#drop_shadow)"),this._.dropShadow}}function n(){if(i.svg.selectAll("#globe_shading,.globe_shading").remove(),!this._.options.hideGlobeShading){var t=this._.defs.append("radialGradient").attr("id","globe_shading").attr("cx","50%").attr("cy","40%");return t.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),t.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),this._.globeShading=i.svg.append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale()).attr("class","globe_shading noclicks").style("fill","url(#globe_shading)"),this._.globeShading}}function s(){if(i.svg.selectAll("#globe_hilight,.globe_hilight").remove(),!this._.options.hideGlobeHilight){var t=this._.defs.append("radialGradient").attr("id","globe_hilight").attr("cx","75%").attr("cy","25%");return t.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),t.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),this._.globeHilight=i.svg.append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale()).attr("class","globe_hilight noclicks").style("fill","url(#globe_hilight)"),this._.globeHilight}}var i={svg:null,select:null};return t=Object.assign({hideGlobeShadow:!1,hideGlobeShading:!1,hideGlobeHilight:!1},t),{name:"fauxGlobePlugin",onInit(){Object.assign(this._.options,t),this.svgAddDropShadow=e,this.svgAddGlobeHilight=s,this.svgAddGlobeShading=n,i.svg=this._.svg},onResize(){this._.globeShading&&!this._.options.hideGlobeShading&&this._.globeShading.attr("r",this._.proj.scale()),this._.globeHilight&&!this._.options.hideGlobeHilight&&this._.globeHilight.attr("r",this._.proj.scale())},select(t){return i.select=t,i.svg=d3.selectAll(t),i.svg}}},autorotatePlugin:function(t){var e={stop:!1,lastTick:null,degree:t};return{name:"autorotatePlugin",onInit(){},onInterval(){var t=new Date;if(!e.lastTick||e.stop||this._.drag)e.lastTick=t;else{var n=t-e.lastTick,s=this._.proj.rotate();s[0]+=e.degree*n/1e3,s[0]>=180&&(s[0]-=360),this._.rotate(s),e.lastTick=t}},speed(t){e.degree=t},start(){e.stop=!1},stop(){e.stop=!0}}},placesPlugin:function(t="./d/places.json"){function e(){o.svg.selectAll(".points,.labels").remove(),o.places&&this._.options.places&&!this._.options.hidePlaces&&(n.call(this),s.call(this),i.call(this))}function n(){return this._.placePoints=o.svg.append("g").attr("class","points").selectAll("path").data(o.places.features).enter().append("path").attr("class","point").attr("d",this._.path),this._.placePoints}function s(){return this._.placeLabels=o.svg.append("g").attr("class","labels").selectAll("text").data(o.places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name}),this._.placeLabels}function i(){var t=this,e=this._.proj.invert([this._.options.width/2,this._.options.height/2]);this._.placeLabels.attr("text-anchor",function(e){var n=t._.proj(e.geometry.coordinates)[0];return n<t._.options.width/2-20?"end":n<t._.options.width/2+20?"middle":"start"}).attr("transform",function(e){var n=t._.proj(e.geometry.coordinates),s=n[0],i=n[1];return"translate("+(s+(s<t._.options.width/2?-5:5))+","+(i-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,e)>1.57?"none":"inline"})}var o={svg:null,select:null,places:null};return{name:"placesPlugin",data:[t],onReady(t,e){o.places=e,this.svgDraw()},onInit(){this._.options.places=!0,this._.options.hidePlaces=!1,this.svgAddPlaces=e,o.svg=this._.svg},onRefresh(){this._.placePoints&&this._.options.places&&(this._.placePoints.attr("d",this._.path),i.call(this))},select(t){return o.select=t,o.svg=d3.selectAll(t),o.svg}}},worldPlugin:function(t="./d/world-110m.json",e){function n(){a.svg.selectAll(".land,.lakes,.countries").remove(),this._.options.hideLand||a.world&&(this._.options.hideCountries?this.svgAddWorld.call(this):this.svgAddCountries.call(this),this.svgAddLakes.call(this))}function s(){return this._.countries=a.svg.append("g").attr("class","countries").selectAll("path").data(topojson.feature(a.world,a.world.objects.countries).features).enter().append("path").attr("id",function(t){return"x"+t.id}).on("click",r).attr("d",this._.path),this._.countries}function i(){return this._.world=a.svg.append("g").attr("class","land").append("path").datum(topojson.feature(a.world,a.world.objects.land)).attr("d",this._.path),this._.world}function o(){return this._.lakes=a.svg.append("g").attr("class","lakes").append("path").datum(topojson.feature(a.world,a.world.objects.ne_110m_lakes)).attr("d",this._.path),this._.lakes}var a={svg:null,select:null,world:null,countryNames:null},r=function(){},l=[t];return e&&l.push(e),{name:"worldPlugin",data:l,onReady(t,e,n){a.countryNames=n,a.world=e,this.svgDraw()},onInit(){this._.options.world=!0,this._.options.hideLand=!1,this._.options.hideCountries=!1,this.svgAddWorldOrCountries=n,this.svgAddCountries=s,this.svgAddWorld=i,this.svgAddLakes=o,a.svg=this._.svg},onRefresh(){this._.options.hideLand||(this._.options.hideCountries?this._.world.attr("d",this._.path):this._.countries.attr("d",this._.path),this._.lakes.attr("d",this._.path))},countryName(t){return a.countryNames.find(function(e){return e.id==t.id})},select(t){return a.select=t,a.svg=d3.selectAll(t),a.svg}}},countryTooltipPlugin:function(){var t=d3.select("body").append("div").attr("class","countryTooltip");return{name:"countryTooltipPlugin",onInit(){var e=this,n=this.svgAddCountries;this.svgAddCountries=function(){return n.call(this).on("mouseover",function(n){var s=e.worldPlugin.countryName(n);t.text(s.name).style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px").style("display","block").style("opacity",1)}).on("mouseout",function(){t.style("opacity",0).style("display","none")}).on("mousemove",function(){t.style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px")})}}}}},t});