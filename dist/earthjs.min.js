!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):t.earthjs=s()}(this,function(){"use strict";var t=function(t={}){function s(t,s){var n=s+"Keys";t[s]&&(e[s][t.name]=t[s],e[n]=Object.keys(e[s]))}t=Object.assign({select:"#earth",height:500,width:700},t);var e={onResize:{},onResizeKeys:[],onRefresh:{},onRefreshKeys:[],onInterval:{},onIntervalKeys:[],svgCreateOrder:["svgAddDropShadow","svgAddOcean","svgAddGlobeShading","svgAddGraticule","svgAddWorldOrCountries","svgAddGlobeHilight","svgAddPlaces"]},n=d3.selectAll(t.select).attr("width",t.width).attr("height",t.height),o=d3.geoOrthographic().scale(t.width/3.5).translate([t.width/2,t.height/2]),i=d3.geoPath().projection(o),a={_:{svg:n,proj:o,path:i,drag:!1,options:t,loadingData:!1},register:function(t){var e={};if(a[t.name]=e,Object.keys(t).map(function(s){-1===["urls","onReady","onInit","onResize","onRefresh","onInterval"].indexOf(s)&&"function"==typeof t[s]&&(e[s]=function(){return t[s].apply(a,arguments)})}),t.onInit&&t.onInit.call(a),s(t,"onResize"),s(t,"onRefresh"),s(t,"onInterval"),t.urls&&t.onReady){a._.loadingData=!0;var n=d3.queue();t.urls.forEach(function(t){var s=t.split(".").pop();n.defer(d3[s],t)}),n.await(function(){a._.loadingData=!1,t.onReady.apply(a,arguments)})}return a}};a._.defs=a._.svg.append("defs");var r=null,l=null;return a._.ticker=function(t){return t=t||50,l=setInterval(function(){a._.intervalRun.call(a),r&&r._.intervalRun.call(r)},t),a},a.svgDraw=function(t){return e.svgCreateOrder.forEach(function(t){a[t]&&a[t].call(a)}),t&&(t.svgDraw(null),r=t),null===l&&null!==t&&a._.ticker.call(a),a},a._.scale=function(t){return a._.proj.scale(t),a._.resize.call(a),a._.refresh.call(a),a},a._.rotate=function(t){return a._.proj.rotate(t),a._.refresh.call(a),a},a._.intervalRun=function(){e.onIntervalKeys.length>0&&e.onIntervalKeys.map(function(t){e.onInterval[t].call(a)})},a._.refresh=function(){return e.onRefreshKeys.length>0&&e.onRefreshKeys.map(function(t){e.onRefresh[t].call(a)}),a},a._.resize=function(){return e.onResizeKeys.length>0&&e.onResizeKeys.map(function(t){e.onResize[t].call(a)}),a},a},s=function(){function t(t){var s=t[0]/2*d,e=h(s),n=a(s),o=t[1]/2*d,i=h(o),r=a(o),l=t[2]/2*d,c=h(l),u=a(l);return[n*r*u+e*i*c,e*r*u-n*i*c,n*i*u+e*r*c,n*r*c-e*i*u]}function s(t,s){return[t[1]*s[2]-t[2]*s[1],t[2]*s[0]-t[0]*s[2],t[0]*s[1]-t[1]*s[0]]}function e(t,s){return t[0]*s[0]+t[1]*s[1]+t[2]*s[2]}var n=Math.acos,o=Math.asin,i=Math.atan2,a=Math.cos,r=Math.max,l=Math.min,c=Math.PI,h=Math.sin,u=Math.sqrt,d=c/180,p=180/c;return t.cartesian=function(t){var s=t[0]*d,e=t[1]*d,n=a(e);return[n*a(s),n*h(s),h(e)]},t.rotation=function(t){return[i(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*p,o(r(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*p,i(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*p]},t.delta=function(t,o){var i=s(t,o),c=u(e(i,i));if(!c)return[1,0,0,0];var d=n(r(-1,l(1,e(t,o))))/2,p=h(d);return[a(d),i[2]/c*p,-i[1]/c*p,i[0]/c*p]},t.multiply=function(t,s){return[t[0]*s[0]-t[1]*s[1]-t[2]*s[2]-t[3]*s[3],t[0]*s[1]+t[1]*s[0]+t[2]*s[3]-t[3]*s[2],t[0]*s[2]-t[1]*s[3]+t[2]*s[0]+t[3]*s[1],t[0]*s[3]+t[1]*s[2]-t[2]*s[1]+t[3]*s[0]]},t}();return t.plugins={versorDragPlugin:function(){return{name:"versorDragPlugin",onInit(){function t(){o._.drag=!0,i=s.cartesian(o._.proj.invert(d3.mouse(this))),a=o._.proj.rotate(),r=s(a)}function e(){o._.drag=!1}function n(){var t=s.cartesian(o._.proj.rotate(a).invert(d3.mouse(this))),e=s.multiply(r,s.delta(i,t)),n=s.rotation(e);o._.rotate(n)}var o=this;this._.svg.call(d3.drag().on("start",t).on("end",e).on("drag",n));var i,a,r}}},wheelZoomPlugin:function(){return{name:"wheelZoomPlugin",onInit(){var t=this;this._.svg.on("wheel",function(){var s=d3.event.deltaY+t._.proj.scale();s>230&&s<1e3&&t._.scale(s)})}}},oceanPlugin:function(t={}){function s(){if(e.svg.selectAll("#ocean,.ocean").remove(),this._.options.showOcean){var t=this._.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");return t.append("stop").attr("offset","5%").attr("stop-color","#ddf"),t.append("stop").attr("offset","100%").attr("stop-color","#9ab"),this._.ocean=e.svg.append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale()).attr("class","ocean noclicks"),this._.ocean}}var e={svg:null,select:null};return t=Object.assign({showOcean:!0},t),{name:"oceanPlugin",onInit(){Object.assign(this._.options,t),this.svgAddOcean=s,e.svg=this._.svg},onResize(){this._.ocean&&this._.options.showOcean&&this._.ocean.attr("r",this._.proj.scale())},select(t){return e.svg=d3.selectAll(t),e.select=t,e.svg}}},configPlugin:function(){return{name:"configPlugin",set(t){if(t){if(Object.assign(this._.options,t),void 0!==t.stop){var s=this.autorotatePlugin;t.stop?s.stop():s.start()}this._.drag=!0,this.svgDraw(),this._.drag=!1}return Object.assign({},this._.options)}}},graticulePlugin:function(t={}){function s(){if(n.svg.selectAll(".graticule").remove(),this._.options.showGraticule)return this._.graticule=n.svg.append("g").attr("class","graticule").append("path").datum(e).attr("class","noclicks").attr("d",this._.path),this._.graticule}var e=d3.geoGraticule(),n={svg:null,select:null};return t=Object.assign({showGraticule:!0},t),{name:"graticulePlugin",onInit(){Object.assign(this._.options,t),this.svgAddGraticule=s,n.svg=this._.svg},onRefresh(){this._.graticule&&this._.options.showGraticule&&this._.graticule.attr("d",this._.path)},select(t){return n.svg=d3.selectAll(t),n.select=t,n.svg}}},fauxGlobePlugin:function(t={}){function s(){if(o.svg.selectAll("#drop_shadow,.drop_shadow").remove(),this._.options.showGlobeShadow){var t=this._.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");t.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),t.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),this._.dropShadow=o.svg.append("ellipse").attr("cx",this._.options.width/2).attr("cy",this._.options.height-50).attr("rx",.9*this._.proj.scale()).attr("ry",.25*this._.proj.scale()).attr("class","drop_shadow noclicks").style("fill","url(#drop_shadow)"),this._.dropShadow}}function e(){if(o.svg.selectAll("#globe_shading,.globe_shading").remove(),this._.options.showGlobeShading){var t=this._.defs.append("radialGradient").attr("id","globe_shading").attr("cx","50%").attr("cy","40%");return t.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),t.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),this._.globeShading=o.svg.append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale()).attr("class","globe_shading noclicks").style("fill","url(#globe_shading)"),this._.globeShading}}function n(){if(o.svg.selectAll("#globe_hilight,.globe_hilight").remove(),this._.options.showGlobeHilight){var t=this._.defs.append("radialGradient").attr("id","globe_hilight").attr("cx","75%").attr("cy","25%");return t.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),t.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),this._.globeHilight=o.svg.append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale()).attr("class","globe_hilight noclicks").style("fill","url(#globe_hilight)"),this._.globeHilight}}var o={svg:null,select:null};return t=Object.assign({showGlobeShadow:!0,showGlobeShading:!0,showGlobeHilight:!0},t),{name:"fauxGlobePlugin",onInit(){Object.assign(this._.options,t),this.svgAddDropShadow=s,this.svgAddGlobeHilight=n,this.svgAddGlobeShading=e,o.svg=this._.svg},onResize(){this._.globeShading&&this._.options.showGlobeShading&&this._.globeShading.attr("r",this._.proj.scale()),this._.globeHilight&&this._.options.showGlobeHilight&&this._.globeHilight.attr("r",this._.proj.scale())},select(t){return o.svg=d3.selectAll(t),o.select=t,o.svg}}},autorotatePlugin:function(t){var s={stop:!1,lastTick:null,degree:t};return{name:"autorotatePlugin",onInit(){},onInterval(){var t=new Date;if(!s.lastTick||s.stop||this._.drag)s.lastTick=t;else{var e=t-s.lastTick,n=this._.proj.rotate();n[0]+=s.degree*e/1e3,n[0]>=180&&(n[0]-=360),this._.rotate(n),s.lastTick=t}},speed(t){s.degree=t},start(){s.stop=!1},stop(){s.stop=!0}}},placesPlugin:function(t){function s(){i.svg.selectAll(".points,.labels").remove(),i.places&&this._.options.showPlaces&&(e.call(this),n.call(this),o.call(this))}function e(){return this._.placePoints=i.svg.append("g").attr("class","points").selectAll("path").data(i.places.features).enter().append("path").attr("class","point").attr("d",this._.path),this._.placePoints}function n(){return this._.placeLabels=i.svg.append("g").attr("class","labels").selectAll("text").data(i.places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name}),this._.placeLabels}function o(){var t=this,s=this._.proj.invert([this._.options.width/2,this._.options.height/2]);this._.placeLabels.attr("text-anchor",function(s){var e=t._.proj(s.geometry.coordinates)[0];return e<t._.options.width/2-20?"end":e<t._.options.width/2+20?"middle":"start"}).attr("transform",function(s){var e=t._.proj(s.geometry.coordinates),n=e[0],o=e[1];return"translate("+(n+(n<t._.options.width/2?-5:5))+","+(o-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,s)>1.57?"none":"inline"})}var i={svg:null,select:null,places:null};return{name:"placesPlugin",urls:t&&[t],onReady(t,s){i.places=s,this.svgDraw()},onInit(){this._.options.showPlaces=!0,this.svgAddPlaces=s,i.svg=this._.svg},onRefresh(){this._.placePoints&&(this._.placePoints.attr("d",this._.path),o.call(this))},select(t){return i.svg=d3.selectAll(t),i.select=t,i.svg},data(t){if(!t)return{places:i.places};var s=t.placesPlugin.data();i.places=s.places}}},worldPlugin:function(t,s){function e(){a.svg.selectAll(".land,.lakes,.countries").remove(),this._.options.showLand&&a.world&&(this._.options.showCountries?this.svgAddCountries.call(this):this.svgAddWorld.call(this),this._.options.showLakes&&this.svgAddLakes.call(this))}function n(){return this._.countries=a.svg.append("g").attr("class","countries").selectAll("path").data(topojson.feature(a.world,a.world.objects.countries).features).enter().append("path").attr("id",function(t){return"x"+t.id}).on("click",r).attr("d",this._.path),this._.countries}function o(){return this._.world=a.svg.append("g").attr("class","land").append("path").datum(topojson.feature(a.world,a.world.objects.land)).attr("d",this._.path),this._.world}function i(){return this._.lakes=a.svg.append("g").attr("class","lakes").append("path").datum(topojson.feature(a.world,a.world.objects.ne_110m_lakes)).attr("d",this._.path),this._.lakes}var a={svg:null,select:null,world:null,countryNames:null},r=function(){},l=null;return t&&(l=[t],s&&l.push(s)),{name:"worldPlugin",urls:l,onReady(t,s,e){a.world=s,a.countryNames=e,"function"==typeof this.worldPlugin.ready?this.worldPlugin.ready.call(this):this.svgDraw()},onInit(){this._.options.showLand=!0,this._.options.showLakes=!0,this._.options.showCountries=!0,this.svgAddWorldOrCountries=e,this.svgAddCountries=n,this.svgAddWorld=o,this.svgAddLakes=i,a.svg=this._.svg},onRefresh(){a.world&&this._.options.showLand&&(this._.options.showCountries?this._.countries.attr("d",this._.path):this._.world.attr("d",this._.path),this._.options.showLakes&&this._.lakes.attr("d",this._.path))},countryName(t){var s="";return a.countryNames&&(s=a.countryNames.find(function(s){return s.id==t.id})),s},select(t){return a.svg=d3.selectAll(t),a.select=t,a.svg},data(t){if(!t)return{countryNames:a.countryNames,world:a.world};var s=t.worldPlugin.data();a.countryNames=s.countryNames,a.world=s.world}}},countryTooltipPlugin:function(){var t=d3.select("body").append("div").attr("class","countryTooltip");return{name:"countryTooltipPlugin",onInit(){var s=this,e=this.svgAddCountries;this.svgAddCountries=function(){return e.call(this).on("mouseover",function(e){var n=s.worldPlugin.countryName.call(s,e);t.text(n.name).style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px").style("display","block").style("opacity",1)}).on("mouseout",function(){t.style("opacity",0).style("display","none")}).on("mousemove",function(){t.style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px")})}}}}},t});