!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.earthjs=e()}(this,function(){"use strict";var t=function(t={}){function e(t,e){var a=e+"Keys";t[e]&&(o[e][t.name]=t[e],o[a]=Object.keys(o[e]))}function a(e){return e.svgCreateOrder.forEach(function(a){e[a]&&e[a](e,t)}),e}function n(t,e){return o.onRefreshKeys.length>0&&o.onRefreshKeys.map(function(a){o.onRefresh[a](t,e)}),t}function r(t,e){return o.onResizeKeys.length>0&&o.onResizeKeys.map(function(a){o.onResize[a](t,e)}),t}t=Object.assign({select:"#earth",interval:50,height:870,width:1700},t);var o={onResize:{},onResizeKeys:[],onRefresh:{},onRefreshKeys:[],onInterval:{},onIntervalKeys:[]},i=d3.select(t.select).attr("width",t.width).attr("height",t.height),s=d3.geoOrthographic().scale(t.width/4.1).translate([t.width/2,t.height/2]).precision(.1),l=d3.geoPath().projection(s),c={svg:i,proj:s,path:l,state:{drag:!1},width:t.width,height:t.height,register:function(a){var n={};if(c[a.name]=n,Object.keys(a).map(function(e){-1===["onResize","onInterval","onRefresh","ready","data"].indexOf(e)&&"function"==typeof a[e]&&(n[e]=function(){var n=[].slice.call(arguments);return n.unshift(c,t),a[e].apply(null,n)})}),a.onInit&&a.onInit(c,t),e(a,"onResize"),e(a,"onRefresh"),e(a,"onInterval"),a.data&&a.ready){var r=d3.queue();a.data.forEach(function(t){var e=t.split(".").pop();r.defer(d3[e],t)}),r.await(function(){var e=[].slice.call(arguments);e.unshift(c,t),a.ready.apply(null,e)})}return c}};c.defs=c.svg.append("defs"),c.resize=r,c.refresh=n,c.recreateSvg=a,c.svgCreateOrder=["addGlobeDropShadow","addOcean","addGlobeShading","addWorldOrCountries","addGlobeHilight","addGraticule","addPlaces"];var d;return c.ticker=function(e){return e&&(t.interval=e,clearInterval(d)),d=setInterval(function(){o.onIntervalKeys.length>0&&o.onIntervalKeys.map(function(e){o.onInterval[e](c,t)})},t.interval),c},c.scale=function(e){return c.proj.scale(e),c.resize(c,t),c.refresh(c,t),c},c.rotate=function(e){return c.proj.rotate(e),c.refresh(c,t),c},c},e=function(){function t(t){var e=t[0]/2*p,a=d(e),n=i(e),r=t[1]/2*p,o=d(r),s=i(r),l=t[2]/2*p,c=d(l),u=i(l);return[n*s*u+a*o*c,a*s*u-n*o*c,n*o*u+a*s*c,n*s*c-a*o*u]}function e(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function a(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}var n=Math.acos,r=Math.asin,o=Math.atan2,i=Math.cos,s=Math.max,l=Math.min,c=Math.PI,d=Math.sin,u=Math.sqrt,p=c/180,f=180/c;return t.cartesian=function(t){var e=t[0]*p,a=t[1]*p,n=i(a);return[n*i(e),n*d(e),d(a)]},t.rotation=function(t){return[o(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*f,r(s(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*f,o(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*f]},t.delta=function(t,r){var o=e(t,r),c=u(a(o,o));if(!c)return[1,0,0,0];var p=n(s(-1,l(1,a(t,r))))/2,f=d(p);return[i(p),o[2]/c*f,-o[1]/c*f,o[0]/c*f]},t.multiply=function(t,e){return[t[0]*e[0]-t[1]*e[1]-t[2]*e[2]-t[3]*e[3],t[0]*e[1]+t[1]*e[0]+t[2]*e[3]-t[3]*e[2],t[0]*e[2]-t[1]*e[3]+t[2]*e[0]+t[3]*e[1],t[0]*e[3]+t[1]*e[2]-t[2]*e[1]+t[3]*e[0]]},t}();return t.plugins={versorDragPlugin:function(){return{name:"versorDragPlugin",onInit(t){function a(){t.state.drag=!0,o=e.cartesian(t.proj.invert(d3.mouse(this))),i=t.proj.rotate(),s=e(i)}function n(){t.state.drag=!1}function r(){var a=e.cartesian(t.proj.rotate(i).invert(d3.mouse(this))),n=e.multiply(s,e.delta(o,a)),r=e.rotation(n);t.rotate(r)}t.svg.call(d3.drag().on("start",a).on("end",n).on("drag",r));var o,i,s}}},wheelZoomPlugin:function(){return{name:"wheelZoomPlugin",onInit(t){t.svg.on("wheel",function(){var e=d3.event.deltaY+t.proj.scale();e>230&&e<1e3&&t.scale(e)})}}},oceanPlugin:function(t={}){function e(t,e){if(t.svg.selectAll("#ocean,.ocean").remove(),!e.hideOcean){var a=t.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");return a.append("stop").attr("offset","5%").attr("stop-color","#ddf"),a.append("stop").attr("offset","100%").attr("stop-color","#9ab"),t.ocean=t.svg.append("circle").attr("cx",t.width/2).attr("cy",t.height/2).attr("r",t.proj.scale()).attr("class","ocean noclicks").style("fill","url(#ocean)"),t.ocean}}return t=Object.assign({hideOcean:!1},t),{name:"oceanPlugin",onInit(a,n){Object.assign(n,t),a.addOcean=e},onResize(t,e){t.ocean&&!e.hideOcean&&t.ocean.attr("r",t.proj.scale())}}},configPlugin:function(){return{name:"configPlugin",set(t,e,a){return a&&(Object.assign(e,a),t.state.drag=!0,t.recreateSvg(t),t.state.drag=!1),Object.assign({},e)}}},graticulePlugin:function(t={}){function e(t,e){if(t.svg.selectAll(".graticule").remove(),!e.hideGraticule)return t.graticule=t.svg.append("g").attr("class","graticule").append("path").datum(t.datumGraticule).attr("class","noclicks").attr("d",t.path),t.graticule}return t=Object.assign({hideGraticule:!1},t),{name:"graticulePlugin",onInit(a,n){a.datumGraticule=d3.geoGraticule(),Object.assign(n,t),a.addGraticule=e},onRefresh(t,e){t.graticule&&!e.hideGraticule&&t.graticule.attr("d",t.path)}}},fauxGlobePlugin:function(t={}){function e(t,e){if(t.svg.selectAll("#drop_shadow,.drop_shadow").remove(),!e.hideGlobeShadow){var a=t.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");a.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),a.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),t.dropShadow=t.svg.append("ellipse").attr("cx",t.width/2).attr("cy",t.height-50).attr("rx",.9*t.proj.scale()).attr("ry",.25*t.proj.scale()).attr("class","drop_shadow noclicks").style("fill","url(#drop_shadow)"),t.dropShadow}}function a(t,e){if(t.svg.selectAll("#globe_shading,.globe_shading").remove(),!e.hideGlobeShading){var a=t.defs.append("radialGradient").attr("id","globe_shading").attr("cx","50%").attr("cy","40%");return a.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),a.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),t.globeShading=t.svg.append("circle").attr("cx",t.width/2).attr("cy",t.height/2).attr("r",t.proj.scale()).attr("class","globe_shading noclicks").style("fill","url(#globe_shading)"),t.globeShading}}function n(t,e){if(t.svg.selectAll("#globe_hilight,.globe_hilight").remove(),!e.hideGlobeHilight){var a=t.defs.append("radialGradient").attr("id","globe_hilight").attr("cx","75%").attr("cy","25%");return a.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),a.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),t.globeHilight=t.svg.append("circle").attr("cx",t.width/2).attr("cy",t.height/2).attr("r",t.proj.scale()).attr("class","globe_hilight noclicks").style("fill","url(#globe_hilight)"),t.globeHilight}}return t=Object.assign({hideGlobeShadow:!1,hideGlobeShading:!1,hideGlobeHilight:!1},t),{name:"fauxGlobePlugin",onInit(r,o){Object.assign(o,t),r.addGlobeDropShadow=e,r.addGlobeHilight=n,r.addGlobeShading=a},onResize(t,e){t.globeShading&&!e.hideGlobeShading&&t.globeShading.attr("r",t.proj.scale()),t.globeHilight&&!e.hideGlobeHilight&&t.globeHilight.attr("r",t.proj.scale())}}},autorotatePlugin:function(t){var e=null;return{name:"autorotatePlugin",onInit(e,a){e.degPerSec=t,a.stop=!1},onInterval(t,a){var n=new Date;if(t.state.drag||a.stop||!e)e=n;else{var r=n-e,o=t.proj.rotate();o[0]+=t.degPerSec*r/1e3,o[0]>=180&&(o[0]-=360),t.proj.rotate(o),t.refresh(t,a),e=n}},speed(t,e,a){t.degPerSec=a},start(t,e){e.stop=!1},stop(t,e){e.stop=!0}}},placesPlugin:function(t="./d/places.json"){function e(t,e){t.svg.selectAll(".points,.labels").remove(),t._places&&e.places&&!e.hidePlaces&&(a(t),n(t),r(t))}function a(t){return t.placePoints=t.svg.append("g").attr("class","points").selectAll("path").data(t._places.features).enter().append("path").attr("class","point").attr("d",t.path),t.placePoints}function n(t){return t.placeLabels=t.svg.append("g").attr("class","labels").selectAll("text").data(t._places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name}),t.placeLabels}function r(t){var e=t.proj.invert([t.width/2,t.height/2]);t.placeLabels.attr("text-anchor",function(e){var a=t.proj(e.geometry.coordinates)[0];return a<t.width/2-20?"end":a<t.width/2+20?"middle":"start"}).attr("transform",function(e){var a=t.proj(e.geometry.coordinates),n=a[0],r=a[1];return"translate("+(n+(n<t.width/2?-5:5))+","+(r-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,e)>1.57?"none":"inline"})}return{name:"placesPlugin",data:[t],ready(t,e,a,n){t._places=n,t.recreateSvg(t)},onInit(t,a){a.places=!0,a.hidePlaces=!1,t.addPlaces=e},onRefresh(t,e){t.placePoints&&e.places&&(t.placePoints.attr("d",t.path),r(t))}}},worldPlugin:function(t="./d/world-110m.json",e){function a(t,e){t.svg.selectAll(".land,.lakes,.countries").remove(),e.hideLand||t._world&&(e.hideCountries?t.addWorld(t,e):t.addCountries(t,e),t.addLakes(t,e))}function n(t){return t.countries=t.svg.append("g").attr("class","countries").selectAll("path").data(topojson.feature(t._world,t._world.objects.countries).features).enter().append("path").attr("id",function(t){return"x"+t.id}).on("click",i).attr("d",t.path),t.countries}function r(t){return t.world=t.svg.append("g").attr("class","land").append("path").datum(topojson.feature(t._world,t._world.objects.land)).attr("d",t.path),t.world}function o(t){return t.lakes=t.svg.append("g").attr("class","lakes").append("path").datum(topojson.feature(t._world,t._world.objects.ne_110m_lakes)).attr("d",t.path),t.lakes}var i=function(){},s=[t];return e&&s.push(e),{name:"worldPlugin",data:s,ready(t,e,a,n,r){t._world=n,t._countryNames=r,t.recreateSvg(t)},onInit(t,e){e.world=!0,e.hideLand=!1,e.hideCountries=!1,t.addWorldOrCountries=a,t.addCountries=n,t.addWorld=r,t.addLakes=o},onRefresh(t,e){e.hideLand||(e.hideCountries?t.world.attr("d",t.path):t.countries.attr("d",t.path),t.lakes.attr("d",t.path))}}},countryTooltipPlugin:function(){var t=d3.select("body").append("div").attr("class","countryTooltip");return{name:"countryTooltipPlugin",onInit(e){var a=e.addCountries;e.addCountries=function(e,n){return a(e,n).on("mouseover",function(a){var n=e._countryNames.find(function(t){return t.id==a.id});t.text(n.name).style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px").style("display","block").style("opacity",1)}).on("mouseout",function(){t.style("opacity",0).style("display","none")}).on("mousemove",function(){t.style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px")}),e.countries}}}}},t});