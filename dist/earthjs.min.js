!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.earthjs=n()}(this,function(){"use strict";var t=function(t={}){function n(t,n){var i=n+"Keys";t[n]&&(a[n][t.name]=t[n],a[i]=Object.keys(a[n]))}t=Object.assign({select:"#earth",rotate:130,height:500,width:700},t);var a={onResize:{},onResizeKeys:[],onRefresh:{},onRefreshKeys:[],onInterval:{},onIntervalKeys:[],svgCreateOrder:["svgAddDropShadow","svgAddCanvas","canvasAddGraticule","canvasAddWorldOrCountries","svgAddOcean","svgAddGlobeShading","svgAddGraticule","svgAddWorldOrCountries","svgAddGlobeHilight","svgAddPlaces","svgAddBar"],ready:null,loadingData:null},i=t.width,e=t.height,s=d3.scaleLinear().domain([0,i]).range([-180,180]),o=d3.selectAll(t.select).attr("width",i).attr("height",e),r={_:{svg:o,drag:!1,options:t,ltScale:s},ready:function(t){if(!t)return a.loadingData;a.ready=t},register:function(t){var i={};if(r[t.name]=i,Object.keys(t).map(function(n){-1===["urls","onReady","onInit","onResize","onRefresh","onInterval"].indexOf(n)&&"function"==typeof t[n]&&(i[n]=function(){return t[n].apply(r,arguments)})}),t.onInit&&t.onInit.call(r),n(t,"onResize"),n(t,"onRefresh"),n(t,"onInterval"),t.urls&&t.onReady){a.loadingData=!0;var e=d3.queue();t.urls.forEach(function(t){var n=t.split(".").pop();e.defer(d3[n],t)}),e.await(function(){t.onReady.apply(r,arguments),a.loadingData=!1,a.ready.call(r)})}return r}};r._.defs=r._.svg.append("defs");var l=null,c=null;return r._.ticker=function(t){return t=t||50,c=setInterval(function(){r._.intervalRun.call(r),l&&l.forEach(function(t){t._.intervalRun.call(t)})},t),r},r.svgDraw=function(t){return l=t,a.svgCreateOrder.forEach(function(t){r[t]&&r[t].call(r)}),l&&l.forEach(function(t){t.svgDraw(null)}),null===c&&null!==t&&r._.ticker.call(r),r},r._.scale=function(t){return r._.proj.scale(t),r._.resize.call(r),r._.refresh.call(r),r},r._.rotate=function(t){return r._.proj.rotate(t),r._.refresh.call(r),r},r._.intervalRun=function(){a.onIntervalKeys.length>0&&a.onIntervalKeys.map(function(t){a.onInterval[t].call(r)})},r._.refresh=function(){return a.onRefreshKeys.length>0&&a.onRefreshKeys.map(function(t){a.onRefresh[t].call(r)}),r},r._.resize=function(){return a.onResizeKeys.length>0&&a.onResizeKeys.map(function(t){a.onResize[t].call(r)}),r},r._.orthoGraphic=function(){var t=r._.options.width,n=r._.options.height,a=r._.options.rotate,i=r._.ltScale(a);return d3.geoOrthographic().scale(t/3.5).rotate([i,0]).translate([t/2,n/2]).clipAngle(90)},r._.proj=r._.orthoGraphic(),r._.path=d3.geoPath().projection(r._.proj),r},n=function(){function t(t){var n=t[0]/2*d,a=u(n),i=o(n),e=t[1]/2*d,s=u(e),r=o(e),l=t[2]/2*d,c=u(l),h=o(l);return[i*r*h+a*s*c,a*r*h-i*s*c,i*s*h+a*r*c,i*r*c-a*s*h]}function n(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function a(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}var i=Math.acos,e=Math.asin,s=Math.atan2,o=Math.cos,r=Math.max,l=Math.min,c=Math.PI,u=Math.sin,h=Math.sqrt,d=c/180,p=180/c;return t.cartesian=function(t){var n=t[0]*d,a=t[1]*d,i=o(a);return[i*o(n),i*u(n),u(a)]},t.rotation=function(t){return[s(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*p,e(r(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*p,s(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*p]},t.delta=function(t,e){var s=n(t,e),c=h(a(s,s));if(!c)return[1,0,0,0];var d=i(r(-1,l(1,a(t,e))))/2,p=u(d);return[o(d),s[2]/c*p,-s[1]/c*p,s[0]/c*p]},t.multiply=function(t,n){return[t[0]*n[0]-t[1]*n[1]-t[2]*n[2]-t[3]*n[3],t[0]*n[1]+t[1]*n[0]+t[2]*n[3]-t[3]*n[2],t[0]*n[2]-t[1]*n[3]+t[2]*n[0]+t[3]*n[1],t[0]*n[3]+t[1]*n[2]-t[2]*n[1]+t[3]*n[0]]},t}();return t.plugins={versorDragPlugin:function(){function t(){function t(t){var n=t._.proj.rotate(),a=n[0]-l[0];n[0]=a+this._.proj.rotate()[0],n[0]>=180&&(n[0]-=360),this._.rotate(n)}function i(){o._.drag=!0,r=n.cartesian(o._.proj.invert(d3.mouse(this))),l=o._.proj.rotate(),c=n(l)}function e(){a.sync.forEach(function(n){t.call(n,o)}),o._.drag=!1}function s(){var t=n.cartesian(o._.proj.rotate(l).invert(d3.mouse(this))),a=n.multiply(c,n.delta(r,t)),i=n.rotation(a);o._.rotate(i)}var o=this;a.svg.call(d3.drag().on("start",i).on("end",e).on("drag",s));var r,l,c}var a={svg:null,q:null,sync:[]};return{name:"versorDragPlugin",onInit(){a.svg=this._.svg,t.call(this)},selectAll(n){return n&&(a.q=n,a.svg=d3.selectAll(n),t.call(this)),a.svg},sync(t){a.sync=t}}},wheelZoomPlugin:function(){return{name:"wheelZoomPlugin",onInit(){var t=this;this._.svg.on("wheel",function(){var n=d3.event.deltaY+t._.proj.scale();n>230&&n<1e3&&t._.scale(n)})}}},canvasPlugin:function(){function t(){if(this._.options.showCanvas){if(!n.canvas){var t=this._.svg.append("g").attr("class","canvas").append("foreignObject").attr("x",0).attr("y",0).attr("width",this._.options.width).attr("height",this._.options.height),a=t.append("xhtml:body").style("margin","0px").style("padding","0px").style("background-color","none").style("width",this._.options.width+"px").style("height",this._.options.height+"px");n.canvas=a.append("canvas")}return n.canvas.attr("x",0).attr("y",0).attr("width",this._.options.width).attr("height",this._.options.height),n.canvas}}var n={canvas:null,path:null,q:null};return{name:"canvasPlugin",onInit(){this.svgAddCanvas=t,this._.options.showCanvas=!0,n.path=d3.geoPath().projection(this._.proj)},onRefresh(){var t=this._.options.width,a=this._.options.height;n.canvas.each(function(){this.getContext("2d").clearRect(0,0,t,a)})},selectAll(t){return t&&(n.q=t,n.canvas=d3.selectAll(t)),n.canvas},render(t){if(this._.options.showCanvas){var a=this;n.canvas.each(function(){var i=this.getContext("2d");t.call(a,i,n.path.context(i))})}}}},oceanPlugin:function(t={}){function n(){if(a.svg.selectAll("#ocean,.ocean").remove(),this._.options.showOcean){var t=this._.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");return t.append("stop").attr("offset","5%").attr("stop-color","#ddf"),t.append("stop").attr("offset","100%").attr("stop-color","#9ab"),this._.ocean=a.svg.append("g").attr("class","ocean").append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale()).attr("class","noclicks"),this._.ocean}}var a={svg:null,q:null};return t=Object.assign({showOcean:!0},t),{name:"oceanPlugin",onInit(){Object.assign(this._.options,t),this.svgAddOcean=n,a.svg=this._.svg},onResize(){this._.ocean&&this._.options.showOcean&&this._.ocean.attr("r",this._.proj.scale())},selectAll(t){return t&&(a.q=t,a.svg=d3.selectAll(t)),a.svg}}},configPlugin:function(){return{name:"configPlugin",set(t){if(t){if(Object.assign(this._.options,t),void 0!==t.spin){var n=this.autorotatePlugin;t.spin?n.start():n.stop()}this._.drag=!0,this.svgDraw(),this._.drag=!1}return Object.assign({},this._.options)}}},graticuleCanvas:function(){function t(){this._.options.showGraticule&&this.canvasPlugin.render(function(t,a){t.beginPath(),a(n()),t.lineWidth=.3,t.strokeStyle="rgba(119,119,119,0.4)",t.stroke()})}var n=d3.geoGraticule();return{name:"graticuleCanvas",onInit(){this.canvasAddGraticule=t,this._.options.showGraticule=!0},onRefresh(){t.call(this)}}},graticulePlugin:function(){function t(){if(a.svg.selectAll(".graticule").remove(),this._.options.showGraticule)return this._.graticule=a.svg.append("g").attr("class","graticule").append("path").datum(n).attr("class","noclicks").attr("d",this._.path),this._.graticule}var n=d3.geoGraticule(),a={svg:null,q:null};return{name:"graticulePlugin",onInit(){this.svgAddGraticule=t,this._.options.showGraticule=!0,a.svg=this._.svg},onRefresh(){this._.graticule&&this._.options.showGraticule&&this._.graticule.attr("d",this._.path)},selectAll(t){return t&&(a.q=t,a.svg=d3.selectAll(t)),a.svg}}},fauxGlobePlugin:function(t={}){function n(){if(e.svg.selectAll("#drop_shadow,.drop_shadow").remove(),this._.options.showGlobeShadow){var t=this._.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");t.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),t.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),this._.dropShadow=e.svg.append("g").attr("class","drop_shadow").append("ellipse").attr("cx",this._.options.width/2).attr("cy",this._.options.height-50).attr("rx",.9*this._.proj.scale()).attr("ry",.25*this._.proj.scale()).attr("class","noclicks").style("fill","url(#drop_shadow)"),this._.dropShadow}}function a(){if(e.svg.selectAll("#shading,.shading").remove(),this._.options.showGlobeShading){var t=this._.defs.append("radialGradient").attr("id","shading").attr("cx","50%").attr("cy","40%");return t.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),t.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),this._.globeShading=e.svg.append("g").attr("class","shading").append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale()).attr("class","noclicks").style("fill","url(#shading)"),this._.globeShading}}function i(){if(e.svg.selectAll("#hilight,.hilight").remove(),this._.options.showGlobeHilight){var t=this._.defs.append("radialGradient").attr("id","hilight").attr("cx","75%").attr("cy","25%");return t.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),t.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),this._.globeHilight=e.svg.append("g").attr("class","hilight").append("circle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale()).attr("class","noclicks").style("fill","url(#hilight)"),this._.globeHilight}}var e={svg:null,q:null};return t=Object.assign({showGlobeShadow:!0,showGlobeShading:!0,showGlobeHilight:!0},t),{name:"fauxGlobePlugin",onInit(){Object.assign(this._.options,t),this.svgAddDropShadow=n,this.svgAddGlobeHilight=i,this.svgAddGlobeShading=a,e.svg=this._.svg},onResize(){this._.globeShading&&this._.options.showGlobeShading&&this._.globeShading.attr("r",this._.proj.scale()),this._.globeHilight&&this._.options.showGlobeHilight&&this._.globeHilight.attr("r",this._.proj.scale())},selectAll(t){return t&&(e.q=t,e.svg=d3.selectAll(t)),e.svg}}},autorotatePlugin:function(t){function n(t,n){var i=this._.proj.rotate();i[0]+=a.degree*t/1e3,i[0]>=180&&(i[0]-=360),this._.rotate(i)}var a={spin:!0,lastTick:null,degree:t,sync:[]};return{name:"autorotatePlugin",onInit(){},onInterval(){var t=new Date;if(a.lastTick&&a.spin&&!this._.drag){var i=t-a.lastTick;n.call(this,i,a.degree),a.sync.forEach(function(t){n.call(t,i,a.degree)}),a.lastTick=t}else a.lastTick=t},speed(t){a.degree=t},start(){a.spin=!0},stop(){a.spin=!1},sync(t){a.sync=t}}},placesPlugin:function(t){function n(){s.svg.selectAll(".points,.labels").remove(),s.places&&this._.options.showPlaces&&(a.call(this),i.call(this),e.call(this))}function a(){return this._.placePoints=s.svg.append("g").attr("class","points").selectAll("path").data(s.places.features).enter().append("path").attr("class","point").attr("d",this._.path),this._.placePoints}function i(){return this._.placeLabels=s.svg.append("g").attr("class","labels").selectAll("text").data(s.places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name}),this._.placeLabels}function e(){var t=this,n=this._.proj.invert([this._.options.width/2,this._.options.height/2]);this._.placeLabels.attr("text-anchor",function(n){var a=t._.proj(n.geometry.coordinates)[0];return a<t._.options.width/2-20?"end":a<t._.options.width/2+20?"middle":"start"}).attr("transform",function(n){var a=t._.proj(n.geometry.coordinates),i=a[0],e=a[1];return"translate("+(i+(i<t._.options.width/2?-5:5))+","+(e-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}var s={svg:null,q:null,places:null};return{name:"placesPlugin",urls:t&&[t],onReady(t,n){s.places=n},onInit(){this._.options.showPlaces=!0,this.svgAddPlaces=n,s.svg=this._.svg},onRefresh(){this._.placePoints&&(this._.placePoints.attr("d",this._.path),e.call(this))},selectAll(t){return t&&(s.q=t,s.svg=d3.selectAll(t)),s.svg},data(t){if(!t)return{places:s.places};var n=t.placesPlugin.data();s.places=n.places}}},worldCanvas:function(t,n){function a(){this._.options.showLand&&o.world&&(i.call(this),this._.options.showCountries&&e.call(this),this._.options.showLakes&&s.call(this))}function i(){var t=topojson.feature(o.world,o.world.objects.land);this.canvasPlugin.render(function(n,a){n.beginPath(),a(t),n.fillStyle=o.style.land||"rgba(117, 87, 57, 0.4)",n.fill()})}function e(){var t=topojson.feature(o.world,o.world.objects.countries);this.canvasPlugin.render(function(n,a){n.beginPath(),a(t),n.lineWidth=.5,n.strokeStyle=o.style.countries||"rgba(80, 64, 39, 0.6)",n.stroke()})}function s(){var t=topojson.feature(o.world,o.world.objects.ne_110m_lakes);this.canvasPlugin.render(function(n,a){n.beginPath(),a(t),n.fillStyle=o.style.lakes||"rgba(80, 87, 97, 0.4)",n.fill()})}var o={world:null,countryNames:null,style:{}},r=null;return t&&(r=[t],n&&r.push(n)),{name:"worldCanvas",urls:r,onReady(t,n,a){o.world=n,o.countryNames=a},onInit(){this._.options.showLand=!0,this._.options.showLakes=!0,this._.options.showCountries=!0,this.canvasAddWorldOrCountries=a},onRefresh(){a.call(this)},data(t){if(!t)return{countryNames:o.countryNames,world:o.world};var n=t.worldCanvas.data();o.countryNames=n.countryNames,o.world=n.world},style(t){return t&&(o.style=t),o.style}}},worldPlugin:function(t,n){function a(){o.svg.selectAll(".land,.lakes,.countries").remove(),this._.options.showLand&&o.world&&(this._.options.showCountries?e.call(this):i.call(this),this._.options.showLakes&&s.call(this))}function i(){var t=topojson.feature(o.world,o.world.objects.land);return this._.world=o.svg.append("g").attr("class","land").append("path").datum(t).attr("d",this._.path),this._.world}function e(){var t=topojson.feature(o.world,o.world.objects.countries).features;return this._.countries=o.svg.append("g").attr("class","countries").selectAll("path").data(t).enter().append("path").on("click",r).attr("id",function(t){return"x"+t.id}).attr("d",this._.path),this._.countries}function s(){var t=topojson.feature(o.world,o.world.objects.ne_110m_lakes);return this._.lakes=o.svg.append("g").attr("class","lakes").append("path").datum(t).attr("d",this._.path),this._.lakes}var o={svg:null,q:null,world:null,countries:null,countryNames:null},r=function(){},l=null;return t&&(l=[t],n&&l.push(n)),{name:"worldPlugin",urls:l,onReady(t,n,a){o.world=n,o.countryNames=a},onInit(){this._.options.showLand=!0,this._.options.showLakes=!0,this._.options.showCountries=!0,this.svgAddWorldOrCountries=a,o.svg=this._.svg},onRefresh(){o.world&&this._.options.showLand&&(this._.options.showCountries?this._.countries.attr("d",this._.path):this._.world.attr("d",this._.path),this._.options.showLakes&&this._.lakes.attr("d",this._.path))},countries(){return o.countries},countryName(t){var n="";return o.countryNames&&(n=o.countryNames.find(function(n){return n.id==t.id})),n},selectAll(t){return t&&(o.q=t,o.svg=d3.selectAll(t)),o.svg},data(t){if(!t)return{countryNames:o.countryNames,world:o.world};var n=t.worldPlugin.data();o.countryNames=n.countryNames,o.world=n.world}}},centerPlugin:function(){function t(t,n){n=n.replace("x","");for(var a=0,i=t.length;a<i;a++)if(t[a].id==n)return t[a]}function n(t){var n=this;d3.transition().duration(2500).tween("rotate",function(){var a=d3.interpolate(n._.proj.rotate(),[-t[0],-t[1]]);return function(t){n._.rotate(a(t))}})}var a={focused:null};return{name:"centerPlugin",onInit(){var i=this,e=this.svgAddCountries;this.svgAddCountries=function(){return e.call(this).on("click",function(e){var s=this.id.replace("x",""),o=i.worldPlugin.countries(),r=t(o,s),l=d3.geoCentroid(r);n.call(i,l),console.log(s),"function"==typeof a.focused&&a.focused.call(i)})}},go(a){focusedCountry=t(c,a),p=d3.geoCentroid(focusedCountry),n.call(_this,p)},focused(t){a.focused=t}}},countryTooltipPlugin:function(){var t=d3.select("body").append("div").attr("class","countryTooltip");return{name:"countryTooltipPlugin",onInit(){var n=this,a=this.svgAddCountries;this.svgAddCountries=function(){return a.call(this).on("mouseover",function(a){var i=n.worldPlugin.countryName.call(n,a);t.text(i.name).style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px").style("display","block").style("opacity",1)}).on("mouseout",function(){t.style("opacity",0).style("display","none")}).on("mousemove",function(){t.style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px")})}}}},flattenPlugin:function(){var t={proj:null};return{name:"flattenPlugin",onInit(){function n(){a._.svg.transition().duration(10500).tween("projection",function(){return function(t){n.alpha(t),a._.refresh()}})}var a=this,i=this._.proj,e=d3.geoEquirectangular().scale(175).translate([350,250]);t.proj=function(t,a){function i(n,i){var s=t([n*=180/Math.PI,i*=180/Math.PI]),o=a([n,i]);return[(1-e)*s[0]+e*o[0],(e-1)*s[1]-e*o[1]]}var e,s=d3.geoProjection(i).scale(1);return n.alpha=function(n){if(!arguments.length)return e;var i=t.translate(),o=a.translate();return e=+n,o[0]=i[0],o[1]=i[1]/1.2,console.log(s.rotate(),n),s.translate([(1-e)*i[0]+e*o[0],(1-e)*i[1]+e*o[1]]),s},n.alpha(0),s}(i,e),this._.animation=n,this._.px=t.proj,this._.g1=i,this._.g2=e},toMap(){this._.path=d3.geoPath().projection(t.proj),this.svgDraw(),this._.animation.call(this)}}},barPlugin:function(t){function n(){if(e.svg.selectAll(".bar").remove(),e.bars&&this._.options.showBars){var t=e.svg.append("g").attr("class","bar"),n=t.append("mask").attr("id","edge");n.append("rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","white"),n.append("use").attr("xlink:href","#edgeCircle").attr("fill","black"),this._.mask=n,e.max=d3.max(e.bars,function(t){return parseInt(t.Value)});var a=this._.proj.scale();return e.lengthScale=d3.scaleLinear().domain([0,e.max]).range([a,a+50]),this._.bar=t.selectAll("line").data(e.bars).enter().append("line").attr("stroke","red").attr("stroke-width","2"),this._.bar}}function a(){this._.defs.selectAll("clipPath").remove(),this._.defs.append("clipPath").append("circle").attr("id","edgeCircle").attr("cx",this._.options.width/2).attr("cy",this._.options.height/2).attr("r",this._.proj.scale())}function i(){if(e.bars&&this._.options.showBars){var t=this._.proj,n=t.invert([this._.options.width/2,this._.options.height/2]);this._.bar.attr("x1",function(n){return t([n.Longitude,n.Latitude])[0]}).attr("y1",function(n){return t([n.Longitude,n.Latitude])[1]}).attr("x2",function(t){return e.barProjection.scale(e.lengthScale(t.Value)),e.barProjection([t.Longitude,t.Latitude])[0]}).attr("y2",function(t){return e.barProjection.scale(e.lengthScale(t.Value)),e.barProjection([t.Longitude,t.Latitude])[1]}).attr("mask",function(t){return d3.geoDistance([t.Longitude,t.Latitude],n)<1.57?null:"url(#edge)"})}}var e={svg:null,barProjection:null,q:null,bars:null};return{name:"barPlugin",urls:t&&[t],onReady(t,n){var a=this;e.bars=n,setTimeout(function(){i.call(a)},1)},onInit(){this.svgAddBar=n,this.svgClipPath=a,this._.options.showBars=!0,e.barProjection=this._.orthoGraphic(),e.svg=this._.svg,a.call(this)},onResize(){a.call(this),n.call(this)},onRefresh(){e.barProjection.rotate(this._.proj.rotate()),i.call(this)},selectAll(t){return t&&(e.q=t,e.svg=d3.selectAll(t)),e.svg},data(t){if(!t)return{bars:e.bars};var n=t.barPlugin.data();e.bars=n.bars}}}},t});