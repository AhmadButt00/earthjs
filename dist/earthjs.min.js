!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.earthjs=e()}(this,function(){"use strict";var t=function(t={}){function e(t,e){var n=e+"Keys";t[e]&&(o[e][t.name]=t[e],o[n]=Object.keys(o[e]))}function n(e){return e.svgCreateOrder.forEach(function(n){e[n]&&e[n](e,t)}),e}function a(t,e){return o.onRefreshKeys.length>0&&o.onRefreshKeys.map(function(n){o.onRefresh[n](t,e)}),t}function r(t,e){return o.onResizeKeys.length>0&&o.onResizeKeys.map(function(n){o.onResize[n](t,e)}),t}t=Object.assign({select:"#earth",interval:50,height:870,width:1700},t);var o={onResize:{},onResizeKeys:[],onRefresh:{},onRefreshKeys:[],onInterval:{},onIntervalKeys:[]},i=d3.select(t.select).attr("width",t.width).attr("height",t.height),s=d3.geoOrthographic().scale(t.width/4.1).translate([t.width/2,t.height/2]).precision(.1),l=d3.geoPath().projection(s),c={svg:i,proj:s,path:l,_:{},state:{drag:!1},register:function(n){var a={};if(c[n.name]=a,Object.keys(n).map(function(e){-1===["onResize","onInterval","onRefresh","ready","data"].indexOf(e)&&"function"==typeof n[e]&&(a[e]=function(){var a=[].slice.call(arguments);return a.unshift(c,t),n[e].apply(null,a)})}),n.onInit&&n.onInit(c,t),e(n,"onResize"),e(n,"onRefresh"),e(n,"onInterval"),n.data&&n.ready){var r=d3.queue();n.data.forEach(function(t){var e=t.split(".").pop();r.defer(d3[e],t)}),r.await(function(){var e=[].slice.call(arguments);e.unshift(c,t),n.ready.apply(null,e)})}return c}};c._.defs=c.svg.append("defs");var d;return c.ticker=function(e){return e&&(t.interval=e,clearInterval(d)),d=setInterval(function(){o.onIntervalKeys.length>0&&o.onIntervalKeys.map(function(e){o.onInterval[e](c,t)})},t.interval),c},c.svgCreateOrder=["svgAddDropShadow","svgAddOcean","svgAddGlobeShading","svgAddWorldOrCountries","svgAddGlobeHilight","svgAddGraticule","svgAddPlaces"],c.svgRecreate=n,c.refresh=a,c.resize=r,c.draw=function(){c.svgRecreate(c)},c.scale=function(e){return c.proj.scale(e),c.resize(c,t),c.refresh(c,t),c},c.rotate=function(e){return c.proj.rotate(e),c.refresh(c,t),c},c},e=function(){function t(t){var e=t[0]/2*p,n=d(e),a=i(e),r=t[1]/2*p,o=d(r),s=i(r),l=t[2]/2*p,c=d(l),u=i(l);return[a*s*u+n*o*c,n*s*u-a*o*c,a*o*u+n*s*c,a*s*c-n*o*u]}function e(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function n(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}var a=Math.acos,r=Math.asin,o=Math.atan2,i=Math.cos,s=Math.max,l=Math.min,c=Math.PI,d=Math.sin,u=Math.sqrt,p=c/180,g=180/c;return t.cartesian=function(t){var e=t[0]*p,n=t[1]*p,a=i(n);return[a*i(e),a*d(e),d(n)]},t.rotation=function(t){return[o(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*g,r(s(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*g,o(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*g]},t.delta=function(t,r){var o=e(t,r),c=u(n(o,o));if(!c)return[1,0,0,0];var p=a(s(-1,l(1,n(t,r))))/2,g=d(p);return[i(p),o[2]/c*g,-o[1]/c*g,o[0]/c*g]},t.multiply=function(t,e){return[t[0]*e[0]-t[1]*e[1]-t[2]*e[2]-t[3]*e[3],t[0]*e[1]+t[1]*e[0]+t[2]*e[3]-t[3]*e[2],t[0]*e[2]-t[1]*e[3]+t[2]*e[0]+t[3]*e[1],t[0]*e[3]+t[1]*e[2]-t[2]*e[1]+t[3]*e[0]]},t}();return t.plugins={versorDragPlugin:function(){return{name:"versorDragPlugin",onInit(t){function n(){t.state.drag=!0,o=e.cartesian(t.proj.invert(d3.mouse(this))),i=t.proj.rotate(),s=e(i)}function a(){t.state.drag=!1}function r(){var n=e.cartesian(t.proj.rotate(i).invert(d3.mouse(this))),a=e.multiply(s,e.delta(o,n)),r=e.rotation(a);t.rotate(r)}t.svg.call(d3.drag().on("start",n).on("end",a).on("drag",r));var o,i,s}}},wheelZoomPlugin:function(){return{name:"wheelZoomPlugin",onInit(t){t.svg.on("wheel",function(){var e=d3.event.deltaY+t.proj.scale();e>230&&e<1e3&&t.scale(e)})}}},oceanPlugin:function(t={}){function e(t,e){if(t.svg.selectAll("#ocean,.ocean").remove(),!e.hideOcean){var n=t._.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");return n.append("stop").attr("offset","5%").attr("stop-color","#ddf"),n.append("stop").attr("offset","100%").attr("stop-color","#9ab"),t._.ocean=t.svg.append("circle").attr("cx",e.width/2).attr("cy",e.height/2).attr("r",t.proj.scale()).attr("class","ocean noclicks").style("fill","url(#ocean)"),t._.ocean}}return t=Object.assign({hideOcean:!1},t),{name:"oceanPlugin",onInit(n,a){Object.assign(a,t),n.svgAddOcean=e},onResize(t,e){t._.ocean&&!e.hideOcean&&t._.ocean.attr("r",t.proj.scale())}}},configPlugin:function(){return{name:"configPlugin",set(t,e,n){return n&&(Object.assign(e,n),t.state.drag=!0,t.svgRecreate(t),t.state.drag=!1),Object.assign({},e)}}},graticulePlugin:function(t={}){function e(t,e){if(t.svg.selectAll(".graticule").remove(),!e.hideGraticule)return t._.graticule=t.svg.append("g").attr("class","graticule").append("path").datum(n).attr("class","noclicks").attr("d",t.path),t._.graticule}var n=d3.geoGraticule();return t=Object.assign({hideGraticule:!1},t),{name:"graticulePlugin",onInit(n,a){Object.assign(a,t),n.svgAddGraticule=e},onRefresh(t,e){t._.graticule&&!e.hideGraticule&&t._.graticule.attr("d",t.path)}}},fauxGlobePlugin:function(t={}){function e(t,e){if(t.svg.selectAll("#drop_shadow,.drop_shadow").remove(),!e.hideGlobeShadow){var n=t._.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");n.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),n.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),t._.dropShadow=t.svg.append("ellipse").attr("cx",e.width/2).attr("cy",e.height-50).attr("rx",.9*t.proj.scale()).attr("ry",.25*t.proj.scale()).attr("class","drop_shadow noclicks").style("fill","url(#drop_shadow)"),t._.dropShadow}}function n(t,e){if(t.svg.selectAll("#globe_shading,.globe_shading").remove(),!e.hideGlobeShading){var n=t._.defs.append("radialGradient").attr("id","globe_shading").attr("cx","50%").attr("cy","40%");return n.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),n.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),t._.globeShading=t.svg.append("circle").attr("cx",e.width/2).attr("cy",e.height/2).attr("r",t.proj.scale()).attr("class","globe_shading noclicks").style("fill","url(#globe_shading)"),t._.globeShading}}function a(t,e){if(t.svg.selectAll("#globe_hilight,.globe_hilight").remove(),!e.hideGlobeHilight){var n=t._.defs.append("radialGradient").attr("id","globe_hilight").attr("cx","75%").attr("cy","25%");return n.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),n.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),t._.globeHilight=t.svg.append("circle").attr("cx",e.width/2).attr("cy",e.height/2).attr("r",t.proj.scale()).attr("class","globe_hilight noclicks").style("fill","url(#globe_hilight)"),t._.globeHilight}}return t=Object.assign({hideGlobeShadow:!1,hideGlobeShading:!1,hideGlobeHilight:!1},t),{name:"fauxGlobePlugin",onInit(r,o){Object.assign(o,t),r.svgAddDropShadow=e,r.svgAddGlobeHilight=a,r.svgAddGlobeShading=n},onResize(t,e){t._.globeShading&&!e.hideGlobeShading&&t._.globeShading.attr("r",t.proj.scale()),t._.globeHilight&&!e.hideGlobeHilight&&t._.globeHilight.attr("r",t.proj.scale())}}},autorotatePlugin:function(t){var e,n=null;return{name:"autorotatePlugin",onInit(n,a){e=t,a.stop=!1},onInterval(t,a){var r=new Date;if(t.state.drag||a.stop||!n)n=r;else{var o=r-n,i=t.proj.rotate();i[0]+=e*o/1e3,i[0]>=180&&(i[0]-=360),t.proj.rotate(i),t.refresh(t,a),n=r}},speed(t,n,a){e=a},start(t,e){e.stop=!1},stop(t,e){e.stop=!0}}},placesPlugin:function(t="./d/places.json"){function e(t,e){t.svg.selectAll(".points,.labels").remove(),t._places&&e.places&&!e.hidePlaces&&(n(t),a(t),r(t,e))}function n(t){return t._.placePoints=t.svg.append("g").attr("class","points").selectAll("path").data(t._places.features).enter().append("path").attr("class","point").attr("d",t.path),t._.placePoints}function a(t){return t._.placeLabels=t.svg.append("g").attr("class","labels").selectAll("text").data(t._places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name}),t._.placeLabels}function r(t,e){var n=t.proj.invert([e.width/2,e.height/2]);t._.placeLabels.attr("text-anchor",function(n){var a=t.proj(n.geometry.coordinates)[0];return a<e.width/2-20?"end":a<e.width/2+20?"middle":"start"}).attr("transform",function(n){var a=t.proj(n.geometry.coordinates),r=a[0],o=a[1];return"translate("+(r+(r<e.width/2?-5:5))+","+(o-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}return{name:"placesPlugin",data:[t],ready(t,e,n,a){t._places=a,t.svgRecreate(t)},onInit(t,n){n.places=!0,n.hidePlaces=!1,t.svgAddPlaces=e},onRefresh(t,e){t._.placePoints&&e.places&&(t._.placePoints.attr("d",t.path),r(t,e))}}},worldPlugin:function(t="./d/world-110m.json",e){function n(t,e){t.svg.selectAll(".land,.lakes,.countries").remove(),e.hideLand||t._world&&(e.hideCountries?t.svgAddWorld(t,e):t.svgAddCountries(t,e),t.svgAddLakes(t,e))}function a(t){return t._.countries=t.svg.append("g").attr("class","countries").selectAll("path").data(topojson.feature(t._world,t._world.objects.countries).features).enter().append("path").attr("id",function(t){return"x"+t.id}).on("click",i).attr("d",t.path),t._.countries}function r(t){return t._.world=t.svg.append("g").attr("class","land").append("path").datum(topojson.feature(t._world,t._world.objects.land)).attr("d",t.path),t._.world}function o(t){return t._.lakes=t.svg.append("g").attr("class","lakes").append("path").datum(topojson.feature(t._world,t._world.objects.ne_110m_lakes)).attr("d",t.path),t._.lakes}var i=function(){},s=[t];return e&&s.push(e),{name:"worldPlugin",data:s,ready(t,e,n,a,r){t._world=a,t._countryNames=r,t.svgRecreate(t)},onInit(t,e){e.world=!0,e.hideLand=!1,e.hideCountries=!1,t.svgAddWorldOrCountries=n,t.svgAddCountries=a,t.svgAddWorld=r,t.svgAddLakes=o},onRefresh(t,e){e.hideLand||(e.hideCountries?t._.world.attr("d",t.path):t._.countries.attr("d",t.path),t._.lakes.attr("d",t.path))}}},countryTooltipPlugin:function(){var t=d3.select("body").append("div").attr("class","countryTooltip");return{name:"countryTooltipPlugin",onInit(e){var n=e.svgAddCountries;e.svgAddCountries=function(e,a){return n(e,a).on("mouseover",function(n){var a=e._countryNames.find(function(t){return t.id==n.id});t.text(a.name).style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px").style("display","block").style("opacity",1)}).on("mouseout",function(){t.style("opacity",0).style("display","none")}).on("mousemove",function(){t.style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px")}),e._.countries}}}}},t});