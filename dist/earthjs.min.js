var earthjs=function(){"use strict";var t=function(){function t(t){var n=t[0]/2*d,e=u(n),r=i(n),o=t[1]/2*d,s=u(o),a=i(o),l=t[2]/2*d,c=u(l),h=i(l);return[r*a*h+e*s*c,e*a*h-r*s*c,r*s*h+e*a*c,r*a*c-e*s*h]}function n(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function e(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}var r=Math.acos,o=Math.asin,s=Math.atan2,i=Math.cos,a=Math.max,l=Math.min,c=Math.PI,u=Math.sin,h=Math.sqrt,d=c/180,p=180/c;return t.cartesian=function(t){var n=t[0]*d,e=t[1]*d,r=i(e);return[r*i(n),r*u(n),u(e)]},t.rotation=function(t){return[s(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*p,o(a(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*p,s(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*p]},t.delta=function(t,o){var s=n(t,o),c=h(e(s,s));if(!c)return[1,0,0,0];var d=r(a(-1,l(1,e(t,o))))/2,p=u(d);return[i(d),s[2]/c*p,-s[1]/c*p,s[0]/c*p]},t.multiply=function(t,n){return[t[0]*n[0]-t[1]*n[1]-t[2]*n[2]-t[3]*n[3],t[0]*n[1]+t[1]*n[0]+t[2]*n[3]-t[3]*n[2],t[0]*n[2]-t[1]*n[3]+t[2]*n[0]+t[3]*n[1],t[0]*n[3]+t[1]*n[2]-t[2]*n[1]+t[3]*n[0]]},t}(),n=function n(){function e(t,n){t[n]&&(o[n][t.name]=t[n],o[n+"Keys"]=Object.keys(o[n]))}var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};clearInterval(n.ticker),r=Object.assign({select:"#earth",rotate:130},r);var o={onResize:{},onResizeKeys:[],onRefresh:{},onRefreshKeys:[],onInterval:{},onIntervalKeys:[],renderOrder:["renderThree","svgAddDropShadow","svgAddCanvas","canvasAddGraticule","canvasAddWorldOrCountries","canvasAddDots","svgAddOcean","svgAddGlobeShading","svgAddGraticule","svgAddWorldOrCountries","svgAddGlobeHilight","svgAddPlaces","svgAddPings","svgAddDots","svgAddBar"],ready:null,loadingData:null,promeses:[]},s=d3.selectAll(r.select),i=s.attr("width"),a=s.attr("height"),l=d3.scaleLinear().domain([0,i]).range([-180,180]);i&&a||(i=r.width||700,a=r.height||500,s.attr("width",i).attr("height",a));var c=[i/2,a/2];Object.defineProperty(r,"width",{get:function(){return i},set:function(t){i=t,c[0]=t/2}}),Object.defineProperty(r,"height",{get:function(){return a},set:function(t){a=t,c[1]=t/2}});var u={_:{svg:s,drag:!1,versor:t,center:c,options:r,ltScale:l},$:{},ready:function(t){if(!t)return o.loadingData;if(o.promeses.length>0){o.loadingData=!0;var n=d3.queue();o.promeses.forEach(function(t){t.urls.forEach(function(t){var e=t.split(".").pop();"geojson"===e&&(e="json"),n.defer(d3[e],t)})}),n.await(function(){var n=[].slice.call(arguments),e=n.shift();o.promeses.forEach(function(t){var r=t.urls.length,o=n.slice(0,r);o.unshift(e),t.onReady.apply(u,o),n=n.slice(r)}),o.loadingData=!1,t.call(u)})}},register:function(t){var n={};return u[t.name]=n,Object.keys(t).forEach(function(e){-1===["urls","onReady","onInit","onResize","onRefresh","onInterval"].indexOf(e)&&"function"==typeof t[e]&&(n[e]=function(){return t[e].apply(u,arguments)})}),t.onInit&&t.onInit.call(u),e(t,"onResize"),e(t,"onRefresh"),e(t,"onInterval"),t.urls&&t.onReady&&o.promeses.push({urls:t.urls,onReady:t.onReady}),u}},h=[],d=null,p=u._;return u.svgDraw=function(t){var n=u.$;return h=t||[],o.renderOrder.forEach(function(t){n[t]&&n[t].call(u)}),h.forEach(function(t){t.svgDraw(null)}),null===d&&h!==[]&&p.ticker(),u},p.defs=p.svg.append("defs"),p.ticker=function(t){var e=p.intervalRun;return t=t||50,d=setInterval(function(){e.call(u),h.forEach(function(t){t._.intervalRun.call(t)})},t),n.ticker=d,u},p.scale=function(t){return p.proj.scale(t),p.resize(),p.refresh(),u},p.rotate=function(t){return p.proj.rotate(t),p.refresh(),u},p.intervalRun=function(){return o.onIntervalKeys.forEach(function(t){o.onInterval[t].call(u)}),u},p.refresh=function(t){return(t?o.onRefreshKeys.filter(function(n){return t.test(n)}):o.onRefreshKeys).forEach(function(t){o.onRefresh[t].call(u)}),u},p.resize=function(){return o.onResizeKeys.forEach(function(t){o.onResize[t].call(u)}),u},p.orthoGraphic=function(){return d3.geoOrthographic().rotate([p.options.rotate,0]).scale(p.options.width/3.5).translate(p.center).precision(.1).clipAngle(90)},p.addRenderer=function(t){o.renderOrder.indexOf(t)<0&&o.renderOrder.push(t)},p.proj=p.orthoGraphic(),p.path=d3.geoPath().projection(p.proj),u};return n.plugins={versorDragPlugin:function(){function t(){function t(t){var n=t[0]-l[0];t[0]=n+this._.proj.rotate()[0],t[0]>=180&&(t[0]-=360),this._.rotate(t)}function e(){a=i.cartesian(s.proj.invert(d3.mouse(this))),l=s.proj.rotate(),c=i(l),s.drag=null,s.refresh()}function r(){var t=i.cartesian(s.proj.rotate(l).invert(d3.mouse(this))),n=i.multiply(c,i.delta(a,t)),e=i.rotation(n);s.rotate(e),s.drag=!0}function o(){var e=s.proj.rotate();n.sync.forEach(function(n){t.call(n,e)}),s.drag=!1,s.refresh()}var s=this._,i=s.versor;n.svg.call(d3.drag().on("start",e).on("end",o).on("drag",r));var a=void 0,l=void 0,c=void 0}var n={svg:null,q:null,sync:[]};return{name:"versorDragPlugin",onInit:function(){n.svg=this._.svg,t.call(this)},selectAll:function(e){return e&&(n.q=e,n.svg=d3.selectAll(e),t.call(this)),n.svg},sync:function(t){n.sync=t}}},wheelZoomPlugin:function(){return{name:"wheelZoomPlugin",onInit:function(){var t=this._;t.svg.on("wheel",function(){var n=d3.event.deltaY+t.proj.scale();n=n<20?20:n>999?1e3:n,t.scale(n)})}}},threejsPlugin:function(){function t(){setTimeout(function(){n.renderer.render(n.scene,n.camera)},1)}var n={renderer:null,scene:null,camera:null,scale:null};return{name:"threejsPlugin",onInit:function(){var e=this._.options.width,r=this._.options.height;n.scene=new THREE.Scene,n.yAxis=new THREE.Vector3(0,1,0),n.camera=new THREE.OrthographicCamera(-e/2,e/2,r/2,-r/2,.1,1e4),n.camera.position.z=500,this._.camera=n.camera,n.renderer=new THREE.WebGLRenderer({antialias:!0}),n.renderer.domElement.id="three-js",n.renderer.setClearColor("white",1),n.renderer.setSize(e,r),document.body.appendChild(n.renderer.domElement),this.renderThree=t},onRefresh:function(){t.call(this)},addObject:function(t){n.scene.add(t)}}},canvasPlugin:function(){function t(){if(this._.options.showCanvas){if(!n.canvas){var t=this._.svg.append("g").attr("class","canvas").append("foreignObject").attr("x",0).attr("y",0).attr("width",this._.options.width).attr("height",this._.options.height),e=t.append("xhtml:body").style("margin","0px").style("padding","0px").style("background-color","none").style("width",this._.options.width+"px").style("height",this._.options.height+"px");n.canvas=e.append("canvas")}return n.canvas.attr("x",0).attr("y",0).attr("width",this._.options.width).attr("height",this._.options.height),n.canvas}}var n={canvas:null,path:null,q:null};return{name:"canvasPlugin",onInit:function(){this._.options.showCanvas=!0,this.$.svgAddCanvas=t,n.path=d3.geoPath().projection(this._.proj)},onRefresh:function(){var t=this._.options.width,e=this._.options.height;n.canvas.each(function(){this.getContext("2d").clearRect(0,0,t,e)})},selectAll:function(t){return t&&(n.q=t,n.canvas=d3.selectAll(t)),n.canvas},render:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(this._.options.showCanvas){var o=!1,s=this._.proj,i=s.rotate(),a=this;n.canvas.each(function(l,c){if(!e||e.indexOf(c)>-1){var u=r[c]||{};u.rotate?(o=!0,s.rotate([i[0]+u.rotate,i[1],i[2]])):o&&(o=!1,s.rotate(i));var h=this.getContext("2d");t.call(a,h,n.path.context(h))}}),o&&(o=!1,s.rotate(i))}}}},oceanPlugin:function(){function t(){if(e.svg.selectAll("#ocean,.ocean").remove(),this._.options.showOcean){var t=this._.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");return t.append("stop").attr("offset","5%").attr("stop-color","#ddf"),t.append("stop").attr("offset","100%").attr("stop-color","#9ab"),this._.ocean=e.svg.append("g").attr("class","ocean").append("circle").attr("cx",this._.center[0]).attr("cy",this._.center[1]).attr("class","noclicks"),n.call(this),this._.ocean}}function n(){this._.ocean&&this._.options.showOcean&&this._.ocean.attr("r",this._.proj.scale()+e.scale)}var e={svg:null,q:null,scale:0};return{name:"oceanPlugin",onInit:function(){this.$.svgAddOcean=t,this._.options.showOcean=!0,e.svg=this._.svg},onResize:function(){n.call(this)},selectAll:function(t){return t&&(e.q=t,e.svg=d3.selectAll(t)),e.svg},scale:function(t){if(!t)return e.scale;e.scale=t,n.call(this)}}},configPlugin:function(){return{name:"configPlugin",set:function(t){if(t){if(Object.assign(this._.options,t),void 0!==t.spin){var n=this.autorotatePlugin;t.spin?n.start():n.stop()}this.svgDraw()}return Object.assign({},this._.options)}}},graticuleCanvas:function(){function t(){this._.options.showGraticule&&this.canvasPlugin.render(function(t,r){t.beginPath(),r(n),t.lineWidth=.3,t.strokeStyle=e.style.line||"rgba(119,119,119,0.4)",t.stroke()},e.drawTo)}var n=d3.geoGraticule()(),e={style:{},drawTo:null};return{name:"graticuleCanvas",onInit:function(){this.$.canvasAddGraticule=t,this._.options.showGraticule=!0},onRefresh:function(){t.call(this)},style:function(t){return t&&(e.style=t),e.style},drawTo:function(t){e.drawTo=t}}},graticulePlugin:function(){function t(){if(r.svg.selectAll(".graticule").remove(),this._.options.showGraticule)return this._.graticule=r.svg.append("g").attr("class","graticule").append("path").datum(e).attr("class","noclicks"),n.call(this),this._.graticule}function n(){this._.graticule&&this._.options.showGraticule&&this._.graticule.attr("d",this._.path)}var e=d3.geoGraticule(),r={svg:null,q:null};return{name:"graticulePlugin",onInit:function(){this.$.svgAddGraticule=t,this._.options.showGraticule=!0,r.svg=this._.svg},onRefresh:function(){n.call(this)},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg}}},fauxGlobePlugin:function(){function t(){var t=this._;if(r.svg.selectAll("#drop_shadow,.drop_shadow").remove(),t.options.showGlobeShadow){var n=t.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");n.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),n.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),t.dropShadow=r.svg.append("g").attr("class","drop_shadow").append("ellipse").attr("cx",t.center[0]).attr("cy",t.options.height-50).attr("rx",.9*t.proj.scale()).attr("ry",.25*t.proj.scale()).attr("class","noclicks").style("fill","url(#drop_shadow)"),t.dropShadow}}function n(){var t=this._;if(r.svg.selectAll("#shading,.shading").remove(),t.options.showGlobeShading){var n=t.defs.append("radialGradient").attr("id","shading").attr("cx","50%").attr("cy","40%");return n.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),n.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),t.globeShading=r.svg.append("g").attr("class","shading").append("circle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale()).attr("class","noclicks").style("fill","url(#shading)"),t.globeShading}}function e(){var t=this._;if(r.svg.selectAll("#hilight,.hilight").remove(),t.options.showGlobeHilight){var n=t.defs.append("radialGradient").attr("id","hilight").attr("cx","75%").attr("cy","25%");return n.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),n.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),t.globeHilight=r.svg.append("g").attr("class","hilight").append("circle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale()).attr("class","noclicks").style("fill","url(#hilight)"),t.globeHilight}}var r={svg:null,q:null};return{name:"fauxGlobePlugin",onInit:function(){var o=this._.options;o.showGlobeShadow=!0,o.showGlobeShading=!0,o.showGlobeHilight=!0,this.$.svgAddDropShadow=t,this.$.svgAddGlobeHilight=e,this.$.svgAddGlobeShading=n,r.svg=this._.svg},onResize:function(){var t=this._,n=t.options,e=t.proj.scale();t.globeShading&&n.showGlobeShading&&t.globeShading.attr("r",e),t.globeHilight&&n.showGlobeHilight&&t.globeHilight.attr("r",e),t.dropShadow&&n.showGlobeShadow&&t.dropShadow.attr("cy",e+250).attr("rx",.9*e).attr("ry",.25*e)},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg}}},autorotatePlugin:function(t){function n(t){var n=this._.proj.rotate();n[0]+=e.degree*t/1e3,this._.rotate(n)}var e={lastTick:new Date,degree:t,sync:[]};return{name:"autorotatePlugin",onInit:function(){this._.options.spin=!0},onInterval:function(){var t=new Date;if(!this._.options.spin||this._.drag)e.lastTick=t;else{var r=t-e.lastTick;n.call(this,r),e.sync.forEach(function(t){return n.call(t,r)}),e.lastTick=t}},speed:function(t){e.degree=t},start:function(){this._.options.spin=!0},stop:function(){this._.options.spin=!1},sync:function(t){e.sync=t}}},countryTooltipPlugin:function(){var t=d3.select("body").append("div").attr("class","countryTooltip");return{name:"countryTooltipPlugin",onInit:function(){var n=this,e=this.$.svgAddCountries;this.$.svgAddCountries=function(){return e.call(this).on("mouseover",function(e){var r=n.worldPlugin.countryName.call(n,e);t.text(r.name).style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px").style("display","block").style("opacity",1)}).on("mouseout",function(){t.style("opacity",0).style("display","none")}).on("mousemove",function(){t.style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px")})}}}},barTooltipPlugin:function(){var t=d3.select("body").append("div").attr("class","barTooltip");return{name:"barTooltipPlugin",onInit:function(){var n=this,e=this.$.svgAddBar;this.$.svgAddBar=function(){return e.call(this).on("mouseover",function(){var e=+this.dataset.index,r=n.barPlugin.data().features[e];n.barTooltipPlugin.onShow&&(r=n.barTooltipPlugin.onShow.call(this,r,e,t)),n.barTooltipPlugin.show(r).style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px").style("display","block").style("opacity",1)}).on("mouseout",function(){t.style("opacity",0).style("display","none")}).on("mousemove",function(){t.style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px")})}},show:function(n){var e=n.properties,r=Object.keys(e).map(function(t){return t+": "+e[t]}).join("<br/>");return t.html(r)}}},placesPlugin:function(t){function n(){i.svg.selectAll(".points,.labels").remove(),i.places&&this._.options.showPlaces&&(r.call(this),o.call(this),e.call(this))}function e(){this._.placePoints&&(this._.placePoints.attr("d",this._.path),s.call(this))}function r(){return this._.placePoints=i.svg.append("g").attr("class","points").selectAll("path").data(i.places.features).enter().append("path").attr("class","point"),this._.placePoints}function o(){return this._.placeLabels=i.svg.append("g").attr("class","labels").selectAll("text").data(i.places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name}),this._.placeLabels}function s(){var t=this,n=this._.proj.invert(this._.center);this._.placeLabels.attr("text-anchor",function(n){var e=t._.proj(n.geometry.coordinates)[0];return e<t._.center[0]-20?"end":e<t._.center[0]+20?"middle":"start"}).attr("transform",function(n){var e=t._.proj(n.geometry.coordinates),r=e[0],o=e[1];return"translate("+(r+(r<t._.center[0]?-5:5))+","+(o-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}var i={svg:null,q:null,places:null};return{name:"placesPlugin",urls:t&&[t],onReady:function(t,n){i.places=n},onInit:function(){this.$.svgAddPlaces=n,this._.options.showPlaces=!0,i.svg=this._.svg},onRefresh:function(){e.call(this)},selectAll:function(t){return t&&(i.q=t,i.svg=d3.selectAll(t)),i.svg},data:function(t){if(!t)return{places:i.places};var n=t.placesPlugin.data();i.places=n.places}}},worldCanvas:function(t,n){function e(){i.world&&this._.options.showLand&&(r.call(this),this._.drag||(this._.options.showCountries&&o.call(this),this._.options.showLakes&&s.call(this)))}function r(){this.canvasPlugin.render(function(t,n){t.beginPath(),n(i.land),t.fillStyle=i.style.land||"rgba(117, 87, 57, 0.4)",t.fill()},i.drawTo,i.options)}function o(){this.canvasPlugin.render(function(t,n){t.beginPath(),n(i.countries),t.lineWidth=.5,t.strokeStyle=i.style.countries||"rgba(80, 64, 39, 0.6)",t.stroke()},i.drawTo,i.options)}function s(){this.canvasPlugin.render(function(t,n){t.beginPath(),n(i.lakes),t.fillStyle=i.style.lakes||"rgba(80, 87, 97, 0.4)",t.fill()},i.drawTo,i.options)}var i={world:null,countryNames:null,style:{},drawTo:null,options:{}},a=null;return t&&(a=[t],n&&a.push(n)),{name:"worldCanvas",urls:a,onReady:function(t,n,e){this.worldCanvas.data({world:n,countryNames:e})},onInit:function(){this._.options.showLand=!0,this._.options.showLakes=!0,this._.options.showCountries=!0,this.$.canvasAddWorldOrCountries=e},onRefresh:function(){e.call(this)},data:function(t){return t&&(i.world=t.world,i.countryNames=t.countryNames,i.land=topojson.feature(i.world,i.world.objects.land),i.lakes=topojson.feature(i.world,i.world.objects.ne_110m_lakes),i.countries=topojson.feature(i.world,i.world.objects.countries)),{world:i.world,countryNames:i.countryNames}},style:function(t){return t&&(i.style=t),i.style},drawTo:function(t){i.drawTo=t},options:function(t){i.options=t}}},worldPlugin:function(t,n){function e(){a.svg.selectAll(".land,.lakes,.countries").remove(),this._.options.showLand&&(a.world&&(this._.options.showCountries?this.$.svgAddCountries.call(this):this.$.svgAddWorld.call(this),this._.options.showLakes&&this.$.svgAddLakes.call(this)),r.call(this))}function r(){a.world&&this._.options.showLand&&(this._.options.showCountries?this._.countries.attr("d",this._.path):this._.world.attr("d",this._.path),this._.options.showLakes&&this._.lakes.attr("d",this._.path))}function o(){return this._.world=a.svg.append("g").attr("class","land").append("path").datum(a.land),this._.world}function s(){return this._.countries=a.svg.append("g").attr("class","countries").selectAll("path").data(a.countries.features).enter().append("path").on("click",l).attr("id",function(t){return"x"+t.id}),this._.countries}function i(){return this._.lakes=a.svg.append("g").attr("class","lakes").append("path").datum(a.lakes),this._.lakes}var a={svg:null,q:null,world:null,countryNames:null},l=function(){},c=null;return t&&(c=[t],n&&c.push(n)),{name:"worldPlugin",urls:c,onReady:function(t,n,e){this.worldPlugin.data({world:n,countryNames:e})},onInit:function(){this._.options.showLand=!0,this._.options.showLakes=!0,this._.options.showCountries=!0,this.$.svgAddWorldOrCountries=e,this.$.svgAddCountries=s,this.$.svgAddLakes=i,this.$.svgAddWorld=o,a.svg=this._.svg},onRefresh:function(){r.call(this)},countries:function(){return a.countries.features},data:function(t){return t&&(a.world=t.world,a.countryNames=t.countryNames,a.land=topojson.feature(a.world,a.world.objects.land),a.lakes=topojson.feature(a.world,a.world.objects.ne_110m_lakes),a.countries=topojson.feature(a.world,a.world.objects.countries)),{world:a.world,countryNames:a.countryNames}},countryName:function(t){var n="";return a.countryNames&&(n=a.countryNames.find(function(n){return n.id==t.id})),n},selectAll:function(t){return t&&(a.q=t,a.svg=d3.selectAll(t)),a.svg}}},worldThreejs:function(){function t(){if(!e.sphereObject){var t=this,r=new THREE.Group;(new THREE.TextureLoader).load("./d/world.jpg",function(o){var s=new THREE.SphereGeometry(200,20,20),i=new THREE.MeshBasicMaterial({map:o,overdraw:.5});e.sphereObject=new THREE.Mesh(s,i),r.add(e.sphereObject),n.call(t)}),t.threejsPlugin.addObject(r)}}function n(){var t=this._.proj.rotate();t[0]-=90;var n=this._.versor(t),r=new THREE.Quaternion(-n[2],n[1],n[3],n[0]);e.sphereObject.setRotationFromQuaternion(r)}var e={sphereObject:null};return{name:"worldThreejs",onInit:function(){t.call(this)},onRefresh:function(){e.sphereObject&&n.call(this)}}},centerPlugin:function(){function t(t,n){n=n.replace("x","");for(var e=0,r=t.length;e<r;e++)if(t[e].id==n)return t[e]}function n(t){var n=this;d3.transition().duration(2500).tween("rotate",function(){var e=d3.interpolate(n._.proj.rotate(),[-t[0],-t[1],0]);return function(t){n._.rotate(e(t))}})}function e(){var e=this,o=r.svgAddCountriesOld.call(this);return o.on("click",function(){if(e._.options.enableCenter){var o=this.id.replace("x",""),s=e.worldPlugin.countries(),i=t(s,o),a=d3.geoCentroid(i);n.call(e,a),"function"==typeof r.focused&&r.focused.call(e)}}),o}var r={focused:null,svgAddCountriesOld:null};return{name:"centerPlugin",onInit:function(){r.svgAddCountriesOld=this.$.svgAddCountries,this.$.svgAddCountries=e,this._.options.enableCenter=!0},go:function(e){var r=this.worldPlugin.countries(),o=t(r,e),s=d3.geoCentroid(o);n.call(this,s)},focused:function(t){r.focused=t}}},flattenPlugin:function(){function t(){var n=this;return n._.svg.transition().duration(10500).tween("projection",function(){return function(e){t.alpha(e),n._.refresh()}})}function n(n,e){function r(t,r){var o=n([t*=180/Math.PI,r*=180/Math.PI]),i=e([t,r]);return[(1-s)*o[0]+s*i[0],(s-1)*o[1]-s*i[1]]}var o=d3.geoProjection(r).scale(1),s=void 0;return t.alpha=function(t){if(!arguments.length)return s;s=+t;var r=n.center(),i=e.center(),a=n.translate(),l=e.translate();return o.center([(1-s)*r[0]+s*i[0],(1-s)*r[1]+s*i[1]]),o.translate([(1-s)*a[0]+s*l[0],(1-s)*a[1]+s*l[1]]),o},t.alpha(0),o}function e(){var t=this._;return d3.transition().duration(1500).tween("rotate",function(){t.rotate(t.proj.rotate());var n=d3.interpolate(t.proj.rotate(),[0,0,0]);return function(e){t.rotate(n(e))}})}var r={};return{name:"flattenPlugin",onInit:function(){var t=this._.proj,n=d3.geoEquirectangular().scale(this._.options.width/6.3).translate(this._.center);r.g1=t,r.g2=n},toMap:function(){var o=this;e.call(this).on("end",function(){var e=n(r.g1,r.g2);o._.path=d3.geoPath().projection(e),t.call(o).on("end",function(){o._.options.enableCenter=!1})})},toGlobe:function(){var e=this;this._.rotate([0,0,0]);var o=n(r.g2,r.g1);this._.path=d3.geoPath().projection(o),t.call(this).on("end",function(){e._.path=d3.geoPath().projection(e._.proj),e._.options.enableCenter=!0,e._.refresh()})}}},barPlugin:function(t){function n(){var t=this._;if(o.svg.selectAll(".bar").remove(),o.bars&&t.options.showBars){var n=o.svg.append("g").attr("class","bar"),r=n.append("mask").attr("id","edge");r.append("rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","white"),r.append("use").attr("xlink:href","#edgeCircle").attr("fill","black"),t.mask=r,o.max=d3.max(o.bars.features,function(t){return parseInt(t.properties.mag)});var s=t.proj.scale();return o.lengthScale=d3.scaleLinear().domain([0,o.max]).range([s,s+50]),t.bar=n.selectAll("line").data(o.bars.features).enter().append("line").attr("stroke","red").attr("stroke-width","2").attr("data-index",function(t,n){return n}),e.call(this),t.bar}}function e(){var t=this._;if(o.bars&&t.options.showBars){var n=t.proj,e=o.lengthScale,r=o.barProjection,s=n.invert(t.center);t.bar.each(function(t){var o=t.geometry.coordinates;r.scale(e(t.properties.mag));var i=d3.geoDistance(o,s),a=n(o),l=r(o);d3.select(this).attr("x1",a[0]).attr("y1",a[1]).attr("x2",l[0]).attr("y2",l[1]).attr("mask",i<1.57?null:"url(#edge)")})}}function r(){var t=this._;t.defs.selectAll("clipPath").remove(),t.defs.append("clipPath").append("circle").attr("id","edgeCircle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale())}var o={svg:null,barProjection:null,q:null,bars:null};return{name:"barPlugin",urls:t&&[t],onReady:function(t,n){var r=this;o.bars=n,setTimeout(function(){return e.call(r)},1)},onInit:function(){var t=this._;this.$.svgAddBar=n,this.$.svgClipPath=r,this._.options.showBars=!0,o.barProjection=t.orthoGraphic(),o.svg=t.svg,r.call(this)},onResize:function(){r.call(this),n.call(this)},onRefresh:function(){o.barProjection.rotate(this._.proj.rotate()),e.call(this)},selectAll:function(t){return t&&(o.q=t,o.svg=d3.selectAll(t)),o.svg},data:function(t){if(!t)return o.bars;o.bars=t}}},dotsPlugin:function(){function t(){if(e.dataDots&&this._.options.showDots&&!this._.drag&&(this._.svg.selectAll(".dot").remove(),e.dataDots&&this._.options.showDots))return this._.dots=this._.svg.append("g").attr("class","dot").selectAll("circle").data(e.dataDots.features).enter().append("circle").attr("r",2).attr("stroke","#F00").style("opacity",.75),n.call(this),this._.dots}function n(){if(null==this._.drag)this._.dots.style("display","none");else if(!this._.drag&&this._.dots&&this._.options.showDots){var t=this._.proj,n=this._.proj.invert(this._.center);this._.dots.attr("cx",function(n){return t(n.geometry.coordinates)[0]}).attr("cy",function(n){return t(n.geometry.coordinates)[1]}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}}var e={dataDots:null};return{name:"dotsPlugin",onInit:function(){this.$.svgAddDots=t,this._.options.showDots=!0},onRefresh:function(){n.call(this)},data:function(t){e.dataDots=t}}},dotsCanvas:function(){function t(){if(n.dataDots&&this._.options.showDots&&!this._.drag){var t=this._.proj,e=t.invert(this._.center);this.canvasPlugin.render(function(r){n.dataDots.features.forEach(function(n){d3.geoDistance(n.geometry.coordinates,e)<=1.57&&(r.beginPath(),r.fillStyle="#F00",r.arc(t(n.geometry.coordinates)[0],t(n.geometry.coordinates)[1],2,0,2*Math.PI),r.fill(),r.closePath())})},n.drawTo)}}var n={dataDots:null};return{name:"dotsCanvas",onInit:function(){this.$.canvasAddDots=t,this._.options.showDots=!0},onRefresh:function(){t.call(this)},data:function(t){n.dataDots=t},drawTo:function(t){n.drawTo=t}}},pingsCanvas:function(){var t={dataPings:null,pings:[]};return{name:"pingsCanvas",onInit:function(){this._.options.showPings=!0},onInterval:function(){if(!this._.drag&&this._.options.showPings){var n=void 0,e=this._.proj;if(t.pings.length<=7){n=this._.proj.invert(this._.center);var r=t.dataPings.features.filter(function(t){return d3.geoDistance(t.geometry.coordinates,n)<=1.57}),o=r[Math.floor(Math.random()*(r.length-1))];t.pings.push({r:2.5,l:o.geometry.coordinates})}var s=t.pings[0];d3.geoDistance(s.l,this._.proj.invert(this._.center))>1.57?t.pings.shift():(this._.options.spin||this._.refresh(/anvas/),this.canvasPlugin.render(function(n){if(n.beginPath(),n.fillStyle="#F80",n.arc(e(s.l)[0],e(s.l)[1],s.r,0,2*Math.PI),n.fill(),n.closePath(),s.r=s.r+.2,s.r>5)t.pings.shift();else if(t.pings.length>1){var r=t.pings.shift();t.pings.push(r)}},t.drawTo))}},data:function(n){t.dataPings=n},drawTo:function(n){t.drawTo=n}}},pingsPlugin:function(){function t(){if(r.svg.selectAll(".pings").remove(),r.dataPings&&this._.options.showPings){var t=r.svg.append("g").attr("class","pings");return r.ping2=t.selectAll(".ping-2").data(r.dataPings.features).enter().append("circle").attr("class","ping-2").attr("id",function(t,n){return"ping-"+n}),this._.pings=t.selectAll(".ping-2"),e.call(this),n.call(this),this._.pings}}function n(){var t=r.ping2.nodes().filter(function(t){return"inline"==t.style.display});t.length>0&&d3.select("#"+t[Math.floor(Math.random()*(t.length-1))].id).attr("r",2).attr("stroke","#F00").attr("stroke-opacity",1).attr("stroke-width","10px").transition().duration(1e3).attr("r",30).attr("fill","none").attr("stroke-width","0.1px")}function e(){if(null==this._.drag)this._.pings.style("display","none");else if(!this._.drag&&this._.pings&&this._.options.showPings){var t=this._.proj,n=this._.proj.invert(this._.center);this._.pings.attr("cx",function(n){return t(n.geometry.coordinates)[0]}).attr("cy",function(n){return t(n.geometry.coordinates)[1]}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}}var r={svg:null,dataPings:null,ping2:null};return{name:"pingsPlugin",onInit:function(){var e=this;this.$.svgAddPings=t,this._.options.showPings=!0,setInterval(function(){return n.call(e)},3e3),r.svg=this._.svg},onRefresh:function(){e.call(this)},data:function(t){r.dataPings=t},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg}}},debugThreejs:function(){function t(){if(!e.sphereObject){var t=this._.proj.scale(),r=new THREE.SphereGeometry(t,100,100),o=new THREE.MeshNormalMaterial({wireframe:!1}),s=new THREE.Mesh(r,o),i=new THREE.SphereGeometry(30,10,10),a=new THREE.SphereGeometry(30,10,10),l=new THREE.SphereGeometry(30,10,10);i.translate(0,0,t),a.translate(t,0,0),l.translate(0,-t,0);var c=new THREE.MeshBasicMaterial({color:"blue"}),u=new THREE.MeshBasicMaterial({color:"red"}),h=new THREE.MeshBasicMaterial({color:"green"}),d=new THREE.Mesh(i,c),p=new THREE.Mesh(a,u),f=new THREE.Mesh(l,h);e.sphereObject=new THREE.Object3D,e.sphereObject.add(s,d,p,f),n.call(this),this.threejsPlugin.addObject(e.sphereObject)}}function n(){var t=this._.proj.rotate();t[0]-=90;var n=this._.versor(t),r=new THREE.Quaternion(-n[2],n[1],n[3],n[0]);e.sphereObject.setRotationFromQuaternion(r)}var e={sphereObject:null};return{name:"debugThreejs",onInit:function(){this._.options.showDebugSpahre=!0,t.call(this)},onRefresh:function(){e.sphereObject&&n.call(this)}}},commonPlugins:function(t){var n={checker:[]};return{name:"commonPlugins",onInit:function(){var e=this,r=this.register,o=earthjs.plugins;r(o.autorotatePlugin(10)),r(o.versorDragPlugin()),r(o.wheelZoomPlugin()),r(o.configPlugin()),r(o.oceanPlugin()),r(o.canvasPlugin()),r(o.graticuleCanvas()),r(o.worldCanvas(t)),this.canvasPlugin.selectAll(".canvas"),this.ready(function(){return e.svgDraw()}),n.options=this.configPlugin.set(),n.buttonClick=function(t){var r=t.split(":"),o=r[2],s={},i=n.options;i[o]=!i[o],s[o]=i[o],"hideCountries"==o&&(s.hideLand=!1),e.configPlugin.set(s)},n.checker=["ocean:Ocean:showOcean","graticule:Graticule:showGraticule","hideLand:Land:showLand","spin:Spin:spin"].map(function(t){return t.split(":")}),d3.select(".set-options").selectAll("button").data(n.checker).enter().append("button").text(function(t){return t[1]}).on("click",function(t){return n.buttonClick.call(e,t.join(":"))})},addChecker:function(t){var e=this;n.checker.push(t),n.options=this.configPlugin.set(),d3.select(".set-options").selectAll("button").data(n.checker).enter().append("button").text(function(t){return t[1]}).on("click",function(t){return n.buttonClick.call(e,t.join(":"))})}}}},n}();