window.earthjs=function(){function t(t){var e=t.proj.invert([t.width/2,t.height/2]);t.svg.selectAll(".label").attr("text-anchor",function(e){var a=t.proj(e.geometry.coordinates)[0];return a<t.width/2-20?"end":a<t.width/2+20?"middle":"start"}).attr("transform",function(e){var a=t.proj(e.geometry.coordinates),o=a[0],s=a[1];return"translate("+(o+(o<t.width/2?-5:5))+","+(s-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,e)>1.57?"none":"inline"})}function e(t,e){function a(){r=[d3.event.pageX,d3.event.pageY],n=t.proj.rotate(),t.state.drag=!0,d3.event.preventDefault()}function o(){if(r){var a=[d3.event.pageX,d3.event.pageY],o=[n[0]+(a[0]-r[0])/6,n[1]+(r[1]-a[1])/6];o[1]=o[1]>30?30:o[1]<-30?-30:o[1],t.proj.rotate(o),t.refresh(t,e)}}function s(){r&&(o(),r=null,t.state.drag=!1)}var l=d3.select(window);l.on("mouseup",s),l.on("mousemove",o),t.svg.on("mousedown",a);var r,n}function a(t,e){t.svg.selectAll(".land,.countries").remove(),e.showCountries?t.countries=t.svg.append("g").attr("class","countries").selectAll("path").data(topojson.feature(t._world,t._world.objects.countries).features).enter().append("path").attr("d",t.path):t.world=t.svg.append("path").datum(topojson.feature(t._world,t._world.objects.land)).attr("class","land").attr("d",t.path)}function o(e,a){e.svg.selectAll(".points,.labels").remove(),a.places&&a.showPlaces&&(e.points=e.svg.append("g").attr("class","points").selectAll("text").data(e._places.features).enter().append("path").attr("class","point").attr("d",e.path),e.labels=e.svg.append("g").attr("class","labels").selectAll("text").data(e._places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name}),t(e))}function s(t,e){if(t.svg.selectAll("#ocean_fill,.ocean_fill_circle").remove(),e.showOcean){var a=t.svg.append("defs").append("radialGradient").attr("id","ocean_fill").attr("cx","75%").attr("cy","25%");a.append("stop").attr("offset","5%").attr("stop-color","#ddf"),a.append("stop").attr("offset","100%").attr("stop-color","#9ab"),t.svg.append("circle").attr("cx",t.width/2).attr("cy",t.height/2).attr("r",t.proj.scale()).attr("class","ocean_fill_circle noclicks").style("fill","url(#ocean_fill)")}}function l(t,e){if(t.svg.selectAll("#globe_highlight,.globe_highlight_circle").remove(),e.globeHighlighted){var a=t.svg.append("defs").append("radialGradient").attr("id","globe_highlight").attr("cx","75%").attr("cy","25%");a.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),a.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),t.svg.append("circle").attr("cx",t.width/2).attr("cy",t.height/2).attr("r",t.proj.scale()).attr("class","globe_highlight_circle noclicks").style("fill","url(#globe_highlight)")}}function r(t,e){if(t.svg.selectAll("#globe_shading,.globe_shading_circle").remove(),e.showGlobeShading){var a=t.svg.append("defs").append("radialGradient").attr("id","globe_shading").attr("cx","50%").attr("cy","40%");a.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),a.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),t.svg.append("circle").attr("cx",t.width/2).attr("cy",t.height/2).attr("r",t.proj.scale()).attr("class","globe_shading_circle noclicks").style("fill","url(#globe_shading)")}}function n(t,e){t.svg.selectAll(".graticule").remove(),e.showGraticule&&(t.graticule=t.svg.append("path").datum(t.datumGraticule).attr("class","graticule noclicks").attr("d",t.path))}function i(t,e){if(t.svg.selectAll(".drop_shadow,.drop_shadow_ellipse").remove(),e.showGlobeShadow){var a=t.svg.append("defs").append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");a.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),a.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),t.svg.append("ellipse").attr("cx",440).attr("cy",450).attr("rx",.9*t.proj.scale()).attr("ry",.25*t.proj.scale()).attr("class","drop_shadow_ellipse noclicks").style("fill","url(#drop_shadow)")}}var c=null;return window&&(originalEarthjs=window.earthjs),c=function(c={}){function d(t,e,s){w._world=e,w._places=s,a(w,c),o(w,c),l(w,c),r(w,c),n(w,c),w.loaded=!0,w.ready.call(w)}function p(e,a){a.showCountries?e.countries.attr("d",e.path):e.world.attr("d",e.path),e.graticule&&a.showGraticule&&e.graticule.attr("d",e.path),e.points&&a.places&&a.places&&(e.points.attr("d",e.path),t(e)),h.onRefreshKeys.length>0&&h.onRefreshKeys.map(function(t,o){h.onRefresh[t](e,a)})}c=Object.assign({world:"./d/world-110m.json",select:"#earth",drawTick:50,width:960,height:500,world:null,places:null,graticule:null,showOcean:!0,showPlaces:!0,showCountries:!0,showGraticule:!0,showGlobeShadow:!0,showGlobeShading:!0,globeHighlighted:!0},c);var h={onDraw:{},onRefresh:{},onDrawKeys:[],onRefreshKeys:[]},g=d3.select(c.select).attr("width",c.width).attr("height",c.height),u=d3.geoOrthographic().scale(c.width/4.1).translate([c.width/2,c.height/2]).precision(1),f=d3.geoPath().projection(u),w={svg:g,proj:u,path:f,fn:{},loaded:!1,state:{drag:!1},width:c.width,height:c.height,datumGraticule:d3.geoGraticule(),ready:()=>{},register:function(t){t.onInterval&&(h.onDraw[t.name]=t.onInterval,h.onDrawKeys=Object.keys(h.onDraw)),t.onRefresh&&(h.onRefresh[t.name]=t.onRefresh,h.onRefreshKeys=Object.keys(h.onRefresh)),"function"==typeof t.fn&&(w.fn[t.name]=function(){var e=[].slice.call(arguments);e.unshift(w,c),t.fn.apply(null,e)}),t.json&&t.ready&&queue().defer(d3.json,t.json).await(function(e,a){t.ready(w,c,e,a)})}},v=queue().defer(d3.json,c.world);return c.places&&v.defer(d3.json,c.places),v.await(d),i(w,c),s(w,c),setInterval(function(){h.onDrawKeys.length>0&&h.onDrawKeys.map(function(t,e){h.onDraw[t](w,c)})},c.drawTick),e(w,c),w.addPlaces=o,w.refresh=p,w},c.plugins={},c.plugins.configPlugin=function(){return{name:"config",fn(t,e,s={}){t.state.drag=!0,void 0!==s.showGlobeShadow&&(e.showGlobeShadow=s.showGlobeShadow,t.svg.selectAll(".drop_shadow_ellipse").style("opacity",s.showGlobeShadow?1:0)),void 0!==s.showOcean&&(e.showOcean=s.showOcean,t.svg.selectAll(".ocean_fill_circle").style("opacity",s.showOcean?1:0)),void 0!==s.showGlobeShading&&(e.showGlobeShading=s.showGlobeShading,t.svg.selectAll(".globe_shading_circle").style("opacity",s.showGlobeShading?1:0)),void 0!==s.globeHighlighted&&(e.globeHighlighted=s.globeHighlighted,t.svg.selectAll(".globe_highlight_circle").style("opacity",s.globeHighlighted?1:0)),void 0!==s.showCountries&&(e.showCountries=s.showCountries,a(t,e),l(t,e),r(t,e),n(t,e)),void 0!==s.showPlaces&&e.places&&(t.svg.selectAll(".points,.labels").remove(),e.showPlaces=s.showPlaces,o(t,e)),void 0!==s.showGraticule&&(e.showGraticule=s.showGraticule,n(t,e)),void 0!==s.hideLand&&(e.hideLand=s.hideLand,t.svg.selectAll(".land,.countries").style("opacity",s.hideLand?1:0)),t.state.drag=!1}}},c.plugins.autorotatePlugin=function(t){var e=null;return{name:"autorotate",onInterval(a,o){var s=new Date;if(a.state.drag||!e)e=s;else{var l=s-e,r=a.proj.rotate();r[0]+=t*l/1e3,r[0]>=180&&(r[0]-=360),a.proj.rotate(r),a.refresh(a,o),e=s}}}},c.plugins.placesPlugin=function(t="./d/places.json"){return{name:"places",json:t,ready(t,e,a,o){e.places=!0,t._places=o,t.svg.selectAll(".points,.labels").remove(),t.addPlaces(t,e)},onInterval(t,e){},onRefresh(t,e){},fn(t,e,a={}){}}},c.noConflict=function(){return window.earthjs=originalEarthjs,c},c}();